<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>API: Foundation/CPPredicate/CPPredicate.j Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">API&#160;<span id="projectnumber">0.9.5</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_c_p_predicate_8j.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Foundation/CPPredicate/CPPredicate.j</div>  </div>
</div>
<div class="contents">
<a href="_c_p_predicate_8j.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * CPPredicate.j</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * CPPredicate parsing based on NSPredicate.m in GNUStep Base Library (http://www.gnustep.org/)</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (c) 2005 Free Software Foundation.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Created by cacaodev.</span>
<a name="l00008"></a>00008 <span class="comment"> * Copyright 2010.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
<a name="l00011"></a>00011 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00012"></a>00012 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00013"></a>00013 <span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00016"></a>00016 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00017"></a>00017 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<a name="l00018"></a>00018 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00021"></a>00021 <span class="comment"> * License along with this library; if not, write to the Free Software</span>
<a name="l00022"></a>00022 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span>
<a name="l00023"></a>00023 <span class="comment"> */</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00052"></a>00052 <span class="keyword">@implementation </span><a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a> : <a class="code" href="class_c_p_object.html" title="The root class from which most classes are subclassed.">CPObject</a>
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054     <span class="keywordtype">id</span> __doxygen__;
<a name="l00055"></a>00055 }
<a name="l00056"></a>00056 
<a name="l00063"></a><a class="code" href="interface_c_p_predicate.html#a4e4d4439762a97fbbf43c99a6b6a842b">00063</a> + (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicateWithFormat:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)format, ...
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065     <span class="keywordflow">if</span> (!format)
<a name="l00066"></a>00066         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPInvalidArgumentException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:_cmd + &quot; the format can&#39;t be &#39;nil&#39;&quot;];
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     var args = Array.prototype.slice.call(arguments, 3);
<a name="l00069"></a>00069     <span class="keywordflow">return</span> [<span class="keyword">self</span> <a class="code" href="interface_c_p_predicate.html#aefb6279b35b08428e164dcb5f140af33">predicateWithFormat</a>:arguments[2] <a class="code" href="interface_c_p_predicate.html#aefb6279b35b08428e164dcb5f140af33">argumentArray</a>:args];
<a name="l00070"></a>00070 }
<a name="l00071"></a>00071 
<a name="l00078"></a><a class="code" href="interface_c_p_predicate.html#aefb6279b35b08428e164dcb5f140af33">00078</a> + (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicateWithFormat:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)format argumentArray:(<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)args
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080     <span class="keywordflow">if</span> (!format)
<a name="l00081"></a>00081         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPInvalidArgumentException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:_cmd + &quot; the format can&#39;t be &#39;nil&#39;&quot;];
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     var s = [[<a class="code" href="interface_c_p_predicate_scanner.html">CPPredicateScanner</a> alloc] initWithString:format args:args],
<a name="l00084"></a>00084         p = [s parse];
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <span class="keywordflow">return</span> p;
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00095"></a><a class="code" href="interface_c_p_predicate.html#a452993cee44b925237095fa924959942">00095</a> + (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicateWithFormat:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)format arguments:(va_list)argList
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097     <span class="comment">// UNIMPLEMENTED</span>
<a name="l00098"></a>00098     <span class="keywordflow">return</span> nil;
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00106"></a><a class="code" href="interface_c_p_predicate.html#ab907266777eb475dfc51ac71a318a99a">00106</a> - (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicateWithSubstitutionVariables:(<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a>)variables
<a name="l00107"></a>00107 {
<a name="l00108"></a>00108     <span class="comment">// IMPLEMENTED BY SUBCLASSES</span>
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00116"></a><a class="code" href="interface_c_p_predicate.html#a573e1cf04e320d4aeb080fd989e8dcf9">00116</a> + (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicateWithValue:(BOOL)value
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118     <span class="keywordflow">return</span> [[<a class="code" href="class_c_p_predicate___b_o_o_l.html">CPPredicate_BOOL</a> alloc] initWithBool:value];
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="comment">// Evaluating a Predicate</span>
<a name="l00127"></a><a class="code" href="interface_c_p_predicate.html#a04c64bf1043a20d5b9a028f4da2aa76b">00127</a> <span class="comment"></span>- (BOOL)evaluateWithObject:(<span class="keywordtype">id</span>)object
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129     <span class="comment">// IMPLEMENTED BY SUBCLASSES</span>
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00138"></a><a class="code" href="interface_c_p_predicate.html#adceea236e49c35b84ed02daabdf7fe00">00138</a> - (BOOL)evaluateWithObject:(<span class="keywordtype">id</span>)object substitutionVariables:(<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a>)variables
<a name="l00139"></a>00139 {
<a name="l00140"></a>00140     <span class="comment">// IMPLEMENTED BY SUBCLASSES</span>
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">// Getting Format Information</span>
<a name="l00148"></a><a class="code" href="interface_c_p_predicate.html#a3bafeb4899e683e8007326bcfd24ef72">00148</a> <span class="comment"></span>- (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)predicateFormat
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150     <span class="comment">// IMPLEMENTED BY SUBCLASSES</span>
<a name="l00151"></a>00151 }
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="interface_c_p_predicate.html#aa8836fdbdba91e5a4ee92e8512299716">00153</a> - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)description
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155     <span class="keywordflow">return</span> [<span class="keyword">self</span> <a class="code" href="interface_c_p_predicate.html#a3bafeb4899e683e8007326bcfd24ef72">predicateFormat</a>];
<a name="l00156"></a>00156 }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="keyword">@end</span>
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="class_c_p_predicate___b_o_o_l.html">00160</a> <span class="keyword">@implementation </span><a class="code" href="class_c_p_predicate___b_o_o_l.html">CPPredicate_BOOL</a> : <a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162     BOOL _value;
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a><a class="code" href="class_c_p_predicate___b_o_o_l.html#a836f04b893680a748f61a58ec72f9c67">00165</a> - (id)initWithBool:(BOOL)value
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167     _value = value;
<a name="l00168"></a>00168     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="class_c_p_predicate___b_o_o_l.html#af797fddcdff338dadda4bed855fe1ead">00171</a> - (BOOL)evaluateObject:(<span class="keywordtype">id</span>)object
<a name="l00172"></a>00172 {
<a name="l00173"></a>00173     <span class="keywordflow">return</span> _value;
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="class_c_p_predicate___b_o_o_l.html#aba55066dc7b0367cb37d9f23c6fa63ca">00176</a> - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)predicateFormat
<a name="l00177"></a>00177 {
<a name="l00178"></a>00178     <span class="keywordflow">return</span> (_value) ? <span class="stringliteral">@&quot;TRUEPREDICATE&quot;</span> : <span class="stringliteral">@&quot;FALSEPREDICATE&quot;</span>;
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="keyword">@end</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="keyword">@implementation </span><a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="interface_c_p_array.html#aee089e1c096a5bc0ec5c38776dc8e176">00186</a> - (<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)filteredArrayUsingPredicate:(<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicate
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188     var <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a> = [<span class="keyword">self</span> <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>],
<a name="l00189"></a>00189         result = [<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l00190"></a>00190         i = 0;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     <span class="keywordflow">for</span> (; i &lt; <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>; i++)
<a name="l00193"></a>00193     {
<a name="l00194"></a>00194         var <span class="keywordtype">object</span> = <span class="keyword">self</span>[i];
<a name="l00195"></a>00195         <span class="keywordflow">if</span> ([predicate evaluateWithObject:<span class="keywordtype">object</span>])
<a name="l00196"></a>00196             result.push(<span class="keywordtype">object</span>);
<a name="l00197"></a>00197     }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="keywordflow">return</span> result;
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="interface_c_p_array.html#a3dd8ef9774dbba1c6a79e2b3a7399618">00202</a> - (void)filterUsingPredicate:(<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicate
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204     var <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a> = [<span class="keyword">self</span> <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>];
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="keywordflow">while</span> (<a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>--)
<a name="l00207"></a>00207     {
<a name="l00208"></a>00208         <span class="keywordflow">if</span> (![predicate evaluateWithObject:<span class="keyword">self</span>[<a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>]])
<a name="l00209"></a>00209             splice(count, 1);
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="keyword">@end</span>
<a name="l00214"></a>00214 
<a name="l00215"></a><a class="code" href="class_c_p_set.html">00215</a> <span class="keyword">@implementation </span><a class="code" href="class_c_p_set.html">CPSet</a> (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)
<a name="l00216"></a>00216 
<a name="l00217"></a><a class="code" href="class_c_p_set.html#a501bb3fbd8471ea1942df82e28b33792">00217</a> - (<a class="code" href="class_c_p_set.html">CPSet</a>)filteredSetUsingPredicate:(<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicate
<a name="l00218"></a>00218 {
<a name="l00219"></a>00219     var <a class="code" href="class_c_p_set.html#a3bcde383b6edbc070c5f8dc61b658875">count</a> = [<span class="keyword">self</span> <a class="code" href="class_c_p_set.html#a3bcde383b6edbc070c5f8dc61b658875">count</a>],
<a name="l00220"></a>00220         result = [<a class="code" href="class_c_p_set.html">CPSet</a> <a class="code" href="class_c_p_set.html#a89623be28c3a0913db1967b667874d39">set</a>],
<a name="l00221"></a>00221         i = 0;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="keywordflow">for</span> (; i &lt; <a class="code" href="class_c_p_set.html#a3bcde383b6edbc070c5f8dc61b658875">count</a>; i++)
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225         var <span class="keywordtype">object</span> = [<span class="keyword">self</span> objectAtIndex:i];
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         <span class="keywordflow">if</span> ([predicate evaluateWithObject:<span class="keywordtype">object</span>])
<a name="l00228"></a>00228             [result addObject:object];
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     <span class="keywordflow">return</span> result;
<a name="l00232"></a>00232 }
<a name="l00233"></a>00233 
<a name="l00234"></a><a class="code" href="class_c_p_set.html#a16ae4e3f3cdfea7d6f4fcf9f05bfad56">00234</a> - (void)filterUsingPredicate:(<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicate
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236     var <a class="code" href="class_c_p_set.html#a3bcde383b6edbc070c5f8dc61b658875">count</a> = [<span class="keyword">self</span> <a class="code" href="class_c_p_set.html#a3bcde383b6edbc070c5f8dc61b658875">count</a>];
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     <span class="keywordflow">while</span> (--<a class="code" href="class_c_p_set.html#a3bcde383b6edbc070c5f8dc61b658875">count</a> &gt;= 0)
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240         var <span class="keywordtype">object</span> = [<span class="keyword">self</span> objectAtIndex:count];
<a name="l00241"></a>00241 
<a name="l00242"></a>00242         <span class="keywordflow">if</span> (![predicate evaluateWithObject:<span class="keywordtype">object</span>])
<a name="l00243"></a>00243             [<span class="keyword">self</span> removeObjectAtIndex:count];
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="keyword">@end</span>
<a name="l00248"></a>00248 
<a name="l00249"></a><a class="code" href="_c_p_predicate_8j.html#a6eb9bc549fadbea50a2b588b0dead97f">00249</a> <span class="preprocessor">#define REFERENCE(variable) \</span>
<a name="l00250"></a>00250 <span class="preprocessor">function(newValue)\</span>
<a name="l00251"></a>00251 <span class="preprocessor">{\</span>
<a name="l00252"></a>00252 <span class="preprocessor">    var oldValue = variable;\</span>
<a name="l00253"></a>00253 <span class="preprocessor">    if (typeof newValue != &#39;undefined&#39;)\</span>
<a name="l00254"></a>00254 <span class="preprocessor">        variable = newValue;\</span>
<a name="l00255"></a>00255 <span class="preprocessor">    return oldValue;\</span>
<a name="l00256"></a>00256 <span class="preprocessor">}</span>
<a name="l00257"></a>00257 <span class="preprocessor"></span>
<a name="l00258"></a>00258 <span class="keyword">@implementation </span><a class="code" href="interface_c_p_predicate_scanner.html">CPPredicateScanner</a> : <a class="code" href="interface_c_p_scanner.html">CPScanner</a>
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260     <a class="code" href="interface_c_p_enumerator.html" title="Defines an interface for enumerators.">CPEnumerator</a>    _args;
<a name="l00261"></a>00261     <span class="keywordtype">unsigned</span>        _retrieved;
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 - (id)initWithString:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)format args:(<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)args
<a name="l00265"></a>00265 {
<a name="l00266"></a>00266     <span class="keyword">self</span> = [<span class="keyword">super</span> initWithString:format]
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     <span class="keywordflow">if</span> (<span class="keyword">self</span>)
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270         _args = [args <a class="code" href="interface_c_p_array.html#a5d5d6488d823ab32b142a5cc246d288b">objectEnumerator</a>];
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 - (id)nextArg
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277     <span class="keywordflow">return</span> [_args nextObject];
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 - (BOOL)scanPredicateKeyword:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)key
<a name="l00281"></a>00281 {
<a name="l00282"></a>00282     var loc = [<span class="keyword">self</span> scanLocation];
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     [<span class="keyword">self</span> setCaseSensitive:NO];
<a name="l00285"></a>00285     <span class="keywordflow">if</span> (![<span class="keyword">self</span> scanString:key intoString:NULL])
<a name="l00286"></a>00286         <span class="keywordflow">return</span> NO;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <span class="keywordflow">if</span> ([<span class="keyword">self</span> isAtEnd])
<a name="l00289"></a>00289         <span class="keywordflow">return</span> YES;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     var c = [[<span class="keyword">self</span> string] characterAtIndex:[<span class="keyword">self</span> scanLocation]];
<a name="l00292"></a>00292     <span class="keywordflow">if</span> (![[<a class="code" href="interface_c_p_character_set.html">CPCharacterSet</a> <a class="code" href="_c_p_character_set_8j.html#a705f73a4dabe63456dabde818bf95132">alphanumericCharacterSet</a>] characterIsMember:c])
<a name="l00293"></a>00293         <span class="keywordflow">return</span> YES;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     [<span class="keyword">self</span> setScanLocation:loc];
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="keywordflow">return</span> NO;
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 - (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)parse
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302     var r = nil;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="keywordflow">try</span>
<a name="l00305"></a>00305     {
<a name="l00306"></a>00306         [<span class="keyword">self</span> setCharactersToBeSkipped:[<a class="code" href="interface_c_p_character_set.html">CPCharacterSet</a> <a class="code" href="interface_c_p_character_set.html#afb2de2122b75a86fc4194d9eeeae1a6a">whitespaceCharacterSet</a>]];
<a name="l00307"></a>00307         r = [<span class="keyword">self</span> parsePredicate];
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     <span class="keywordflow">catch</span>(error)
<a name="l00310"></a>00310     {
<a name="l00311"></a>00311         CPLogConsole(<span class="stringliteral">@&quot;Unable to parse predicate &#39;&quot;</span> + [<span class="keyword">self</span> <span class="keywordtype">string</span>] + <span class="stringliteral">&quot;&#39; with &quot;</span> + error);
<a name="l00312"></a>00312     }
<a name="l00313"></a>00313     <span class="keywordflow">finally</span>
<a name="l00314"></a>00314     {
<a name="l00315"></a>00315         <span class="keywordflow">if</span> (![<span class="keyword">self</span> isAtEnd])
<a name="l00316"></a>00316         {
<a name="l00317"></a>00317             var pstr = [<span class="keyword">self</span> string],
<a name="l00318"></a>00318                 loc = [<span class="keyword">self</span> scanLocation];
<a name="l00319"></a>00319             CPLogConsole(<span class="stringliteral">@&quot;Format string contains extra characters: &#39;&quot;</span> + [pstr substringToIndex:loc] + <span class="stringliteral">&quot;**&quot;</span> + [pstr substringFromIndex:loc] + <span class="stringliteral">&quot;**&#39;&quot;</span>);
<a name="l00320"></a>00320         }
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="keywordflow">return</span> r;
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 - (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)parsePredicate
<a name="l00327"></a>00327 {
<a name="l00328"></a>00328     <span class="keywordflow">return</span> [<span class="keyword">self</span> parseAnd];
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 - (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)parseAnd
<a name="l00332"></a>00332 {
<a name="l00333"></a>00333     var l = [<span class="keyword">self</span> parseOr];
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="keywordflow">while</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;AND&quot;</span>] || [<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;&amp;&amp;&quot;</span>])
<a name="l00336"></a>00336     {
<a name="l00337"></a>00337         var r = [<span class="keyword">self</span> parseOr];
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <span class="keywordflow">if</span> ([r isKindOfClass:[<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> <span class="keyword">class</span>]] &amp;&amp; [r compoundPredicateType] == <a class="code" href="_c_p_compound_predicate_8j.html#ad1085d74e653372451470f6ffde6335d">CPAndPredicateType</a>)
<a name="l00340"></a>00340         {
<a name="l00341"></a>00341             <span class="keywordflow">if</span> ([l isKindOfClass:[<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> <span class="keyword">class</span>]] &amp;&amp; [l compoundPredicateType] == <a class="code" href="_c_p_compound_predicate_8j.html#ad1085d74e653372451470f6ffde6335d">CPAndPredicateType</a>)
<a name="l00342"></a>00342             {
<a name="l00343"></a>00343                 [[l subpredicates] addObjectsFromArray:[r subpredicates]];
<a name="l00344"></a>00344             }
<a name="l00345"></a>00345             <span class="keywordflow">else</span>
<a name="l00346"></a>00346             {
<a name="l00347"></a>00347                 [[r subpredicates] insertObject:l atIndex:0];
<a name="l00348"></a>00348                 l = r;
<a name="l00349"></a>00349             }
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([l isKindOfClass:[<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> <span class="keyword">class</span>]] &amp;&amp; [l compoundPredicateType] == <a class="code" href="_c_p_compound_predicate_8j.html#ad1085d74e653372451470f6ffde6335d">CPAndPredicateType</a>)
<a name="l00352"></a>00352         {
<a name="l00353"></a>00353             [[l subpredicates] addObject:r];
<a name="l00354"></a>00354         }
<a name="l00355"></a>00355         <span class="keywordflow">else</span>
<a name="l00356"></a>00356         {
<a name="l00357"></a>00357             l = [<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> <a class="code" href="interface_c_p_compound_predicate.html#a0245d36dda30c0e300a66ad2f17cd0eb">andPredicateWithSubpredicates</a>:[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#ad27bec32a9288edb5e9c6e83d2e5e8ad">arrayWithObjects</a>:l, r]];
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359     }
<a name="l00360"></a>00360     <span class="keywordflow">return</span> l;
<a name="l00361"></a>00361 }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 - (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)parseNot
<a name="l00364"></a>00364 {
<a name="l00365"></a>00365     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;(&quot;</span> intoString:NULL])
<a name="l00366"></a>00366     {
<a name="l00367"></a>00367         var r = [<span class="keyword">self</span> parsePredicate];
<a name="l00368"></a>00368 
<a name="l00369"></a>00369         <span class="keywordflow">if</span> (![<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;)&quot;</span> intoString:NULL])
<a name="l00370"></a>00370             CPRaiseParseError(<span class="keyword">self</span>, <span class="stringliteral">@&quot;predicate&quot;</span>);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="keywordflow">return</span> r;
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;NOT&quot;</span>] || [<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;!&quot;</span>])
<a name="l00376"></a>00376     {
<a name="l00377"></a>00377         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> <a class="code" href="interface_c_p_compound_predicate.html#ae71ebcc2a60d30136b23aebb65f72eae">notPredicateWithSubpredicate</a>:[<span class="keyword">self</span> parseNot]];
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;TRUEPREDICATE&quot;</span>])
<a name="l00380"></a>00380     {
<a name="l00381"></a>00381         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a> <a class="code" href="interface_c_p_predicate.html#a573e1cf04e320d4aeb080fd989e8dcf9">predicateWithValue</a>:YES];
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;FALSEPREDICATE&quot;</span>])
<a name="l00384"></a>00384     {
<a name="l00385"></a>00385         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a> <a class="code" href="interface_c_p_predicate.html#a573e1cf04e320d4aeb080fd989e8dcf9">predicateWithValue</a>:NO];
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">return</span> [<span class="keyword">self</span> parseComparison];
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 - (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)parseOr
<a name="l00392"></a>00392 {
<a name="l00393"></a>00393     var l = [<span class="keyword">self</span> parseNot];
<a name="l00394"></a>00394     <span class="keywordflow">while</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;OR&quot;</span>] || [<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;||&quot;</span>])
<a name="l00395"></a>00395     {
<a name="l00396"></a>00396         var r = [<span class="keyword">self</span> parseNot];
<a name="l00397"></a>00397 
<a name="l00398"></a>00398         <span class="keywordflow">if</span> ([r isKindOfClass:[<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> <span class="keyword">class</span>]] &amp;&amp; [r compoundPredicateType] == <a class="code" href="_c_p_compound_predicate_8j.html#aacd3c3aa70711bc73f82175b39341ddb">CPOrPredicateType</a>)
<a name="l00399"></a>00399         {
<a name="l00400"></a>00400             <span class="keywordflow">if</span> ([l isKindOfClass:[<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> <span class="keyword">class</span>]] &amp;&amp; [l compoundPredicateType] == <a class="code" href="_c_p_compound_predicate_8j.html#aacd3c3aa70711bc73f82175b39341ddb">CPOrPredicateType</a>)
<a name="l00401"></a>00401             {
<a name="l00402"></a>00402                 [[l subpredicates] addObjectsFromArray:[r subpredicates]];
<a name="l00403"></a>00403             }
<a name="l00404"></a>00404             <span class="keywordflow">else</span>
<a name="l00405"></a>00405             {
<a name="l00406"></a>00406                 [[r subpredicates] insertObject:l atIndex:0];
<a name="l00407"></a>00407                 l = r;
<a name="l00408"></a>00408             }
<a name="l00409"></a>00409         }
<a name="l00410"></a>00410         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([l isKindOfClass:[<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> <span class="keyword">class</span>]] &amp;&amp; [l compoundPredicateType] == <a class="code" href="_c_p_compound_predicate_8j.html#aacd3c3aa70711bc73f82175b39341ddb">CPOrPredicateType</a>)
<a name="l00411"></a>00411         {
<a name="l00412"></a>00412             [[l subpredicates] addObject:r];
<a name="l00413"></a>00413         }
<a name="l00414"></a>00414         <span class="keywordflow">else</span>
<a name="l00415"></a>00415         {
<a name="l00416"></a>00416             l = [<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> <a class="code" href="interface_c_p_compound_predicate.html#a9ce8d720ec94792317366c51ee4ab27c">orPredicateWithSubpredicates</a>:[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#ad27bec32a9288edb5e9c6e83d2e5e8ad">arrayWithObjects</a>:l, r]];
<a name="l00417"></a>00417         }
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419     <span class="keywordflow">return</span> l;
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 - (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)parseComparison
<a name="l00423"></a>00423 {
<a name="l00424"></a>00424     var modifier = <a class="code" href="_c_p_comparison_predicate_8j.html#a6ab35349aa74d616b383d93c178766b4">CPDirectPredicateModifier</a>,
<a name="l00425"></a>00425         type = 0,
<a name="l00426"></a>00426         opts = 0,
<a name="l00427"></a>00427         left,
<a name="l00428"></a>00428         right,
<a name="l00429"></a>00429         p,
<a name="l00430"></a>00430         negate = NO;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;ANY&quot;</span>])
<a name="l00433"></a>00433     {
<a name="l00434"></a>00434         modifier = <a class="code" href="_c_p_comparison_predicate_8j.html#a3f61ca8a65288db39e9a57a1a2aef177">CPAnyPredicateModifier</a>;
<a name="l00435"></a>00435     }
<a name="l00436"></a>00436     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;ALL&quot;</span>])
<a name="l00437"></a>00437     {
<a name="l00438"></a>00438         modifier = <a class="code" href="_c_p_comparison_predicate_8j.html#a5555a15f1140588eb23178e96a21bc2f">CPAllPredicateModifier</a>;
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;NONE&quot;</span>])
<a name="l00441"></a>00441     {
<a name="l00442"></a>00442         modifier = <a class="code" href="_c_p_comparison_predicate_8j.html#a3f61ca8a65288db39e9a57a1a2aef177">CPAnyPredicateModifier</a>;
<a name="l00443"></a>00443         negate = YES;
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;SOME&quot;</span>])
<a name="l00446"></a>00446     {
<a name="l00447"></a>00447         modifier = <a class="code" href="_c_p_comparison_predicate_8j.html#a5555a15f1140588eb23178e96a21bc2f">CPAllPredicateModifier</a>;
<a name="l00448"></a>00448         negate = YES;
<a name="l00449"></a>00449     }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     left = [<span class="keyword">self</span> parseExpression];
<a name="l00452"></a>00452     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;!=&quot;</span> intoString:NULL] || [<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;&lt;&gt;&quot;</span> intoString:NULL])
<a name="l00453"></a>00453     {
<a name="l00454"></a>00454         type = <a class="code" href="_c_p_comparison_predicate_8j.html#a3db5461da354913731702d931320f086">CPNotEqualToPredicateOperatorType</a>;
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;&lt;=&quot;</span> intoString:NULL] || [<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;=&lt;&quot;</span> intoString:NULL])
<a name="l00457"></a>00457     {
<a name="l00458"></a>00458         type = <a class="code" href="_c_p_comparison_predicate_8j.html#a13a724316727993b35c1060607cead0c">CPLessThanOrEqualToPredicateOperatorType</a>;
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;&gt;=&quot;</span> intoString:NULL] || [<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;=&gt;&quot;</span> intoString:NULL])
<a name="l00461"></a>00461     {
<a name="l00462"></a>00462         type = <a class="code" href="_c_p_comparison_predicate_8j.html#a6873ae59bc51395f90d67f3d87adbd9b">CPGreaterThanOrEqualToPredicateOperatorType</a>;
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;&lt;&quot;</span> intoString:NULL])
<a name="l00465"></a>00465     {
<a name="l00466"></a>00466         type = <a class="code" href="_c_p_comparison_predicate_8j.html#ae37df3f1e6e373340a76f077e56ecc92">CPLessThanPredicateOperatorType</a>;
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;&gt;&quot;</span> intoString:NULL])
<a name="l00469"></a>00469     {
<a name="l00470"></a>00470         type = <a class="code" href="_c_p_comparison_predicate_8j.html#a7374c0a69de783f99a5aa15e1d11c9c9">CPGreaterThanPredicateOperatorType</a>;
<a name="l00471"></a>00471     }
<a name="l00472"></a>00472     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;==&quot;</span> intoString:NULL] || [<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;=&quot;</span> intoString:NULL])
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474         type = <a class="code" href="_c_p_comparison_predicate_8j.html#aea215b89eadd40cd84d599231cd97de6">CPEqualToPredicateOperatorType</a>;
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;MATCHES&quot;</span>])
<a name="l00477"></a>00477     {
<a name="l00478"></a>00478         type = <a class="code" href="_c_p_comparison_predicate_8j.html#a2bcc9c62fa905086707805f1c559f436">CPMatchesPredicateOperatorType</a>;
<a name="l00479"></a>00479     }
<a name="l00480"></a>00480     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;LIKE&quot;</span>])
<a name="l00481"></a>00481     {
<a name="l00482"></a>00482         type = <a class="code" href="_c_p_comparison_predicate_8j.html#a30c57812f6146a1c26533ea86d6cc8d4">CPLikePredicateOperatorType</a>;
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;BEGINSWITH&quot;</span>])
<a name="l00485"></a>00485     {
<a name="l00486"></a>00486         type = <a class="code" href="_c_p_comparison_predicate_8j.html#a1aef901c110525adae1c9318124b4e24">CPBeginsWithPredicateOperatorType</a>;
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;ENDSWITH&quot;</span>])
<a name="l00489"></a>00489     {
<a name="l00490"></a>00490         type = <a class="code" href="_c_p_comparison_predicate_8j.html#a8e10c3f2b8e92522870d95eabefae056">CPEndsWithPredicateOperatorType</a>;
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;IN&quot;</span>])
<a name="l00493"></a>00493     {
<a name="l00494"></a>00494         type = <a class="code" href="_c_p_comparison_predicate_8j.html#a063e9851e69c5c1bd42685cb12cd05a8">CPInPredicateOperatorType</a>;
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;CONTAINS&quot;</span>])
<a name="l00497"></a>00497     {
<a name="l00498"></a>00498         type = <a class="code" href="_c_p_comparison_predicate_8j.html#acb723b2a044b3f5e70b6f450e55702bb">CPContainsPredicateOperatorType</a>;
<a name="l00499"></a>00499     }
<a name="l00500"></a>00500     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;BETWEEN&quot;</span>])
<a name="l00501"></a>00501     {
<a name="l00502"></a>00502         type = <a class="code" href="_c_p_comparison_predicate_8j.html#aa7b0b9a758e28889f40512c6b1e50c1c">CPBetweenPredicateOperatorType</a>;
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504     <span class="keywordflow">else</span>
<a name="l00505"></a>00505         CPRaiseParseError(<span class="keyword">self</span>, <span class="stringliteral">@&quot;comparison predicate&quot;</span>);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;[cd]&quot;</span> intoString:NULL])
<a name="l00508"></a>00508     {
<a name="l00509"></a>00509         opts = <a class="code" href="_c_p_comparison_predicate_8j.html#ac2d5c571c4be2735cfbd937426da8495">CPCaseInsensitivePredicateOption</a> | <a class="code" href="_c_p_comparison_predicate_8j.html#a30ec5c20aa9a83d3128ae13aeecd56f1">CPDiacriticInsensitivePredicateOption</a>;
<a name="l00510"></a>00510     }
<a name="l00511"></a>00511     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;[c]&quot;</span> intoString:NULL])
<a name="l00512"></a>00512     {
<a name="l00513"></a>00513         opts = <a class="code" href="_c_p_comparison_predicate_8j.html#ac2d5c571c4be2735cfbd937426da8495">CPCaseInsensitivePredicateOption</a>;
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;[d]&quot;</span> intoString:NULL])
<a name="l00516"></a>00516     {
<a name="l00517"></a>00517         opts = <a class="code" href="_c_p_comparison_predicate_8j.html#a30ec5c20aa9a83d3128ae13aeecd56f1">CPDiacriticInsensitivePredicateOption</a>;
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     right = [<span class="keyword">self</span> parseExpression];
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     p = [<a class="code" href="interface_c_p_comparison_predicate.html" title="CPComparisonPredicate is a subclass of CPPredicate used to compare expressions.">CPComparisonPredicate</a> <a class="code" href="interface_c_p_comparison_predicate.html#a0fe06837ef0bdca7d956b5a3dbb106ff">predicateWithLeftExpression</a>:left
<a name="l00523"></a>00523          <a class="code" href="interface_c_p_comparison_predicate.html#a0fe06837ef0bdca7d956b5a3dbb106ff">rightExpression</a>:right
<a name="l00524"></a>00524          <a class="code" href="interface_c_p_comparison_predicate.html#a0fe06837ef0bdca7d956b5a3dbb106ff">modifier</a>:modifier
<a name="l00525"></a>00525          <a class="code" href="interface_c_p_comparison_predicate.html#a0fe06837ef0bdca7d956b5a3dbb106ff">type</a>:type
<a name="l00526"></a>00526          <a class="code" href="interface_c_p_comparison_predicate.html#a0fe06837ef0bdca7d956b5a3dbb106ff">options</a>:opts];
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     <span class="keywordflow">return</span> negate ? [<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> <a class="code" href="interface_c_p_compound_predicate.html#ae71ebcc2a60d30136b23aebb65f72eae">notPredicateWithSubpredicate</a>:p]:p;
<a name="l00529"></a>00529 }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 - (<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a>)parseExpression
<a name="l00532"></a>00532 {
<a name="l00533"></a>00533     <span class="keywordflow">return</span> [<span class="keyword">self</span> parseBinaryExpression];
<a name="l00534"></a>00534 }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 - (<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a>)parseSimpleExpression
<a name="l00537"></a>00537 {
<a name="l00538"></a>00538     var identifier,
<a name="l00539"></a>00539         location,
<a name="l00540"></a>00540         ident,
<a name="l00541"></a>00541         dbl;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanDouble:<a class="code" href="_c_p_predicate_8j.html#a6eb9bc549fadbea50a2b588b0dead97f">REFERENCE</a>(dbl)])
<a name="l00544"></a>00544         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#afeca5a125540fd3cca41184456679daa">expressionForConstantValue</a>:dbl];
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <span class="comment">// FIXME: handle integer, hex constants, 0x 0o 0b</span>
<a name="l00547"></a>00547     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;-&quot;</span> intoString:NULL])
<a name="l00548"></a>00548         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#a2e9b465551408d30880dd6dc1350c7f4">expressionForFunction</a>:@&quot;chs:&quot; <a class="code" href="interface_c_p_expression.html#a2e9b465551408d30880dd6dc1350c7f4">arguments</a>:[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#a75a09e8530bb9a8d7084f11df833674d">arrayWithObject</a>:[<span class="keyword">self</span> parseExpression]]];
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;(&quot;</span> intoString:NULL])
<a name="l00551"></a>00551     {
<a name="l00552"></a>00552         var arg = [<span class="keyword">self</span> parseExpression];
<a name="l00553"></a>00553 
<a name="l00554"></a>00554         <span class="keywordflow">if</span> (![<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;)&quot;</span> intoString:NULL])
<a name="l00555"></a>00555             CPRaiseParseError(<span class="keyword">self</span>, <span class="stringliteral">@&quot;expression&quot;</span>);
<a name="l00556"></a>00556 
<a name="l00557"></a>00557         <span class="keywordflow">return</span> arg;
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;{&quot;</span> intoString:NULL])
<a name="l00561"></a>00561     {
<a name="l00562"></a>00562         <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;}&quot;</span> intoString:NULL])
<a name="l00563"></a>00563             <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#afeca5a125540fd3cca41184456679daa">expressionForConstantValue</a>:a];
<a name="l00564"></a>00564 
<a name="l00565"></a>00565         var a = [];
<a name="l00566"></a>00566 
<a name="l00567"></a>00567         [a addObject:[<span class="keyword">self</span> parseExpression]];
<a name="l00568"></a>00568 
<a name="l00569"></a>00569         <span class="keywordflow">while</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;,&quot;</span> intoString:NULL])
<a name="l00570"></a>00570             [a addObject:[<span class="keyword">self</span> parseExpression]];
<a name="l00571"></a>00571 
<a name="l00572"></a>00572         <span class="keywordflow">if</span> (![<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;}&quot;</span> intoString:NULL])
<a name="l00573"></a>00573             CPRaiseParseError(<span class="keyword">self</span>, <span class="stringliteral">@&quot;expression&quot;</span>);
<a name="l00574"></a>00574 
<a name="l00575"></a>00575         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#a6e809195e118855b4b5d26bcc78bc60d">expressionForAggregate</a>:a];
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;NULL&quot;</span>] || [<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;NIL&quot;</span>])
<a name="l00579"></a>00579     {
<a name="l00580"></a>00580         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#afeca5a125540fd3cca41184456679daa">expressionForConstantValue</a>:[<a class="code" href="class_c_p_null.html" title="An object representation of nil.">CPNull</a> <a class="code" href="class_c_p_null.html#a589123ee618828f2e89a5776409e1592">null</a>]];
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;TRUE&quot;</span>] || [<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;YES&quot;</span>])
<a name="l00583"></a>00583     {
<a name="l00584"></a>00584         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#afeca5a125540fd3cca41184456679daa">expressionForConstantValue</a>:[<a class="code" href="interface_c_p_number.html" title="A bridged object to native Javascript numbers.">CPNumber</a> <a class="code" href="interface_c_p_number.html#a0753261344c84aa79c6ba87b170cabd3">numberWithBool</a>:YES]];
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;FALSE&quot;</span>] || [<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;NO&quot;</span>])
<a name="l00587"></a>00587     {
<a name="l00588"></a>00588         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#afeca5a125540fd3cca41184456679daa">expressionForConstantValue</a>:[<a class="code" href="interface_c_p_number.html" title="A bridged object to native Javascript numbers.">CPNumber</a> <a class="code" href="interface_c_p_number.html#a0753261344c84aa79c6ba87b170cabd3">numberWithBool</a>:NO]];
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanPredicateKeyword:<span class="stringliteral">@&quot;SELF&quot;</span>])
<a name="l00591"></a>00591     {
<a name="l00592"></a>00592         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#ac43adda5dc58144b3a42f05e7bc6437a">expressionForEvaluatedObject</a>];
<a name="l00593"></a>00593     }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;$&quot;</span> intoString:NULL])
<a name="l00596"></a>00596     {
<a name="l00597"></a>00597         var variable = [<span class="keyword">self</span> parseSimpleExpression];
<a name="l00598"></a>00598 
<a name="l00599"></a>00599         <span class="keywordflow">if</span> (![variable keyPath])
<a name="l00600"></a>00600             CPRaiseParseError(<span class="keyword">self</span>, <span class="stringliteral">@&quot;expression&quot;</span>);
<a name="l00601"></a>00601 
<a name="l00602"></a>00602         <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#acbb1fdd8cd5d9165baec21048e7f36cc">expressionForVariable</a>:variable];
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     location = [<span class="keyword">self</span> scanLocation];
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;%&quot;</span> intoString:NULL])
<a name="l00608"></a>00608     {
<a name="l00609"></a>00609         <span class="keywordflow">if</span> ([<span class="keyword">self</span> isAtEnd] == NO)
<a name="l00610"></a>00610         {
<a name="l00611"></a>00611             var c = [[<span class="keyword">self</span> string] characterAtIndex:[<span class="keyword">self</span> scanLocation]];
<a name="l00612"></a>00612 
<a name="l00613"></a>00613             <span class="keywordflow">switch</span> (c)
<a name="l00614"></a>00614             {
<a name="l00615"></a>00615                 <span class="keywordflow">case</span> <span class="charliteral">&#39;%&#39;</span>:<span class="comment">// &#39;%%&#39; is treated as &#39;%&#39;</span>
<a name="l00616"></a>00616                     location = [<span class="keyword">self</span> scanLocation];
<a name="l00617"></a>00617                     <span class="keywordflow">break</span>;
<a name="l00618"></a>00618                 <span class="keywordflow">case</span> <span class="charliteral">&#39;K&#39;</span>:
<a name="l00619"></a>00619                     [<span class="keyword">self</span> setScanLocation:[<span class="keyword">self</span> scanLocation] + 1];
<a name="l00620"></a>00620                     <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#a3a7898165973534a367c2faadb811150">expressionForKeyPath</a>:[<span class="keyword">self</span> nextArg]];
<a name="l00621"></a>00621                 <span class="keywordflow">case</span> <span class="charliteral">&#39;@&#39;</span>:
<a name="l00622"></a>00622                 <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:
<a name="l00623"></a>00623                 <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:
<a name="l00624"></a>00624                 <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:
<a name="l00625"></a>00625                 <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:
<a name="l00626"></a>00626                 <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:
<a name="l00627"></a>00627                 <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:
<a name="l00628"></a>00628                 <span class="keywordflow">case</span> <span class="charliteral">&#39;O&#39;</span>:
<a name="l00629"></a>00629                 <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>:
<a name="l00630"></a>00630                 <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:
<a name="l00631"></a>00631                 <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:
<a name="l00632"></a>00632                 <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>:
<a name="l00633"></a>00633                 <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:
<a name="l00634"></a>00634                 <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>:
<a name="l00635"></a>00635                 <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:
<a name="l00636"></a>00636                 <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:
<a name="l00637"></a>00637                 <span class="keywordflow">case</span> <span class="charliteral">&#39;G&#39;</span>:
<a name="l00638"></a>00638                     [<span class="keyword">self</span> setScanLocation:[<span class="keyword">self</span> scanLocation] + 1];
<a name="l00639"></a>00639                     <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#afeca5a125540fd3cca41184456679daa">expressionForConstantValue</a>:[<span class="keyword">self</span> nextArg]];
<a name="l00640"></a>00640                 <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:
<a name="l00641"></a>00641                     [<span class="keyword">self</span> scanString:@&quot;h&quot; intoString:NULL];
<a name="l00642"></a>00642                     <span class="keywordflow">if</span> ([<span class="keyword">self</span> isAtEnd] == NO)
<a name="l00643"></a>00643                     {
<a name="l00644"></a>00644                         c = [[<span class="keyword">self</span> string] characterAtIndex:[<span class="keyword">self</span> scanLocation]];
<a name="l00645"></a>00645                         <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;i&#39;</span> || c == <span class="charliteral">&#39;u&#39;</span>)
<a name="l00646"></a>00646                         {
<a name="l00647"></a>00647                             [<span class="keyword">self</span> setScanLocation:[<span class="keyword">self</span> scanLocation] + 1];
<a name="l00648"></a>00648                             <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#afeca5a125540fd3cca41184456679daa">expressionForConstantValue</a>:[<span class="keyword">self</span> nextArg]];
<a name="l00649"></a>00649                         }
<a name="l00650"></a>00650                     }
<a name="l00651"></a>00651                     <span class="keywordflow">break</span>;
<a name="l00652"></a>00652                 <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:
<a name="l00653"></a>00653                     [<span class="keyword">self</span> scanString:@&quot;q&quot; intoString:NULL];
<a name="l00654"></a>00654                     <span class="keywordflow">if</span> ([<span class="keyword">self</span> isAtEnd] == NO)
<a name="l00655"></a>00655                     {
<a name="l00656"></a>00656                         c = [[<span class="keyword">self</span> string] characterAtIndex:[<span class="keyword">self</span> scanLocation]];
<a name="l00657"></a>00657                         <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;i&#39;</span> || c == <span class="charliteral">&#39;u&#39;</span> || c == <span class="charliteral">&#39;x&#39;</span> || c == <span class="charliteral">&#39;X&#39;</span>)
<a name="l00658"></a>00658                         {
<a name="l00659"></a>00659                             [<span class="keyword">self</span> setScanLocation:[<span class="keyword">self</span> scanLocation] + 1];
<a name="l00660"></a>00660                             <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_expression.html" title="CPExpression is used to represent expressions in a predicate.">CPExpression</a> <a class="code" href="interface_c_p_expression.html#afeca5a125540fd3cca41184456679daa">expressionForConstantValue</a>:[<span class="keyword">self</span> nextArg]];
<a name="l00661"></a>00661                         }
<a name="l00662"></a>00662                     }
<a name="l00663"></a>00663                     <span class="keywordflow">break</span>;
<a name="l00664"></a>00664             }
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667         [<span class="keyword">self</span> setScanLocation:location];
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;\&quot;&quot; intoString:NULL])</span>
<a name="l00671"></a>00671 <span class="stringliteral">    {</span>
<a name="l00672"></a>00672 <span class="stringliteral">        var skip = [self charactersToBeSkipped],</span>
<a name="l00673"></a>00673 <span class="stringliteral">            str = @&quot;&quot;;</span>
<a name="l00674"></a>00674 <span class="stringliteral"></span>
<a name="l00675"></a>00675 <span class="stringliteral">        [self setCharactersToBeSkipped:nil];</span>
<a name="l00676"></a>00676 <span class="stringliteral">        [self scanUpToString:@&quot;</span>\<span class="stringliteral">&quot;&quot;</span> intoString:<a class="code" href="_c_p_predicate_8j.html#a6eb9bc549fadbea50a2b588b0dead97f">REFERENCE</a>(str)];
<a name="l00677"></a>00677 
<a name="l00678"></a>00678         <span class="keywordflow">if</span> ([<span class="keyword">self</span> scanString:<span class="stringliteral">@&quot;\&quot;&quot; intoString:NULL] == NO)</span>
<a name="l00679"></a>00679 <span class="stringliteral">            CPRaiseParseError(self, @&quot;</span>expression<span class="stringliteral">&quot;);</span>
<a name="l00680"></a>00680 <span class="stringliteral"></span>
<a name="l00681"></a>00681 <span class="stringliteral">        [self setCharactersToBeSkipped:skip];</span>
<a name="l00682"></a>00682 <span class="stringliteral"></span>
<a name="l00683"></a>00683 <span class="stringliteral">        return [CPExpression expressionForConstantValue:str];</span>
<a name="l00684"></a>00684 <span class="stringliteral">    }</span>
<a name="l00685"></a>00685 <span class="stringliteral"></span>
<a name="l00686"></a>00686 <span class="stringliteral">    if ([self scanString:@&quot;</span><span class="stringliteral">&#39;&quot; intoString:NULL])</span>
<a name="l00687"></a>00687 <span class="stringliteral">    {</span>
<a name="l00688"></a>00688 <span class="stringliteral">        var skip = [self charactersToBeSkipped],</span>
<a name="l00689"></a>00689 <span class="stringliteral">            str = @&quot;&quot;;</span>
<a name="l00690"></a>00690 <span class="stringliteral"></span>
<a name="l00691"></a>00691 <span class="stringliteral">        [self setCharactersToBeSkipped:nil];</span>
<a name="l00692"></a>00692 <span class="stringliteral">        [self scanUpToString:@&quot;&#39;</span><span class="stringliteral">&quot; intoString:REFERENCE(str)];</span>
<a name="l00693"></a>00693 <span class="stringliteral"></span>
<a name="l00694"></a>00694 <span class="stringliteral">        if ([self scanString:@&quot;</span><span class="stringliteral">&#39;&quot; intoString:NULL] == NO)</span>
<a name="l00695"></a>00695 <span class="stringliteral">            CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00696"></a>00696 <span class="stringliteral"></span>
<a name="l00697"></a>00697 <span class="stringliteral">        [self setCharactersToBeSkipped:skip];</span>
<a name="l00698"></a>00698 <span class="stringliteral"></span>
<a name="l00699"></a>00699 <span class="stringliteral">        return [CPExpression expressionForConstantValue:str];</span>
<a name="l00700"></a>00700 <span class="stringliteral">    }</span>
<a name="l00701"></a>00701 <span class="stringliteral"></span>
<a name="l00702"></a>00702 <span class="stringliteral">    if ([self scanString:@&quot;@&quot; intoString:NULL])</span>
<a name="l00703"></a>00703 <span class="stringliteral">    {</span>
<a name="l00704"></a>00704 <span class="stringliteral">        var e = [self parseExpression];</span>
<a name="l00705"></a>00705 <span class="stringliteral"></span>
<a name="l00706"></a>00706 <span class="stringliteral">        if (![e keyPath])</span>
<a name="l00707"></a>00707 <span class="stringliteral">            CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00708"></a>00708 <span class="stringliteral"></span>
<a name="l00709"></a>00709 <span class="stringliteral">        return [CPExpression expressionForKeyPath:[e keyPath] + &quot;@&quot;];</span>
<a name="l00710"></a>00710 <span class="stringliteral">    }</span>
<a name="l00711"></a>00711 <span class="stringliteral"></span>
<a name="l00712"></a>00712 <span class="stringliteral">    if ([self scanString:@&quot;SUBQUERY&quot; intoString:NULL])</span>
<a name="l00713"></a>00713 <span class="stringliteral">    {</span>
<a name="l00714"></a>00714 <span class="stringliteral">        if (![self scanString:@&quot;(&quot; intoString:NULL])</span>
<a name="l00715"></a>00715 <span class="stringliteral">            CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00716"></a>00716 <span class="stringliteral"></span>
<a name="l00717"></a>00717 <span class="stringliteral">        var collection = [self parseExpression],</span>
<a name="l00718"></a>00718 <span class="stringliteral">            variableExpression,</span>
<a name="l00719"></a>00719 <span class="stringliteral">            subpredicate;</span>
<a name="l00720"></a>00720 <span class="stringliteral"></span>
<a name="l00721"></a>00721 <span class="stringliteral">        if (![self scanString:@&quot;,&quot; intoString:NULL])</span>
<a name="l00722"></a>00722 <span class="stringliteral">            CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00723"></a>00723 <span class="stringliteral">        variableExpression = [self parseExpression];</span>
<a name="l00724"></a>00724 <span class="stringliteral"></span>
<a name="l00725"></a>00725 <span class="stringliteral">        if (![self scanString:@&quot;,&quot; intoString:NULL])</span>
<a name="l00726"></a>00726 <span class="stringliteral">            CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00727"></a>00727 <span class="stringliteral">        subpredicate = [self parsePredicate];</span>
<a name="l00728"></a>00728 <span class="stringliteral"></span>
<a name="l00729"></a>00729 <span class="stringliteral">        if (![self scanString:@&quot;)&quot; intoString:NULL])</span>
<a name="l00730"></a>00730 <span class="stringliteral">            CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00731"></a>00731 <span class="stringliteral"></span>
<a name="l00732"></a>00732 <span class="stringliteral">        return [[CPExpression_subquery alloc] initWithExpression:collection usingIteratorExpression:variableExpression predicate:subpredicate];</span>
<a name="l00733"></a>00733 <span class="stringliteral">    }</span>
<a name="l00734"></a>00734 <span class="stringliteral"></span>
<a name="l00735"></a>00735 <span class="stringliteral">    if ([self scanString:@&quot;FUNCTION&quot; intoString:NULL])</span>
<a name="l00736"></a>00736 <span class="stringliteral">    {</span>
<a name="l00737"></a>00737 <span class="stringliteral">        if (![self scanString:@&quot;(&quot; intoString:NULL])</span>
<a name="l00738"></a>00738 <span class="stringliteral">            CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00739"></a>00739 <span class="stringliteral"></span>
<a name="l00740"></a>00740 <span class="stringliteral">        var args = [CPArray arrayWithObject:[self parseExpression]];</span>
<a name="l00741"></a>00741 <span class="stringliteral">        while ([self scanString:@&quot;,&quot; intoString:NULL])</span>
<a name="l00742"></a>00742 <span class="stringliteral">            [args addObject:[self parseExpression]];</span>
<a name="l00743"></a>00743 <span class="stringliteral"></span>
<a name="l00744"></a>00744 <span class="stringliteral">        if (![self scanString:@&quot;)&quot; intoString:NULL] || [args count] &lt; 2 || [args[1] expressionType] != CPConstantValueExpressionType)</span>
<a name="l00745"></a>00745 <span class="stringliteral">            CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00746"></a>00746 <span class="stringliteral"></span>
<a name="l00747"></a>00747 <span class="stringliteral">         return [CPExpression expressionForFunction:args[0] selectorName:[args[1] constantValue] arguments:args.slice(2)];</span>
<a name="l00748"></a>00748 <span class="stringliteral">    }</span>
<a name="l00749"></a>00749 <span class="stringliteral"></span>
<a name="l00750"></a>00750 <span class="stringliteral">    [self scanString:@&quot;#&quot; intoString:NULL];</span>
<a name="l00751"></a>00751 <span class="stringliteral">    if (!identifier)</span>
<a name="l00752"></a>00752 <span class="stringliteral">        identifier = [CPCharacterSet characterSetWithCharactersInString:@&quot;_$abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;];</span>
<a name="l00753"></a>00753 <span class="stringliteral"></span>
<a name="l00754"></a>00754 <span class="stringliteral">    if (![self scanCharactersFromSet:identifier intoString:REFERENCE(ident)])</span>
<a name="l00755"></a>00755 <span class="stringliteral">        CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00756"></a>00756 <span class="stringliteral"></span>
<a name="l00757"></a>00757 <span class="stringliteral">    return [CPExpression expressionForKeyPath:ident];</span>
<a name="l00758"></a>00758 <span class="stringliteral">}</span>
<a name="l00759"></a>00759 <span class="stringliteral"></span>
<a name="l00760"></a>00760 <span class="stringliteral">- (CPExpression)parseFunctionalExpression</span>
<a name="l00761"></a>00761 <span class="stringliteral">{</span>
<a name="l00762"></a>00762 <span class="stringliteral">    var left = [self parseSimpleExpression];</span>
<a name="l00763"></a>00763 <span class="stringliteral"></span>
<a name="l00764"></a>00764 <span class="stringliteral">    while (YES)</span>
<a name="l00765"></a>00765 <span class="stringliteral">    {</span>
<a name="l00766"></a>00766 <span class="stringliteral">        if ([self scanString:@&quot;.&quot; intoString:NULL])</span>
<a name="l00767"></a>00767 <span class="stringliteral">        {</span>
<a name="l00768"></a>00768 <span class="stringliteral">            var right = [self parseSimpleExpression],</span>
<a name="l00769"></a>00769 <span class="stringliteral">                expressionType = [right expressionType];</span>
<a name="l00770"></a>00770 <span class="stringliteral"></span>
<a name="l00771"></a>00771 <span class="stringliteral">            if (expressionType == CPKeyPathExpressionType)</span>
<a name="l00772"></a>00772 <span class="stringliteral">                left = [[CPExpression_keypath alloc] initWithOperand:left andKeyPath:[right keyPath]];</span>
<a name="l00773"></a>00773 <span class="stringliteral">            else if (expressionType == CPVariableExpressionType)</span>
<a name="l00774"></a>00774 <span class="stringliteral">                left = [CPExpression expressionForFunction:left selectorName:@&quot;valueForKey:&quot; arguments:[right]];</span>
<a name="l00775"></a>00775 <span class="stringliteral">            else</span>
<a name="l00776"></a>00776 <span class="stringliteral">                CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00777"></a>00777 <span class="stringliteral">        }</span>
<a name="l00778"></a>00778 <span class="stringliteral">        else if ([self scanString:@&quot;[&quot; intoString:NULL])</span>
<a name="l00779"></a>00779 <span class="stringliteral">        {</span>
<a name="l00780"></a>00780 <span class="stringliteral">            // index expression</span>
<a name="l00781"></a>00781 <span class="stringliteral">            if ([self scanPredicateKeyword:@&quot;FIRST&quot;])</span>
<a name="l00782"></a>00782 <span class="stringliteral">            {</span>
<a name="l00783"></a>00783 <span class="stringliteral">                left = [CPExpression expressionForFunction:@&quot;first:&quot; arguments:[CPArray arrayWithObject:left]];</span>
<a name="l00784"></a>00784 <span class="stringliteral">            }</span>
<a name="l00785"></a>00785 <span class="stringliteral">            else if ([self scanPredicateKeyword:@&quot;LAST&quot;])</span>
<a name="l00786"></a>00786 <span class="stringliteral">            {</span>
<a name="l00787"></a>00787 <span class="stringliteral">                left = [CPExpression expressionForFunction:@&quot;last:&quot; arguments:[CPArray arrayWithObject:left]];</span>
<a name="l00788"></a>00788 <span class="stringliteral">            }</span>
<a name="l00789"></a>00789 <span class="stringliteral">            else if ([self scanPredicateKeyword:@&quot;SIZE&quot;])</span>
<a name="l00790"></a>00790 <span class="stringliteral">            {</span>
<a name="l00791"></a>00791 <span class="stringliteral">                left = [CPExpression expressionForFunction:@&quot;count:&quot; arguments:[CPArray arrayWithObject:left]];</span>
<a name="l00792"></a>00792 <span class="stringliteral">            }</span>
<a name="l00793"></a>00793 <span class="stringliteral">            else</span>
<a name="l00794"></a>00794 <span class="stringliteral">            {</span>
<a name="l00795"></a>00795 <span class="stringliteral">                var index = [self parseExpression];</span>
<a name="l00796"></a>00796 <span class="stringliteral">                left = [CPExpression expressionForFunction:@&quot;fromObject:index:&quot; arguments:[CPArray arrayWithObjects:left, index]];</span>
<a name="l00797"></a>00797 <span class="stringliteral">            }</span>
<a name="l00798"></a>00798 <span class="stringliteral"></span>
<a name="l00799"></a>00799 <span class="stringliteral">            if (![self scanString:@&quot;]&quot; intoString:NULL])</span>
<a name="l00800"></a>00800 <span class="stringliteral">                CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00801"></a>00801 <span class="stringliteral">        }</span>
<a name="l00802"></a>00802 <span class="stringliteral">        else if ([self scanString:@&quot;:&quot; intoString:NULL])</span>
<a name="l00803"></a>00803 <span class="stringliteral">        {</span>
<a name="l00804"></a>00804 <span class="stringliteral">            // function - this parser allows for (max)(a, b, c) to be properly</span>
<a name="l00805"></a>00805 <span class="stringliteral">            // recognized and even (%K)(a, b, c) if %K evaluates to &quot;max&quot;</span>
<a name="l00806"></a>00806 <span class="stringliteral"></span>
<a name="l00807"></a>00807 <span class="stringliteral">            if (![left keyPath])</span>
<a name="l00808"></a>00808 <span class="stringliteral">                CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00809"></a>00809 <span class="stringliteral"></span>
<a name="l00810"></a>00810 <span class="stringliteral">            var selector = [left keyPath] + @&quot;:&quot;,</span>
<a name="l00811"></a>00811 <span class="stringliteral">                args = [];</span>
<a name="l00812"></a>00812 <span class="stringliteral"></span>
<a name="l00813"></a>00813 <span class="stringliteral">            if (![self scanString:@&quot;(&quot; intoString:NULL])</span>
<a name="l00814"></a>00814 <span class="stringliteral">            {</span>
<a name="l00815"></a>00815 <span class="stringliteral">                var str;</span>
<a name="l00816"></a>00816 <span class="stringliteral">                [self scanCharactersFromSet:[CPCharacterSet lowercaseLetterCharacterSet] intoString:REFERENCE(str)];</span>
<a name="l00817"></a>00817 <span class="stringliteral"></span>
<a name="l00818"></a>00818 <span class="stringliteral">                if (![self scanString:@&quot;:(&quot; intoString:NULL])</span>
<a name="l00819"></a>00819 <span class="stringliteral">                    CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00820"></a>00820 <span class="stringliteral"></span>
<a name="l00821"></a>00821 <span class="stringliteral">                selector += str + @&quot;:&quot;;</span>
<a name="l00822"></a>00822 <span class="stringliteral">            }</span>
<a name="l00823"></a>00823 <span class="stringliteral"></span>
<a name="l00824"></a>00824 <span class="stringliteral">            if (![self scanString:@&quot;)&quot; intoString:NULL])</span>
<a name="l00825"></a>00825 <span class="stringliteral">            {</span>
<a name="l00826"></a>00826 <span class="stringliteral">                [args addObject:[self parseExpression]];</span>
<a name="l00827"></a>00827 <span class="stringliteral">                while ([self scanString:@&quot;,&quot; intoString:NULL])</span>
<a name="l00828"></a>00828 <span class="stringliteral">                    [args addObject:[self parseExpression]];</span>
<a name="l00829"></a>00829 <span class="stringliteral"></span>
<a name="l00830"></a>00830 <span class="stringliteral">                if (![self scanString:@&quot;)&quot; intoString:NULL])</span>
<a name="l00831"></a>00831 <span class="stringliteral">                    CPRaiseParseError(self, @&quot;expression&quot;);</span>
<a name="l00832"></a>00832 <span class="stringliteral">            }</span>
<a name="l00833"></a>00833 <span class="stringliteral"></span>
<a name="l00834"></a>00834 <span class="stringliteral">            left = [CPExpression expressionForFunction:selector arguments:args];</span>
<a name="l00835"></a>00835 <span class="stringliteral">        }</span>
<a name="l00836"></a>00836 <span class="stringliteral">        else if ([self scanString:@&quot;UNION&quot; intoString:NULL])</span>
<a name="l00837"></a>00837 <span class="stringliteral">        {</span>
<a name="l00838"></a>00838 <span class="stringliteral">            left = [CPExpression expressionForUnionSet:left with:[self parseExpression]];</span>
<a name="l00839"></a>00839 <span class="stringliteral">        }</span>
<a name="l00840"></a>00840 <span class="stringliteral">        else if ([self scanString:@&quot;INTERSECT&quot; intoString:NULL])</span>
<a name="l00841"></a>00841 <span class="stringliteral">        {</span>
<a name="l00842"></a>00842 <span class="stringliteral">            left = [CPExpression expressionForIntersectSet:left with:[self parseExpression]];</span>
<a name="l00843"></a>00843 <span class="stringliteral">        }</span>
<a name="l00844"></a>00844 <span class="stringliteral">        else if ([self scanString:@&quot;MINUS&quot; intoString:NULL])</span>
<a name="l00845"></a>00845 <span class="stringliteral">        {</span>
<a name="l00846"></a>00846 <span class="stringliteral">            left = [CPExpression expressionForMinusSet:left with:[self parseExpression]];</span>
<a name="l00847"></a>00847 <span class="stringliteral">        }</span>
<a name="l00848"></a>00848 <span class="stringliteral">        else</span>
<a name="l00849"></a>00849 <span class="stringliteral">        {</span>
<a name="l00850"></a>00850 <span class="stringliteral">            // done with suffixes</span>
<a name="l00851"></a>00851 <span class="stringliteral">            return left;</span>
<a name="l00852"></a>00852 <span class="stringliteral">        }</span>
<a name="l00853"></a>00853 <span class="stringliteral">    }</span>
<a name="l00854"></a>00854 <span class="stringliteral">}</span>
<a name="l00855"></a>00855 <span class="stringliteral"></span>
<a name="l00856"></a>00856 <span class="stringliteral">- (CPExpression)parsePowerExpression</span>
<a name="l00857"></a>00857 <span class="stringliteral">{</span>
<a name="l00858"></a>00858 <span class="stringliteral">    var left = [self parseFunctionalExpression];</span>
<a name="l00859"></a>00859 <span class="stringliteral"></span>
<a name="l00860"></a>00860 <span class="stringliteral">    while (YES)</span>
<a name="l00861"></a>00861 <span class="stringliteral">    {</span>
<a name="l00862"></a>00862 <span class="stringliteral">        var right;</span>
<a name="l00863"></a>00863 <span class="stringliteral"></span>
<a name="l00864"></a>00864 <span class="stringliteral">        if ([self scanString:@&quot;**&quot; intoString:NULL])</span>
<a name="l00865"></a>00865 <span class="stringliteral">        {</span>
<a name="l00866"></a>00866 <span class="stringliteral">            right = [self parseFunctionalExpression];</span>
<a name="l00867"></a>00867 <span class="stringliteral">            left = [CPExpression expressionForFunction:@&quot;raise:to:&quot; arguments:[CPArray arrayWithObjects:left, right]];</span>
<a name="l00868"></a>00868 <span class="stringliteral">        }</span>
<a name="l00869"></a>00869 <span class="stringliteral">        else</span>
<a name="l00870"></a>00870 <span class="stringliteral">        {</span>
<a name="l00871"></a>00871 <span class="stringliteral">            return left;</span>
<a name="l00872"></a>00872 <span class="stringliteral">        }</span>
<a name="l00873"></a>00873 <span class="stringliteral">    }</span>
<a name="l00874"></a>00874 <span class="stringliteral">}</span>
<a name="l00875"></a>00875 <span class="stringliteral"></span>
<a name="l00876"></a>00876 <span class="stringliteral">- (CPExpression)parseMultiplicationExpression</span>
<a name="l00877"></a>00877 <span class="stringliteral">{</span>
<a name="l00878"></a>00878 <span class="stringliteral">    var left = [self parsePowerExpression];</span>
<a name="l00879"></a>00879 <span class="stringliteral"></span>
<a name="l00880"></a>00880 <span class="stringliteral">    while (YES)</span>
<a name="l00881"></a>00881 <span class="stringliteral">    {</span>
<a name="l00882"></a>00882 <span class="stringliteral">        var right;</span>
<a name="l00883"></a>00883 <span class="stringliteral"></span>
<a name="l00884"></a>00884 <span class="stringliteral">        if ([self scanString:@&quot;*&quot; intoString:NULL])</span>
<a name="l00885"></a>00885 <span class="stringliteral">        {</span>
<a name="l00886"></a>00886 <span class="stringliteral">            right = [self parsePowerExpression];</span>
<a name="l00887"></a>00887 <span class="stringliteral">            left = [CPExpression expressionForFunction:@&quot;multiply:by:&quot; arguments:[CPArray arrayWithObjects:left, right]];</span>
<a name="l00888"></a>00888 <span class="stringliteral">        }</span>
<a name="l00889"></a>00889 <span class="stringliteral">        else if ([self scanString:@&quot;/&quot; intoString:NULL])</span>
<a name="l00890"></a>00890 <span class="stringliteral">        {</span>
<a name="l00891"></a>00891 <span class="stringliteral">            right = [self parsePowerExpression];</span>
<a name="l00892"></a>00892 <span class="stringliteral">            left = [CPExpression expressionForFunction:@&quot;divide:by:&quot; arguments:[CPArray arrayWithObjects:left, right]];</span>
<a name="l00893"></a>00893 <span class="stringliteral">        }</span>
<a name="l00894"></a>00894 <span class="stringliteral">        else</span>
<a name="l00895"></a>00895 <span class="stringliteral">        {</span>
<a name="l00896"></a>00896 <span class="stringliteral">            return left;</span>
<a name="l00897"></a>00897 <span class="stringliteral">        }</span>
<a name="l00898"></a>00898 <span class="stringliteral">    }</span>
<a name="l00899"></a>00899 <span class="stringliteral">}</span>
<a name="l00900"></a>00900 <span class="stringliteral"></span>
<a name="l00901"></a>00901 <span class="stringliteral">- (CPExpression)parseAdditionExpression</span>
<a name="l00902"></a>00902 <span class="stringliteral">{</span>
<a name="l00903"></a>00903 <span class="stringliteral">    var left = [self parseMultiplicationExpression];</span>
<a name="l00904"></a>00904 <span class="stringliteral"></span>
<a name="l00905"></a>00905 <span class="stringliteral">    while (YES)</span>
<a name="l00906"></a>00906 <span class="stringliteral">    {</span>
<a name="l00907"></a>00907 <span class="stringliteral">        var right;</span>
<a name="l00908"></a>00908 <span class="stringliteral"></span>
<a name="l00909"></a>00909 <span class="stringliteral">        if ([self scanString:@&quot;+&quot; intoString:NULL])</span>
<a name="l00910"></a>00910 <span class="stringliteral">        {</span>
<a name="l00911"></a>00911 <span class="stringliteral">            right = [self parseMultiplicationExpression];</span>
<a name="l00912"></a>00912 <span class="stringliteral">            left = [CPExpression expressionForFunction:@&quot;add:to:&quot; arguments:[CPArray arrayWithObjects:left, right]];</span>
<a name="l00913"></a>00913 <span class="stringliteral">        }</span>
<a name="l00914"></a>00914 <span class="stringliteral">        else if ([self scanString:@&quot;-&quot; intoString:NULL])</span>
<a name="l00915"></a>00915 <span class="stringliteral">        {</span>
<a name="l00916"></a>00916 <span class="stringliteral">            right = [self parseMultiplicationExpression];</span>
<a name="l00917"></a>00917 <span class="stringliteral">            left = [CPExpression expressionForFunction:@&quot;from:substract:&quot; arguments:[CPArray arrayWithObjects:left, right]];</span>
<a name="l00918"></a>00918 <span class="stringliteral">        }</span>
<a name="l00919"></a>00919 <span class="stringliteral">        else</span>
<a name="l00920"></a>00920 <span class="stringliteral">        {</span>
<a name="l00921"></a>00921 <span class="stringliteral">            return left;</span>
<a name="l00922"></a>00922 <span class="stringliteral">        }</span>
<a name="l00923"></a>00923 <span class="stringliteral">    }</span>
<a name="l00924"></a>00924 <span class="stringliteral">}</span>
<a name="l00925"></a>00925 <span class="stringliteral"></span>
<a name="l00926"></a>00926 <span class="stringliteral">- (CPExpression)parseBinaryExpression</span>
<a name="l00927"></a>00927 <span class="stringliteral">{</span>
<a name="l00928"></a>00928 <span class="stringliteral">    var left = [self parseAdditionExpression];</span>
<a name="l00929"></a>00929 <span class="stringliteral"></span>
<a name="l00930"></a>00930 <span class="stringliteral">    while (YES)</span>
<a name="l00931"></a>00931 <span class="stringliteral">    {</span>
<a name="l00932"></a>00932 <span class="stringliteral">        var right;</span>
<a name="l00933"></a>00933 <span class="stringliteral"></span>
<a name="l00934"></a>00934 <span class="stringliteral">        if ([self scanString:@&quot;:=&quot; intoString:NULL])    // assignment</span>
<a name="l00935"></a>00935 <span class="stringliteral">        {</span>
<a name="l00936"></a>00936 <span class="stringliteral">            // check left to be a variable?</span>
<a name="l00937"></a>00937 <span class="stringliteral">            right = [self parseAdditionExpression];</span>
<a name="l00938"></a>00938 <span class="stringliteral">            // FIXME</span>
<a name="l00939"></a>00939 <span class="stringliteral">        }</span>
<a name="l00940"></a>00940 <span class="stringliteral">        else</span>
<a name="l00941"></a>00941 <span class="stringliteral">        {</span>
<a name="l00942"></a>00942 <span class="stringliteral">            return left;</span>
<a name="l00943"></a>00943 <span class="stringliteral">        }</span>
<a name="l00944"></a>00944 <span class="stringliteral">    }</span>
<a name="l00945"></a>00945 <span class="stringliteral">}</span>
<a name="l00946"></a>00946 <span class="stringliteral"></span>
<a name="l00947"></a>00947 <span class="stringliteral">@end</span>
<a name="l00948"></a>00948 <span class="stringliteral"></span>
<a name="l00949"></a>00949 <span class="stringliteral">var CPRaiseParseError = function CPRaiseParseError(aScanner, target)</span>
<a name="l00950"></a>00950 <span class="stringliteral">{</span>
<a name="l00951"></a>00951 <span class="stringliteral">    [CPException raise:CPInvalidArgumentException reason:@&quot;unable to parse &quot; + target + &quot; at index &quot; + [aScanner scanLocation]];</span>
<a name="l00952"></a>00952 <span class="stringliteral">}</span>
<a name="l00953"></a>00953 <span class="stringliteral"></span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_c_p_predicate_8j.html">CPPredicate.j</a>      </li>
      <li class="footer">Generated on Wed Nov 16 2011 17:34:43 for API by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>API: AppKit/CPRuleEditor/CPRuleEditor.j Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">API&#160;<span id="projectnumber">0.9.5</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_c_p_rule_editor_8j.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">AppKit/CPRuleEditor/CPRuleEditor.j</div>  </div>
</div>
<div class="contents">
<a href="_c_p_rule_editor_8j.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * CPRuleEditor.j</span>
<a name="l00003"></a>00003 <span class="comment"> * AppKit</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * Created by cacaodev.</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright 2011, cacaodev.</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
<a name="l00009"></a>00009 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00010"></a>00010 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00011"></a>00011 <span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00014"></a>00014 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00015"></a>00015 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<a name="l00016"></a>00016 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00019"></a>00019 <span class="comment"> * License along with this library; if not, write to the Free Software</span>
<a name="l00020"></a>00020 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="_c_p_rule_editor_8j.html#aed3be90c48f906464d8bb7e9c04b81c7">00025</a> <a class="code" href="_c_p_rule_editor_8j.html#aed3be90c48f906464d8bb7e9c04b81c7">CPRuleEditorPredicateLeftExpression</a>     = <span class="stringliteral">&quot;CPRuleEditorPredicateLeftExpression&quot;</span>;
<a name="l00026"></a><a class="code" href="_c_p_rule_editor_8j.html#a534b6bad58b61ccfc175eafaff9da4c3">00026</a> <a class="code" href="_c_p_rule_editor_8j.html#a534b6bad58b61ccfc175eafaff9da4c3">CPRuleEditorPredicateRightExpression</a>    = <span class="stringliteral">&quot;CPRuleEditorPredicateRightExpression&quot;</span>;
<a name="l00027"></a><a class="code" href="_c_p_rule_editor_8j.html#a8c07c0dd6039684b60fb216b71fbfd29">00027</a> <a class="code" href="_c_p_rule_editor_8j.html#a8c07c0dd6039684b60fb216b71fbfd29">CPRuleEditorPredicateComparisonModifier</a> = <span class="stringliteral">&quot;CPRuleEditorPredicateComparisonModifier&quot;</span>;
<a name="l00028"></a><a class="code" href="_c_p_rule_editor_8j.html#ad1dd79e067c42dbf7861bc590c4fa06a">00028</a> <a class="code" href="_c_p_rule_editor_8j.html#ad1dd79e067c42dbf7861bc590c4fa06a">CPRuleEditorPredicateOptions</a>            = <span class="stringliteral">&quot;CPRuleEditorPredicateOptions&quot;</span>;
<a name="l00029"></a><a class="code" href="_c_p_rule_editor_8j.html#aa7121818c97a0a6624473b4d4c7b6f49">00029</a> <a class="code" href="_c_p_rule_editor_8j.html#aa7121818c97a0a6624473b4d4c7b6f49">CPRuleEditorPredicateOperatorType</a>       = <span class="stringliteral">&quot;CPRuleEditorPredicateOperatorType&quot;</span>;
<a name="l00030"></a><a class="code" href="_c_p_rule_editor_8j.html#aa470c0bcaa9f333e73a0cdc688b37e0a">00030</a> <a class="code" href="_c_p_rule_editor_8j.html#aa470c0bcaa9f333e73a0cdc688b37e0a">CPRuleEditorPredicateCustomSelector</a>     = <span class="stringliteral">&quot;CPRuleEditorPredicateCustomSelector&quot;</span>;
<a name="l00031"></a><a class="code" href="_c_p_rule_editor_8j.html#a964f8215089b0b165feb9cf3bc460873">00031</a> <a class="code" href="_c_p_rule_editor_8j.html#a964f8215089b0b165feb9cf3bc460873">CPRuleEditorPredicateCompoundType</a>       = <span class="stringliteral">&quot;CPRuleEditorPredicateCompoundType&quot;</span>;
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="_c_p_rule_editor_8j.html#ada297b1fe94db6efbf90baf48fb52b86">00033</a> <a class="code" href="_c_p_rule_editor_8j.html#ada297b1fe94db6efbf90baf48fb52b86">CPRuleEditorRowsDidChangeNotification</a>   = <span class="stringliteral">&quot;CPRuleEditorRowsDidChangeNotification&quot;</span>;
<a name="l00034"></a><a class="code" href="_c_p_rule_editor_8j.html#ac89cbb2fbc1b343b23b5f27b59944b9f">00034</a> <a class="code" href="_c_p_rule_editor_8j.html#ac89cbb2fbc1b343b23b5f27b59944b9f">CPRuleEditorRulesDidChangeNotification</a>  = <span class="stringliteral">&quot;CPRuleEditorRulesDidChangeNotification&quot;</span>;
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="_c_p_rule_editor_8j.html#ae08c736e778a1a4411ebcef390bfb791">00036</a> <a class="code" href="_c_p_rule_editor_8j.html#ae08c736e778a1a4411ebcef390bfb791">CPRuleEditorNestingModeSingle</a>   = 0;        <span class="comment">// Only a single row is allowed.  Plus/minus buttons will not be shown</span>
<a name="l00037"></a><a class="code" href="_c_p_rule_editor_8j.html#abc68a04af6ac9e1280f2087c8e9d3e2f">00037</a> <a class="code" href="_c_p_rule_editor_8j.html#abc68a04af6ac9e1280f2087c8e9d3e2f">CPRuleEditorNestingModeList</a>     = 1;        <span class="comment">// Allows a single list, with no nesting and no compound rows</span>
<a name="l00038"></a><a class="code" href="_c_p_rule_editor_8j.html#a2a2a2daaeed7ae8098015683fbe9a8cd">00038</a> <a class="code" href="_c_p_rule_editor_8j.html#a2a2a2daaeed7ae8098015683fbe9a8cd">CPRuleEditorNestingModeCompound</a> = 2;        <span class="comment">// Unlimited nesting and compound rows; this is the default</span>
<a name="l00039"></a><a class="code" href="_c_p_rule_editor_8j.html#a6e943a157b214510f90ee395c7c5f246">00039</a> <a class="code" href="_c_p_rule_editor_8j.html#a6e943a157b214510f90ee395c7c5f246">CPRuleEditorNestingModeSimple</a>   = 3;        <span class="comment">// One compound row at the top with subrows beneath it, and no further nesting allowed</span>
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="_c_p_rule_editor_8j.html#a597f976009fd1e7d8af2a9e90901fb14">00041</a> <a class="code" href="_c_p_rule_editor_8j.html#a597f976009fd1e7d8af2a9e90901fb14">CPRuleEditorRowTypeSimple</a>       = 0;
<a name="l00042"></a><a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">00042</a> <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a>     = 1;
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="_c_p_rule_editor_8j.html#a981011b9de400af569604e903c3a05a7">00044</a> var <a class="code" href="_c_p_rule_editor_8j.html#a981011b9de400af569604e903c3a05a7">CPRuleEditorItemPBoardType</a>  = <span class="stringliteral">@&quot;CPRuleEditorItemPBoardType&quot;</span>;
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="_c_p_rule_editor_8j.html#a4f75c1ae12709156e424b601ca806c6e">00046</a> var <a class="code" href="_c_p_rule_editor_8j.html#a4f75c1ae12709156e424b601ca806c6e">itemsContext</a>                = <span class="stringliteral">&quot;items&quot;</span>,
<a name="l00047"></a><a class="code" href="_c_p_rule_editor_8j.html#a42fa15f29b9eab57eb3778f4ab02dfc2">00047</a>     <a class="code" href="_c_p_rule_editor_8j.html#a42fa15f29b9eab57eb3778f4ab02dfc2">valuesContext</a>               = <span class="stringliteral">&quot;values&quot;</span>,
<a name="l00048"></a><a class="code" href="_c_p_rule_editor_8j.html#a79dc5a73dd1ef67aa8ee8c953188cfee">00048</a>     <a class="code" href="_c_p_rule_editor_8j.html#a79dc5a73dd1ef67aa8ee8c953188cfee">subrowsContext</a>              = <span class="stringliteral">&quot;subrows_array&quot;</span>,
<a name="l00049"></a><a class="code" href="_c_p_rule_editor_8j.html#a8bff62fe6dcb4cc807b1a93164e5c46e">00049</a>     <a class="code" href="_c_p_rule_editor_8j.html#a8bff62fe6dcb4cc807b1a93164e5c46e">boundArrayContext</a>           = <span class="stringliteral">&quot;bound_array&quot;</span>;
<a name="l00050"></a>00050 
<a name="l00071"></a>00071 <span class="keyword">@implementation </span><a class="code" href="interface_c_p_rule_editor.html" title="A view for creating and configuring criteria.">CPRuleEditor</a> : <a class="code" href="interface_c_p_control.html">CPControl</a>
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073     BOOL             _suppressKeyDownHandling;
<a name="l00074"></a>00074     BOOL             _allowsEmptyCompoundRows;
<a name="l00075"></a>00075     BOOL             _disallowEmpty;
<a name="l00076"></a>00076     BOOL             _delegateWantsValidation;
<a name="l00077"></a>00077     BOOL             _editable;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     Class           _rowClass;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>      _draggingRows;
<a name="l00082"></a>00082     CPInteger       _subviewIndexOfDropLine;
<a name="l00083"></a>00083     <a class="code" href="interface_c_p_view.html">CPView</a>          _dropLineView;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a>  _rowCache;
<a name="l00086"></a>00086     <a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a>  _slices;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     <a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>     _predicate;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>        _itemsKeyPath;
<a name="l00091"></a>00091     <a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>        _subrowsArrayKeyPath;
<a name="l00092"></a>00092     <a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>        _typeKeyPath;
<a name="l00093"></a>00093     <a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>        _valuesKeyPath;
<a name="l00094"></a>00094     <a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>        _boundArrayKeyPath;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096     <a class="code" href="interface_c_p_view.html">CPView</a>          _slicesHolder;
<a name="l00097"></a>00097     <a class="code" href="interface_c_p_view_animation.html">CPViewAnimation</a> _currentAnimation;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     CPInteger       _lastRow;
<a name="l00100"></a>00100     CPInteger       _nestingMode;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="keywordtype">float</span>           _alignmentGridWidth;
<a name="l00103"></a>00103     <span class="keywordtype">float</span>           _sliceHeight;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="keywordtype">id</span>              _ruleDataSource;
<a name="l00106"></a>00106     <span class="keywordtype">id</span>              _ruleDelegate;
<a name="l00107"></a>00107     <span class="keywordtype">id</span>              _boundArrayOwner;
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     <a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>        _stringsFilename;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     BOOL            _isKeyDown;
<a name="l00112"></a>00112     BOOL            _nestingModeDidChange;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="keywordtype">id</span>              _standardLocalizer;
<a name="l00115"></a>00115     <span class="keywordtype">id</span>              _itemsAndValuesToAddForRowType;
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00120"></a>00120 + (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)defaultThemeClass
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122     <span class="keywordflow">return</span> <span class="stringliteral">@&quot;rule-editor&quot;</span>;
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 + (id)themeAttributes
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127     <span class="keywordflow">return</span> [<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a> <a class="code" href="interface_c_p_dictionary.html#ac4d7617692c892eaed4d00de281c4c83">dictionaryWithObjects</a>:[[<a class="code" href="class_c_p_null.html" title="An object representation of nil.">CPNull</a> <a class="code" href="class_c_p_null.html#a589123ee618828f2e89a5776409e1592">null</a>], [<a class="code" href="class_c_p_null.html" title="An object representation of nil.">CPNull</a> <a class="code" href="class_c_p_null.html#a589123ee618828f2e89a5776409e1592">null</a>], [<a class="code" href="class_c_p_null.html" title="An object representation of nil.">CPNull</a> <a class="code" href="class_c_p_null.html#a589123ee618828f2e89a5776409e1592">null</a>], [<a class="code" href="class_c_p_null.html" title="An object representation of nil.">CPNull</a> <a class="code" href="class_c_p_null.html#a589123ee618828f2e89a5776409e1592">null</a>], [<a class="code" href="class_c_p_null.html" title="An object representation of nil.">CPNull</a> <a class="code" href="class_c_p_null.html#a589123ee618828f2e89a5776409e1592">null</a>], [<a class="code" href="class_c_p_null.html" title="An object representation of nil.">CPNull</a> <a class="code" href="class_c_p_null.html#a589123ee618828f2e89a5776409e1592">null</a>], [<a class="code" href="class_c_p_null.html" title="An object representation of nil.">CPNull</a> <a class="code" href="class_c_p_null.html#a589123ee618828f2e89a5776409e1592">null</a>], [<a class="code" href="class_c_p_null.html" title="An object representation of nil.">CPNull</a> <a class="code" href="class_c_p_null.html#a589123ee618828f2e89a5776409e1592">null</a>]]
<a name="l00128"></a>00128                                        <a class="code" href="interface_c_p_dictionary.html#ac4d7617692c892eaed4d00de281c4c83">forKeys</a>:[@&quot;alternating-row-colors&quot;, @&quot;selected-color&quot;, @&quot;slice-top-border-color&quot;, @&quot;slice-bottom-border-color&quot;, @&quot;slice-last-bottom-border-color&quot;, @&quot;font&quot;, @&quot;add-image&quot;, @&quot;remove-image&quot;]];
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 - (id)initWithFrame:(CGRect)frame
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame];
<a name="l00134"></a>00134     <span class="keywordflow">if</span> (<span class="keyword">self</span> != nil)
<a name="l00135"></a>00135     {
<a name="l00136"></a>00136         _slices = [[<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#ab166355c18097850b848916cb4dd4b8b">alloc</a>] init];
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         _sliceHeight = 26.;
<a name="l00139"></a>00139         _nestingMode = <a class="code" href="_c_p_rule_editor_8j.html#a6e943a157b214510f90ee395c7c5f246">CPRuleEditorNestingModeSimple</a>; <span class="comment">// 10.5 default is CPRuleEditorNestingModeCompound</span>
<a name="l00140"></a>00140         _editable = YES;
<a name="l00141"></a>00141         _allowsEmptyCompoundRows = NO;
<a name="l00142"></a>00142         _disallowEmpty = NO;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144         [<span class="keyword">self</span> setCriteriaKeyPath:@&quot;criteria&quot;];
<a name="l00145"></a>00145         [<span class="keyword">self</span> setSubrowsKeyPath:@&quot;subrows&quot;];
<a name="l00146"></a>00146         [<span class="keyword">self</span> setRowTypeKeyPath:@&quot;rowType&quot;];
<a name="l00147"></a>00147         [<span class="keyword">self</span> setDisplayValuesKeyPath:@&quot;displayValues&quot;];
<a name="l00148"></a>00148         [<span class="keyword">self</span> setBoundArrayKeyPath:@&quot;boundArray&quot;];
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         _slicesHolder = [[_CPRuleEditorViewSliceHolder alloc] initWithFrame:[<span class="keyword">self</span> bounds]];
<a name="l00151"></a>00151         [<span class="keyword">self</span> addSubview:_slicesHolder];
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         _boundArrayOwner = [[_CPRuleEditorViewUnboundRowHolder alloc] init];
<a name="l00154"></a>00154 
<a name="l00155"></a>00155         [<span class="keyword">self</span> _initRuleEditorShared];
<a name="l00156"></a>00156     }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 - (void)_initRuleEditorShared
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163     _rowCache = [[<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#ab166355c18097850b848916cb4dd4b8b">alloc</a>] init];
<a name="l00164"></a>00164     _rowClass = [<a class="code" href="class_row_object.html">RowObject</a> class];
<a name="l00165"></a>00165     _isKeyDown = NO;
<a name="l00166"></a>00166     _subviewIndexOfDropLine = <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>;
<a name="l00167"></a>00167     _lastRow = 0;
<a name="l00168"></a>00168     _delegateWantsValidation = YES;
<a name="l00169"></a>00169     _suppressKeyDownHandling = NO;
<a name="l00170"></a>00170     _nestingModeDidChange = NO;
<a name="l00171"></a>00171     _itemsAndValuesToAddForRowType = {};
<a name="l00172"></a>00172     var animation = [[<a class="code" href="interface_c_p_view_animation.html">CPViewAnimation</a> alloc] initWithDuration:0.5 animationCurve:CPAnimationEaseInOut];
<a name="l00173"></a>00173     [<span class="keyword">self</span> setAnimation:animation];
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     [_slicesHolder setAutoresizingMask:CPViewWidthSizable | CPViewHeightSizable];
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     _dropLineView =  [<span class="keyword">self</span> _createSliceDropSeparator];
<a name="l00178"></a>00178     [_slicesHolder addSubview:_dropLineView];
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     [<span class="keyword">self</span> registerForDraggedTypes:[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#ad27bec32a9288edb5e9c6e83d2e5e8ad">arrayWithObjects</a>:CPRuleEditorItemPBoardType,nil]];
<a name="l00181"></a>00181     [_boundArrayOwner addObserver:self forKeyPath:_boundArrayKeyPath options:CPKeyValueObservingOptionOld|CPKeyValueObservingOptionNew context:boundArrayContext];
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00195"></a><a class="code" href="interface_c_p_rule_editor.html#ab0fe520d8dd618be6a4d3054030a5aff">00195</a> - (id)delegate
<a name="l00196"></a>00196 {
<a name="l00197"></a>00197      <span class="keywordflow">return</span> _ruleDelegate;
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00206"></a><a class="code" href="interface_c_p_rule_editor.html#ae19bfd9d885501af38f5a176cc53b364">00206</a> - (void)setDelegate:(<span class="keywordtype">id</span>)aDelegate
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208     <span class="keywordflow">if</span> (_ruleDelegate === aDelegate)
<a name="l00209"></a>00209         <span class="keywordflow">return</span>;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     var nc = [<a class="code" href="interface_c_p_notification_center.html" title="Sends messages (CPNotification) between objects.">CPNotificationCenter</a> <a class="code" href="interface_c_p_notification_center.html#a5abe725f1a1a48ac4cb1e45b6d9d50a8">defaultCenter</a>];
<a name="l00212"></a>00212     <span class="keywordflow">if</span> (_ruleDelegate)
<a name="l00213"></a>00213         [nc removeObserver:_ruleDelegate name:nil object:self];
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     _ruleDelegate = aDelegate;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="keywordflow">if</span> ([_ruleDelegate respondsToSelector:<span class="keyword">@selector</span>(ruleEditorRowsDidChange:)])
<a name="l00218"></a>00218         [nc addObserver:_ruleDelegate selector:@selector(ruleEditorRowsDidChange:) name:CPRuleEditorRowsDidChangeNotification object:nil];
<a name="l00219"></a>00219 }
<a name="l00226"></a><a class="code" href="interface_c_p_rule_editor.html#acfb7505c72699bbef5a295470d8ee9ae">00226</a> - (BOOL)isEditable
<a name="l00227"></a>00227 {
<a name="l00228"></a>00228     <span class="keywordflow">return</span> _editable;
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00236"></a><a class="code" href="interface_c_p_rule_editor.html#abc274fb42baf71317ec622a6e2b39d05">00236</a> - (void)setEditable:(BOOL)editable
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (editable == _editable)
<a name="l00239"></a>00239         <span class="keywordflow">return</span>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     _editable = editable;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (!_editable)
<a name="l00244"></a>00244         [<span class="keyword">self</span> _deselectAll];
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     [_slices makeObjectsPerformSelector:@selector(setEditable:) withObject:_editable];
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00254"></a><a class="code" href="interface_c_p_rule_editor.html#a4f3924389299bef20617f554b11c79e5">00254</a> - (CPRuleEditorNestingMode)nestingMode
<a name="l00255"></a>00255 {
<a name="l00256"></a>00256      <span class="keywordflow">return</span> _nestingMode;
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00266"></a><a class="code" href="interface_c_p_rule_editor.html#a675d4f35ffcf5805df0868798010696d">00266</a> - (void)setNestingMode:(CPRuleEditorNestingMode)mode
<a name="l00267"></a>00267 {
<a name="l00268"></a>00268     <span class="keywordflow">if</span> (mode != _nestingMode)
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270         _nestingMode = mode;
<a name="l00271"></a>00271         <span class="keywordflow">if</span> ([<span class="keyword">self</span> numberOfRows] &gt; 0)
<a name="l00272"></a>00272             _nestingModeDidChange = YES;
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00281"></a><a class="code" href="interface_c_p_rule_editor.html#a376ed93b597996c0fd14f515d8e81b8e">00281</a> - (BOOL)canRemoveAllRows
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283     <span class="keywordflow">return</span> !_disallowEmpty;
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00291"></a><a class="code" href="interface_c_p_rule_editor.html#a4cfddb1834c185f9b12867c8741332df">00291</a> - (void)setCanRemoveAllRows:(BOOL)canRemove
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293     _disallowEmpty = !canRemove;
<a name="l00294"></a>00294     [<span class="keyword">self</span> _updateButtonVisibilities];
<a name="l00295"></a>00295 }
<a name="l00296"></a>00296 
<a name="l00302"></a><a class="code" href="interface_c_p_rule_editor.html#af672676e9b65275753e8f70b58e3ada4">00302</a> - (BOOL)allowsEmptyCompoundRows
<a name="l00303"></a>00303 {
<a name="l00304"></a>00304     <span class="keywordflow">return</span> _allowsEmptyCompoundRows;
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00312"></a><a class="code" href="interface_c_p_rule_editor.html#a6adaf885b827356ea5855ca43436cf97">00312</a> - (void)setAllowsEmptyCompoundRows:(BOOL)allows
<a name="l00313"></a>00313 {
<a name="l00314"></a>00314     _allowsEmptyCompoundRows = allows;
<a name="l00315"></a>00315     [<span class="keyword">self</span> _updateButtonVisibilities];
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00323"></a><a class="code" href="interface_c_p_rule_editor.html#a36b65c5bd2211ea714b1b472f3e29868">00323</a> - (CPInteger)rowHeight
<a name="l00324"></a>00324 {
<a name="l00325"></a>00325     <span class="keywordflow">return</span> _sliceHeight;
<a name="l00326"></a>00326 }
<a name="l00327"></a>00327 
<a name="l00333"></a><a class="code" href="interface_c_p_rule_editor.html#a3a4b774adc3569c303f3217abbe1a551">00333</a> - (void)setRowHeight:(<span class="keywordtype">float</span>)height
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335     <span class="keywordflow">if</span> (height == _sliceHeight)
<a name="l00336"></a>00336         <span class="keywordflow">return</span>;
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     _sliceHeight = MAX([<span class="keyword">self</span> _minimumFrameHeight], height);
<a name="l00339"></a>00339     [<span class="keyword">self</span> _reconfigureSubviewsAnimate:NO];
<a name="l00340"></a>00340 }
<a name="l00341"></a>00341 
<a name="l00352"></a><a class="code" href="interface_c_p_rule_editor.html#a01739614d3a058b5927f9f5286b28111">00352</a> - (<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a>)formattingDictionary
<a name="l00353"></a>00353 {
<a name="l00354"></a>00354     <span class="keywordflow">return</span> [_standardLocalizer dictionary];
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00364"></a><a class="code" href="interface_c_p_rule_editor.html#a8806008e62153f264c7a32af5b855d47">00364</a> - (void)setFormattingDictionary:(<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a>)dictionary
<a name="l00365"></a>00365 {
<a name="l00366"></a>00366     [_standardLocalizer setDictionary:dictionary];
<a name="l00367"></a>00367     _stringsFilename = nil;
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00375"></a><a class="code" href="interface_c_p_rule_editor.html#ab19d14c9ce677cc933d43852e09cb674">00375</a> - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)formattingStringsFilename
<a name="l00376"></a>00376 {
<a name="l00377"></a>00377     <span class="keywordflow">return</span> _stringsFilename;
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00387"></a><a class="code" href="interface_c_p_rule_editor.html#abf7c4e09bbeb539a7df6c0434a896ece">00387</a> - (void)setFormattingStringsFilename:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)stringsFilename
<a name="l00388"></a>00388 {
<a name="l00389"></a>00389     <span class="comment">// Can we set _stringsFilename to nil in cocoa ?</span>
<a name="l00390"></a>00390     <span class="keywordflow">if</span> (_standardLocalizer == nil)
<a name="l00391"></a>00391         _standardLocalizer = [_CPRuleEditorLocalizer new];
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (_stringsFilename != stringsFilename)
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395         _stringsFilename = stringsFilename;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397         <span class="keywordflow">if</span> (stringsFilename !== nil)
<a name="l00398"></a>00398         {
<a name="l00399"></a>00399             <span class="keywordflow">if</span> (![stringsFilename hasSuffix:<span class="stringliteral">@&quot;.strings&quot;</span>])
<a name="l00400"></a>00400                 stringsFilename = stringsFilename + <span class="stringliteral">@&quot;.strings&quot;</span>;
<a name="l00401"></a>00401             var path = [[<a class="code" href="class_c_p_bundle.html" title="Groups information about an application&#39;s code &amp; resources.">CPBundle</a> <a class="code" href="class_c_p_bundle.html#a2f1b74bb845caded5d4d8a1309c7ff0e">mainBundle</a>] <a class="code" href="class_c_p_bundle.html#a09f6fb5fbe8e49ca2577b82af1c3ffa2">pathForResource</a>:stringsFilename];
<a name="l00402"></a>00402             <span class="keywordflow">if</span> (path !=nil)
<a name="l00403"></a>00403                 [_standardLocalizer loadContentOfURL:[<a class="code" href="interface_c_p_u_r_l.html">CPURL</a> <a class="code" href="interface_c_p_u_r_l.html#aa3eeb979789d9141888dccc3227eda01">URLWithString</a>:path]];
<a name="l00404"></a>00404         }
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 
<a name="l00416"></a><a class="code" href="interface_c_p_rule_editor.html#aec52b04c0235711e93ec3e9669793afb">00416</a> - (void)reloadCriteria
<a name="l00417"></a>00417 {
<a name="l00418"></a>00418     var current_rows = [_boundArrayOwner valueForKey:_boundArrayKeyPath];
<a name="l00419"></a>00419     [<span class="keyword">self</span> _stopObservingRowObjectsRecursively:current_rows];
<a name="l00420"></a>00420     [_boundArrayOwner setValue:[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#a4811e54ee87ec16819a86d24523308db">arrayWithArray</a>:current_rows] forKey:_boundArrayKeyPath];
<a name="l00421"></a>00421 }
<a name="l00422"></a>00422 
<a name="l00431"></a><a class="code" href="interface_c_p_rule_editor.html#abd2fa92df20dd94d12accf99a4d87b21">00431</a> - (void)setCriteria:(<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)criteria andDisplayValues:(<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)values forRowAtIndex:(<span class="keywordtype">int</span>)rowIndex
<a name="l00432"></a>00432 {
<a name="l00433"></a>00433 <span class="comment">// TODO: reload from the delegate if criteria is an empty array.</span>
<a name="l00434"></a>00434     <span class="keywordflow">if</span> (criteria == nil || values == nil)
<a name="l00435"></a>00435         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPInvalidArgumentException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:_cmd + @&quot;. criteria and values parameters must not be nil.&quot;];
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <span class="keywordflow">if</span> (rowIndex &lt; 0 || rowIndex &gt;= [<span class="keyword">self</span> numberOfRows])
<a name="l00438"></a>00438         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPRangeException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:_cmd + @&quot;. rowIndex is out of bounds.&quot;];
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     var rowObject = [[<span class="keyword">self</span> _rowCacheForIndex:rowIndex] rowObject];
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     [rowObject setValue:criteria forKey:_itemsKeyPath];
<a name="l00443"></a>00443     [rowObject setValue:values forKey:_valuesKeyPath];
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#aec52b04c0235711e93ec3e9669793afb" title="Instructs the receiver to refetch criteria from its delegate.  You can use this method to indicate th...">reloadCriteria</a>];
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 
<a name="l00453"></a><a class="code" href="interface_c_p_rule_editor.html#ad124d38ab7f4b2d2e25e2a6723cac9ba">00453</a> - (id)criteriaForRow:(<span class="keywordtype">int</span>)row
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455     var rowcache = [<span class="keyword">self</span> _rowCacheForIndex:row];
<a name="l00456"></a>00456     <span class="keywordflow">if</span> (rowcache)
<a name="l00457"></a>00457         <span class="keywordflow">return</span> [[rowcache rowObject] valueForKey:_itemsKeyPath];
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="keywordflow">return</span> nil;
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00472"></a><a class="code" href="interface_c_p_rule_editor.html#a59fa10ebad00a5863cc4754b228c1161">00472</a> - (<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a>)displayValuesForRow:(<span class="keywordtype">int</span>)row
<a name="l00473"></a>00473 {
<a name="l00474"></a>00474     var rowcache = [<span class="keyword">self</span> _rowCacheForIndex:row];
<a name="l00475"></a>00475     <span class="keywordflow">if</span> (rowcache)
<a name="l00476"></a>00476         <span class="keywordflow">return</span> [[rowcache rowObject] valueForKey:_valuesKeyPath];
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="keywordflow">return</span> nil;
<a name="l00479"></a>00479 }
<a name="l00480"></a>00480 
<a name="l00485"></a><a class="code" href="interface_c_p_rule_editor.html#ae04204db2d684515060528c21cbabde2">00485</a> - (int)numberOfRows
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487      <span class="keywordflow">return</span> [_slices count];
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00495"></a><a class="code" href="interface_c_p_rule_editor.html#ada5e29472142358ebe0ef104b57856f5">00495</a> - (int)parentRowForRow:(<span class="keywordtype">int</span>)rowIndex
<a name="l00496"></a>00496 {
<a name="l00497"></a>00497     <span class="keywordflow">if</span> (rowIndex &lt; 0 || rowIndex &gt;= [<span class="keyword">self</span> numberOfRows])
<a name="l00498"></a>00498         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPRangeException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:_cmd+@&quot; row &quot; + rowIndex + &quot; is out of range&quot;];
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     var targetObject = [[<span class="keyword">self</span> _rowCacheForIndex:rowIndex] rowObject];
<a name="l00501"></a>00501 
<a name="l00502"></a>00502     <span class="keywordflow">for</span> (var current_index = 0; current_index &lt; rowIndex; current_index++)
<a name="l00503"></a>00503     {
<a name="l00504"></a>00504         <span class="keywordflow">if</span> ([<span class="keyword">self</span> rowTypeForRow:current_index] == <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a>)
<a name="l00505"></a>00505         {
<a name="l00506"></a>00506             var candidate = [[<span class="keyword">self</span> _rowCacheForIndex:current_index] rowObject],
<a name="l00507"></a>00507                 subObjects = [[<span class="keyword">self</span> _subrowObjectsOfObject:candidate] _representedObject];
<a name="l00508"></a>00508 
<a name="l00509"></a>00509             <span class="keywordflow">if</span> ([subObjects indexOfObjectIdenticalTo:targetObject] != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l00510"></a>00510                 <span class="keywordflow">return</span> current_index;
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <span class="keywordflow">return</span> -1;
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 <span class="comment">/*</span>
<a name="l00518"></a>00518 <span class="comment">TODO: implement</span>
<a name="l00519"></a>00519 <span class="comment">    Returns the index of the row containing a given value.</span>
<a name="l00520"></a>00520 <span class="comment"></span>
<a name="l00521"></a>00521 <span class="comment">    displayValue The display value (string, view, or menu item) of an item in the receiver. This value must not be nil.</span>
<a name="l00522"></a>00522 <span class="comment"></span>
<a name="l00523"></a>00523 <span class="comment">    The index of the row containing displayValue, or CPNotFound.</span>
<a name="l00524"></a>00524 <span class="comment"></span>
<a name="l00525"></a>00525 <span class="comment">    This method searches each row via objects equality for the given display value, which may be present as an alternative in a popup menu for that row.</span>
<a name="l00526"></a>00526 <span class="comment"></span>
<a name="l00527"></a>00527 <span class="comment">- (CPInteger)rowForDisplayValue:(id)displayValue</span>
<a name="l00528"></a>00528 <span class="comment">*/</span>
<a name="l00529"></a>00529 
<a name="l00536"></a><a class="code" href="interface_c_p_rule_editor.html#a151fe2ad77f72bc0c553f1b59e8146d5">00536</a> - (CPRuleEditorRowType)rowTypeForRow:(<span class="keywordtype">int</span>)rowIndex
<a name="l00537"></a>00537 {
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (rowIndex &lt; 0 || rowIndex &gt; [<span class="keyword">self</span> numberOfRows])
<a name="l00539"></a>00539         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPRangeException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:_cmd+@&quot;row &quot; + rowIndex + &quot; is out of range&quot;];
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     var rowcache = [<span class="keyword">self</span> _rowCacheForIndex:rowIndex];
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (rowcache)
<a name="l00543"></a>00543     {
<a name="l00544"></a>00544         var rowobject = [rowcache rowObject];
<a name="l00545"></a>00545         <span class="keywordflow">return</span> [rowobject valueForKey:_typeKeyPath];
<a name="l00546"></a>00546     }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     <span class="keywordflow">return</span> <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>;
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00557"></a><a class="code" href="interface_c_p_rule_editor.html#a7f9677c6536a929b3a54887c7535ad85">00557</a> - (<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)subrowIndexesForRow:(<span class="keywordtype">int</span>)rowIndex
<a name="l00558"></a>00558 {
<a name="l00559"></a>00559     var object;
<a name="l00560"></a>00560     <span class="keywordflow">if</span> (rowIndex == -1)
<a name="l00561"></a>00561         <span class="keywordtype">object</span> = _boundArrayOwner;
<a name="l00562"></a>00562     <span class="keywordflow">else</span>
<a name="l00563"></a>00563         <span class="keywordtype">object</span> = [[<span class="keyword">self</span> _rowCacheForIndex:rowIndex] rowObject];
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     var subobjects = [<span class="keyword">self</span> _subrowObjectsOfObject:object],
<a name="l00566"></a>00566         objectsCount = [subobjects count],
<a name="l00567"></a>00567         indexes = [<a class="code" href="class_c_p_mutable_index_set.html">CPMutableIndexSet</a> <a class="code" href="class_c_p_index_set.html#a339845eb2d96fae878209105dde5e140">indexSet</a>],
<a name="l00568"></a>00568         count = [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#ae04204db2d684515060528c21cbabde2" title="Returns the number of rows in the receiver.">numberOfRows</a>];
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="keywordflow">for</span> (var i = rowIndex + 1; i &lt; count; i++)
<a name="l00571"></a>00571     {
<a name="l00572"></a>00572         var candidate = [[<span class="keyword">self</span> _rowCacheForIndex:i] rowObject],
<a name="l00573"></a>00573             indexInSubrows = [[subobjects _representedObject] indexOfObjectIdenticalTo:candidate];
<a name="l00574"></a>00574 
<a name="l00575"></a>00575         <span class="keywordflow">if</span> (indexInSubrows != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l00576"></a>00576         {
<a name="l00577"></a>00577             [indexes addIndex:i];
<a name="l00578"></a>00578             objectsCount --;
<a name="l00579"></a>00579             <span class="comment">// [buffer removeObjectAtIndex:indexInSubrows];</span>
<a name="l00580"></a>00580             <span class="keywordflow">if</span> ([<span class="keyword">self</span> rowTypeForRow:i] == <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a>)
<a name="l00581"></a>00581                 i += [[<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#a7f9677c6536a929b3a54887c7535ad85" title="Returns the immediate subrows of a given row.">subrowIndexesForRow</a>:i] <a class="code" href="class_c_p_index_set.html#a837688ed946ca09c66595dfa30345d03">count</a>];
<a name="l00582"></a>00582         }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584         <span class="keywordflow">if</span> (objectsCount == 0)
<a name="l00585"></a>00585             <span class="keywordflow">break</span>;
<a name="l00586"></a>00586     }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588     <span class="keywordflow">return</span> indexes;
<a name="l00589"></a>00589 }
<a name="l00590"></a>00590 
<a name="l00595"></a><a class="code" href="interface_c_p_rule_editor.html#a4bd4b6653c92ab8340466b760b9cc94d">00595</a> - (<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)selectedRowIndexes
<a name="l00596"></a>00596 {
<a name="l00597"></a>00597     <span class="keywordflow">return</span> [<span class="keyword">self</span> _selectedSliceIndices];
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00605"></a><a class="code" href="interface_c_p_rule_editor.html#a150f4150a622303e7fa6a235cb215bc6">00605</a> - (void)selectRowIndexes:(<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)indexes byExtendingSelection:(BOOL)extend
<a name="l00606"></a>00606 {
<a name="l00607"></a>00607     var count = [_slices count],
<a name="l00608"></a>00608         lastSelected = [indexes <a class="code" href="class_c_p_index_set.html#a2a6418c6d61b8d5d993c2e2572935758">lastIndex</a>];
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     <span class="keywordflow">if</span> (lastSelected &gt;= [<span class="keyword">self</span> numberOfRows])
<a name="l00611"></a>00611         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPRangeException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:@&quot;row indexes &quot; + indexes + &quot; are out of range&quot;];
<a name="l00612"></a>00612 
<a name="l00613"></a>00613     <span class="keywordflow">if</span> (!extend)
<a name="l00614"></a>00614         [<span class="keyword">self</span> _deselectAll];
<a name="l00615"></a>00615 
<a name="l00616"></a>00616     <span class="keywordflow">while</span> (count--)
<a name="l00617"></a>00617     {
<a name="l00618"></a>00618         var slice = _slices[count],
<a name="l00619"></a>00619             rowIndex = [slice rowIndex],
<a name="l00620"></a>00620             contains = [indexes <a class="code" href="class_c_p_index_set.html#a344d091793a5e263f37e26e94e9c31aa">containsIndex</a>:rowIndex];
<a name="l00621"></a>00621             shouldSelect = (contains &amp;&amp; !(extend &amp;&amp; [slice _isSelected]));
<a name="l00622"></a>00622 
<a name="l00623"></a>00623         <span class="keywordflow">if</span> (contains)
<a name="l00624"></a>00624             [slice _setSelected:shouldSelect];
<a name="l00625"></a>00625         [slice _setLastSelected:(rowIndex == lastSelected)];
<a name="l00626"></a>00626         [slice setNeedsDisplay:YES];
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628 }
<a name="l00629"></a>00629 
<a name="l00639"></a><a class="code" href="interface_c_p_rule_editor.html#ab923818ed3706a4cbc2531b71667f41a">00639</a> - (void)addRow:(<span class="keywordtype">id</span>)sender
<a name="l00640"></a>00640 {
<a name="l00641"></a>00641     var parentRowIndex = -1,
<a name="l00642"></a>00642         rowtype,
<a name="l00643"></a>00643         numberOfRows = [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#ae04204db2d684515060528c21cbabde2" title="Returns the number of rows in the receiver.">numberOfRows</a>],
<a name="l00644"></a>00644         hasRows = (numberOfRows &gt; 0),
<a name="l00645"></a>00645         nestingMode = [<span class="keyword">self</span> _applicableNestingMode];
<a name="l00646"></a>00646 
<a name="l00647"></a>00647     <span class="keywordflow">switch</span> (nestingMode)
<a name="l00648"></a>00648     {
<a name="l00649"></a>00649         <span class="keywordflow">case</span> <a class="code" href="_c_p_rule_editor_8j.html#a6e943a157b214510f90ee395c7c5f246">CPRuleEditorNestingModeSimple</a>:
<a name="l00650"></a>00650             rowtype = hasRows ? <a class="code" href="_c_p_rule_editor_8j.html#a597f976009fd1e7d8af2a9e90901fb14">CPRuleEditorRowTypeSimple</a> : <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a>;
<a name="l00651"></a>00651             <span class="keywordflow">if</span> (hasRows)
<a name="l00652"></a>00652                 parentRowIndex = 0;
<a name="l00653"></a>00653             <span class="keywordflow">break</span>;
<a name="l00654"></a>00654         <span class="keywordflow">case</span> <a class="code" href="_c_p_rule_editor_8j.html#ae08c736e778a1a4411ebcef390bfb791">CPRuleEditorNestingModeSingle</a>:
<a name="l00655"></a>00655              <span class="keywordflow">if</span> (hasRows)
<a name="l00656"></a>00656                 <span class="keywordflow">return</span>;
<a name="l00657"></a>00657         <span class="keywordflow">case</span> <a class="code" href="_c_p_rule_editor_8j.html#abc68a04af6ac9e1280f2087c8e9d3e2f">CPRuleEditorNestingModeList</a>:
<a name="l00658"></a>00658             rowtype = <a class="code" href="_c_p_rule_editor_8j.html#a597f976009fd1e7d8af2a9e90901fb14">CPRuleEditorRowTypeSimple</a>;
<a name="l00659"></a>00659             <span class="keywordflow">break</span>;
<a name="l00660"></a>00660         <span class="keywordflow">case</span> <a class="code" href="_c_p_rule_editor_8j.html#a2a2a2daaeed7ae8098015683fbe9a8cd">CPRuleEditorNestingModeCompound</a>:
<a name="l00661"></a>00661             rowtype = <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a>;
<a name="l00662"></a>00662             <span class="keywordflow">if</span> (hasRows)
<a name="l00663"></a>00663                 parentRowIndex = 0;
<a name="l00664"></a>00664             <span class="keywordflow">break</span>;
<a name="l00665"></a>00665         <span class="keywordflow">default</span>:
<a name="l00666"></a>00666             [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPInvalidArgumentException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:@&quot;Not supported CPRuleEditorNestingMode &quot; + nestingMode];
<a name="l00667"></a>00667         <span class="comment">// Compound mode: parentRowIndex=(lastRowType == CPRuleEditorRowTypeCompound)?lastRow :[self parentRowForRow:lastRow]; break;</span>
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#a247a89903ebab9d7eb193c1c33195047" title="Adds a new row of a given type at a given location.">insertRowAtIndex</a>:numberOfRows <a class="code" href="interface_c_p_rule_editor.html#a247a89903ebab9d7eb193c1c33195047" title="Adds a new row of a given type at a given location.">withType</a>:rowtype <a class="code" href="interface_c_p_rule_editor.html#a247a89903ebab9d7eb193c1c33195047" title="Adds a new row of a given type at a given location.">asSubrowOfRow</a>:parentRowIndex <a class="code" href="interface_c_p_rule_editor.html#a247a89903ebab9d7eb193c1c33195047" title="Adds a new row of a given type at a given location.">animate</a>:YES];
<a name="l00671"></a>00671 }
<a name="l00672"></a>00672 
<a name="l00682"></a><a class="code" href="interface_c_p_rule_editor.html#a247a89903ebab9d7eb193c1c33195047">00682</a> - (void)insertRowAtIndex:(<span class="keywordtype">int</span>)rowIndex withType:(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)rowType asSubrowOfRow:(<span class="keywordtype">int</span>)parentRow animate:(BOOL)shouldAnimate
<a name="l00683"></a>00683 {
<a name="l00684"></a>00684 <span class="comment">/*</span>
<a name="l00685"></a>00685 <span class="comment">    TODO: raise exceptions if parentRow is greater than or equal to rowIndex, or if rowIndex would fall amongst the children of some other parent, or if the nesting mode forbids this configuration.</span>
<a name="l00686"></a>00686 <span class="comment">*/</span>
<a name="l00687"></a>00687     var newObject = [<span class="keyword">self</span> _insertNewRowAtIndex:rowIndex ofType:rowType withParentRow:parentRow];
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     <span class="keywordflow">if</span> (rowType == <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a> &amp;&amp; !_allowsEmptyCompoundRows)
<a name="l00690"></a>00690     {
<a name="l00691"></a>00691         var subrow = [<span class="keyword">self</span> _insertNewRowAtIndex:(rowIndex + 1) ofType:CPRuleEditorRowTypeSimple withParentRow:rowIndex];
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00701"></a><a class="code" href="interface_c_p_rule_editor.html#a234186347dbec09e509b234b7db3ed41">00701</a> - (void)removeRowAtIndex:(<span class="keywordtype">int</span>)rowIndex
<a name="l00702"></a>00702 {
<a name="l00703"></a>00703     <span class="comment">//  TO DO : Any subrows of the deleted row are adopted by the parent of the deleted row, or are made root rows.</span>
<a name="l00704"></a>00704 
<a name="l00705"></a>00705     <span class="keywordflow">if</span> (rowIndex &lt; 0 || rowIndex &gt;= [<span class="keyword">self</span> numberOfRows])
<a name="l00706"></a>00706         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPRangeException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:@&quot;row &quot; + rowIndex + &quot; is out of range&quot;];
<a name="l00707"></a>00707 
<a name="l00708"></a>00708     [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#a3585a56e119d23de73e740d642c39558" title="Removes the rows at a given index.">removeRowsAtIndexes</a>:[<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> <a class="code" href="class_c_p_index_set.html#a4aa683fde78ba593d0e70040125ed306">indexSetWithIndex</a>:rowIndex] <a class="code" href="interface_c_p_rule_editor.html#a3585a56e119d23de73e740d642c39558" title="Removes the rows at a given index.">includeSubrows</a>:NO];
<a name="l00709"></a>00709 }
<a name="l00710"></a>00710 
<a name="l00718"></a><a class="code" href="interface_c_p_rule_editor.html#a3585a56e119d23de73e740d642c39558">00718</a> - (void)removeRowsAtIndexes:(<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)rowIndexes includeSubrows:(BOOL)includeSubrows
<a name="l00719"></a>00719 {
<a name="l00720"></a>00720     <span class="keywordflow">if</span> ([rowIndexes count] == 0)
<a name="l00721"></a>00721         <span class="keywordflow">return</span>;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     <span class="keywordflow">if</span> ([rowIndexes lastIndex] &gt;= [<span class="keyword">self</span> numberOfRows])
<a name="l00724"></a>00724         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPRangeException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:@&quot;rows indexes &quot; + rowIndexes + &quot; are out of range&quot;];
<a name="l00725"></a>00725 
<a name="l00726"></a>00726     var current_index = [rowIndexes <a class="code" href="class_c_p_index_set.html#abc895f4b5df7bdaf090161db6b234b73">firstIndex</a>],
<a name="l00727"></a>00727         parentRowIndex = [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#ada5e29472142358ebe0ef104b57856f5" title="Returns the index of the parent of a given row.">parentRowForRow</a>:current_index],
<a name="l00728"></a>00728         childsIndexes = [<a class="code" href="class_c_p_mutable_index_set.html">CPMutableIndexSet</a> <a class="code" href="class_c_p_index_set.html#a339845eb2d96fae878209105dde5e140">indexSet</a>],
<a name="l00729"></a>00729         subrows;
<a name="l00730"></a>00730 
<a name="l00731"></a>00731     <span class="keywordflow">if</span> (parentRowIndex == -1)
<a name="l00732"></a>00732         subrows = [<span class="keyword">self</span> _rootRowsArray];
<a name="l00733"></a>00733     <span class="keywordflow">else</span>
<a name="l00734"></a>00734     {
<a name="l00735"></a>00735         var parentRowObject = [[<span class="keyword">self</span> _rowCacheForIndex:parentRowIndex] rowObject];
<a name="l00736"></a>00736         subrows = [<span class="keyword">self</span> _subrowObjectsOfObject:parentRowObject];
<a name="l00737"></a>00737     }
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     <span class="keywordflow">while</span> (current_index != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l00740"></a>00740     {
<a name="l00741"></a>00741         var rowObject = [[<span class="keyword">self</span> _rowCacheForIndex:current_index] rowObject],
<a name="l00742"></a>00742             relativeChildIndex = [[subrows _representedObject] indexOfObjectIdenticalTo:rowObject];
<a name="l00743"></a>00743 
<a name="l00744"></a>00744         <span class="keywordflow">if</span> (relativeChildIndex != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l00745"></a>00745             [childsIndexes addIndex:relativeChildIndex];
<a name="l00746"></a>00746 
<a name="l00747"></a>00747         <span class="keywordflow">if</span> (includeSubrows &amp;&amp; [<span class="keyword">self</span> rowTypeForRow:current_index] == <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a>)
<a name="l00748"></a>00748         {
<a name="l00749"></a>00749             var more_childs = [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#a7f9677c6536a929b3a54887c7535ad85" title="Returns the immediate subrows of a given row.">subrowIndexesForRow</a>:current_index];
<a name="l00750"></a>00750             [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#a3585a56e119d23de73e740d642c39558" title="Removes the rows at a given index.">removeRowsAtIndexes</a>:more_childs <a class="code" href="interface_c_p_rule_editor.html#a3585a56e119d23de73e740d642c39558" title="Removes the rows at a given index.">includeSubrows</a>:includeSubrows];
<a name="l00751"></a>00751         }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753         current_index = [rowIndexes <a class="code" href="class_c_p_index_set.html#a3f66583eea02c42c2b14e53daf697559">indexGreaterThanIndex</a>:current_index];
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     [subrows removeObjectsAtIndexes:childsIndexes];
<a name="l00757"></a>00757 }
<a name="l00758"></a>00758 
<a name="l00768"></a><a class="code" href="interface_c_p_rule_editor.html#adeb7f88eb5471420652fefe12955777e">00768</a> - (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicate
<a name="l00769"></a>00769 {
<a name="l00770"></a>00770     <span class="keywordflow">return</span> _predicate;
<a name="l00771"></a>00771 }
<a name="l00772"></a>00772 
<a name="l00777"></a><a class="code" href="interface_c_p_rule_editor.html#a7e9942eb2e734935281e054050942594">00777</a> - (void)reloadPredicate
<a name="l00778"></a>00778 {
<a name="l00779"></a>00779     [<span class="keyword">self</span> _updatePredicate];
<a name="l00780"></a>00780 }
<a name="l00781"></a>00781 
<a name="l00788"></a><a class="code" href="interface_c_p_rule_editor.html#adcb69649e31ce9df98481f2f290a01da">00788</a> - (<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicateForRow:(CPInteger)aRow
<a name="l00789"></a>00789 {
<a name="l00790"></a>00790     var predicateParts = [<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a> <a class="code" href="interface_c_p_dictionary.html#af9820df885270d5200f27f9a539aca28">dictionary</a>],
<a name="l00791"></a>00791         items = [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#ad124d38ab7f4b2d2e25e2a6723cac9ba" title="Returns the currently chosen items for a given row.">criteriaForRow</a>:aRow],
<a name="l00792"></a>00792         count = [items count],
<a name="l00793"></a>00793         predicate,
<a name="l00794"></a>00794         i;
<a name="l00795"></a>00795 
<a name="l00796"></a>00796     <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l00797"></a>00797     {
<a name="l00798"></a>00798         var item = [items objectAtIndex:i],
<a name="l00799"></a>00799         <span class="comment">//var displayValue = [self _queryValueForItem:item inRow:aRow];  A voir. On peut aussi prendre la valeur affichée dans le row cache.</span>
<a name="l00800"></a>00800             displayValue = [[<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#a59fa10ebad00a5863cc4754b228c1161" title="Returns the chosen values for a given row.">displayValuesForRow</a>:aRow] <a class="code" href="interface_c_p_array.html#a5f4c80df5e0ce9c9c7c64c7c24d917eb">objectAtIndex</a>:i],
<a name="l00801"></a>00801             predpart = [_ruleDelegate ruleEditor:self predicatePartsForCriterion:item withDisplayValue:displayValue inRow:aRow];
<a name="l00802"></a>00802 
<a name="l00803"></a>00803         <span class="keywordflow">if</span> (predpart)
<a name="l00804"></a>00804             [predicateParts addEntriesFromDictionary:predpart];
<a name="l00805"></a>00805     }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807     <span class="keywordflow">if</span> ([<span class="keyword">self</span> rowTypeForRow:aRow] == <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a>)
<a name="l00808"></a>00808     {
<a name="l00809"></a>00809         var compoundPredicate,
<a name="l00810"></a>00810             subpredicates = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l00811"></a>00811             subrowsIndexes = [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#a7f9677c6536a929b3a54887c7535ad85" title="Returns the immediate subrows of a given row.">subrowIndexesForRow</a>:aRow];
<a name="l00812"></a>00812 
<a name="l00813"></a>00813         <span class="keywordflow">if</span> ([subrowsIndexes count] == 0)
<a name="l00814"></a>00814             <span class="keywordflow">return</span> nil;
<a name="l00815"></a>00815 
<a name="l00816"></a>00816         var current_index = [subrowsIndexes firstIndex];
<a name="l00817"></a>00817         <span class="keywordflow">while</span> (current_index != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l00818"></a>00818         {
<a name="l00819"></a>00819             var subpredicate = [<span class="keyword">self</span> <a class="code" href="interface_c_p_rule_editor.html#adcb69649e31ce9df98481f2f290a01da" title="Returns the predicate for a given row.">predicateForRow</a>:current_index];
<a name="l00820"></a>00820             <span class="keywordflow">if</span> (subpredicate != nil)
<a name="l00821"></a>00821                 [subpredicates addObject:subpredicate];
<a name="l00822"></a>00822 
<a name="l00823"></a>00823             current_index = [subrowsIndexes indexGreaterThanIndex:current_index];
<a name="l00824"></a>00824         }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         var compoundType = [predicateParts objectForKey:CPRuleEditorPredicateCompoundType];
<a name="l00827"></a>00827 
<a name="l00828"></a>00828         <span class="keywordflow">if</span> ([subpredicates count] == 0)
<a name="l00829"></a>00829             <span class="keywordflow">return</span> nil;
<a name="l00830"></a>00830         <span class="keywordflow">else</span>
<a name="l00831"></a>00831         {
<a name="l00832"></a>00832             <span class="keywordflow">try</span>
<a name="l00833"></a>00833             {
<a name="l00834"></a>00834                 compoundPredicate = [[<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> alloc ] initWithType:compoundType subpredicates:subpredicates];
<a name="l00835"></a>00835             }
<a name="l00836"></a>00836             <span class="keywordflow">catch</span>(error)
<a name="l00837"></a>00837             {
<a name="l00838"></a>00838                 CPLogConsole(<span class="stringliteral">@&quot;Compound predicate error: [%@]\npredicateType:%i&quot;</span>,[error description],compoundType);
<a name="l00839"></a>00839                 compoundPredicate = nil;
<a name="l00840"></a>00840             }
<a name="l00841"></a>00841             <span class="keywordflow">finally</span>
<a name="l00842"></a>00842             {
<a name="l00843"></a>00843                 <span class="keywordflow">return</span> compoundPredicate;
<a name="l00844"></a>00844             }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846         }
<a name="l00847"></a>00847     }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849     var lhs = [predicateParts objectForKey:CPRuleEditorPredicateLeftExpression],
<a name="l00850"></a>00850         rhs = [predicateParts objectForKey:CPRuleEditorPredicateRightExpression],
<a name="l00851"></a>00851         <span class="keyword">operator</span> = [predicateParts objectForKey:CPRuleEditorPredicateOperatorType],
<a name="l00852"></a>00852         options  = [predicateParts objectForKey:CPRuleEditorPredicateOptions],
<a name="l00853"></a>00853         modifier = [predicateParts objectForKey:CPRuleEditorPredicateComparisonModifier],
<a name="l00854"></a>00854         selector = <a class="code" href="_c_p_obj_j_runtime_8j.html#a45a81e40ed0e7efe7ef3958151d548d8">CPSelectorFromString</a>([predicateParts objectForKey:<a class="code" href="_c_p_rule_editor_8j.html#aa470c0bcaa9f333e73a0cdc688b37e0a">CPRuleEditorPredicateCustomSelector</a>]);
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     <span class="keywordflow">if</span> (lhs == nil){ CPLogConsole(<span class="stringliteral">@&quot;missing left expression in predicate parts dictionary&quot;</span>); <span class="keywordflow">return</span> NULL;}
<a name="l00857"></a>00857     <span class="keywordflow">if</span> (rhs == nil){ CPLogConsole(<span class="stringliteral">@&quot;missing right expression in predicate parts dictionary&quot;</span>); <span class="keywordflow">return</span> NULL;}
<a name="l00858"></a>00858     <span class="keywordflow">if</span> (selector == nil &amp;&amp; <span class="keyword">operator</span> == nil){ CPLogConsole(<span class="stringliteral">@&quot;missing operator and selector in predicate parts dictionary&quot;</span>); <span class="keywordflow">return</span> NULL;}
<a name="l00859"></a>00859 
<a name="l00860"></a>00860     <span class="keywordflow">if</span> (modifier == nil) CPLogConsole(<span class="stringliteral">@&quot;missing modifier in predicate parts dictionary. Setting default: CPDirectPredicateModifier&quot;</span>);
<a name="l00861"></a>00861     <span class="keywordflow">if</span> (options == nil)  CPLogConsole(<span class="stringliteral">@&quot;missing options in predicate parts dictionary. Setting default: CPCaseInsensitivePredicateOption&quot;</span>);
<a name="l00862"></a>00862 
<a name="l00863"></a>00863     <span class="keywordflow">try</span>
<a name="l00864"></a>00864     {
<a name="l00865"></a>00865         <span class="keywordflow">if</span> (selector != nil)
<a name="l00866"></a>00866             predicate = [<a class="code" href="interface_c_p_comparison_predicate.html" title="CPComparisonPredicate is a subclass of CPPredicate used to compare expressions.">CPComparisonPredicate</a>
<a name="l00867"></a>00867                          <a class="code" href="interface_c_p_comparison_predicate.html#ac9ce9475b500f393c5c08175d241bc13">predicateWithLeftExpression</a>:lhs
<a name="l00868"></a>00868                          <a class="code" href="interface_c_p_comparison_predicate.html#ac9ce9475b500f393c5c08175d241bc13">rightExpression</a>:rhs
<a name="l00869"></a>00869                          <a class="code" href="interface_c_p_comparison_predicate.html#ac9ce9475b500f393c5c08175d241bc13">customSelector</a>:selector
<a name="l00870"></a>00870                          ];
<a name="l00871"></a>00871         <span class="keywordflow">else</span>
<a name="l00872"></a>00872             predicate = [<a class="code" href="interface_c_p_comparison_predicate.html" title="CPComparisonPredicate is a subclass of CPPredicate used to compare expressions.">CPComparisonPredicate</a>
<a name="l00873"></a>00873                          <a class="code" href="interface_c_p_comparison_predicate.html#a0fe06837ef0bdca7d956b5a3dbb106ff">predicateWithLeftExpression</a>:lhs
<a name="l00874"></a>00874                          <a class="code" href="interface_c_p_comparison_predicate.html#a0fe06837ef0bdca7d956b5a3dbb106ff">rightExpression</a>:rhs
<a name="l00875"></a>00875                          <a class="code" href="interface_c_p_comparison_predicate.html#a0fe06837ef0bdca7d956b5a3dbb106ff">modifier</a>:(modifier || CPDirectPredicateModifier)
<a name="l00876"></a>00876                          <a class="code" href="interface_c_p_comparison_predicate.html#a0fe06837ef0bdca7d956b5a3dbb106ff">type</a>:operator
<a name="l00877"></a>00877                          <a class="code" href="interface_c_p_comparison_predicate.html#a0fe06837ef0bdca7d956b5a3dbb106ff">options</a>:(options || CPCaseInsensitivePredicateOption)
<a name="l00878"></a>00878                          ];
<a name="l00879"></a>00879     }
<a name="l00880"></a>00880     <span class="keywordflow">catch</span>(error)
<a name="l00881"></a>00881     {
<a name="l00882"></a>00882         CPLogConsole(<span class="stringliteral">@&quot;Row predicate error: [&quot;</span>+[error description]+<span class="stringliteral">&quot;] for row &quot;</span>+aRow);
<a name="l00883"></a>00883         predicate = nil;
<a name="l00884"></a>00884     }
<a name="l00885"></a>00885     <span class="keywordflow">finally</span>
<a name="l00886"></a>00886     {
<a name="l00887"></a>00887         <span class="keywordflow">return</span> predicate;
<a name="l00888"></a>00888     }
<a name="l00889"></a>00889 }
<a name="l00890"></a>00890 
<a name="l00900"></a><a class="code" href="interface_c_p_rule_editor.html#a7cb12c750dba72a2fde4381196fc9670">00900</a> - (Class)rowClass
<a name="l00901"></a>00901 {
<a name="l00902"></a>00902     <span class="keywordflow">return</span> _rowClass;
<a name="l00903"></a>00903 }
<a name="l00904"></a>00904 
<a name="l00910"></a><a class="code" href="interface_c_p_rule_editor.html#ad0d157a7419ad7565ae1ee1c55831159">00910</a> - (void)setRowClass:(Class)rowClass
<a name="l00911"></a>00911 {
<a name="l00912"></a>00912     <span class="keywordflow">if</span> (rowClass == [<a class="code" href="class_c_p_mutable_dictionary.html">CPMutableDictionary</a> <span class="keyword">class</span>])
<a name="l00913"></a>00913         rowClass = [<a class="code" href="class_row_object.html">RowObject</a> class];
<a name="l00914"></a>00914 
<a name="l00915"></a>00915     _rowClass = rowClass;
<a name="l00916"></a>00916 }
<a name="l00917"></a>00917 
<a name="l00925"></a><a class="code" href="interface_c_p_rule_editor.html#a079ccb1df55a9934047f997dd4cb7d89">00925</a> - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)rowTypeKeyPath
<a name="l00926"></a>00926 {
<a name="l00927"></a>00927     <span class="keywordflow">return</span> _typeKeyPath;
<a name="l00928"></a>00928 }
<a name="l00929"></a>00929 
<a name="l00935"></a><a class="code" href="interface_c_p_rule_editor.html#a4a2f92c68a2557bbda9043c1aebffe70">00935</a> - (void)setRowTypeKeyPath:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)keyPath
<a name="l00936"></a>00936 {
<a name="l00937"></a>00937     <span class="keywordflow">if</span> (_typeKeyPath !== keyPath)
<a name="l00938"></a>00938         _typeKeyPath = keyPath;
<a name="l00939"></a>00939 }
<a name="l00940"></a>00940 
<a name="l00948"></a><a class="code" href="interface_c_p_rule_editor.html#a03eb2788d9e734c2d5f5ae0ea7fad915">00948</a> - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)subrowsKeyPath
<a name="l00949"></a>00949 {
<a name="l00950"></a>00950     <span class="keywordflow">return</span> _subrowsArrayKeyPath;
<a name="l00951"></a>00951 }
<a name="l00952"></a>00952 
<a name="l00958"></a><a class="code" href="interface_c_p_rule_editor.html#ab39a711be94dd69a5b01fa8017fc0e31">00958</a> - (void)setSubrowsKeyPath:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)keyPath
<a name="l00959"></a>00959 {
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (_subrowsArrayKeyPath !== keyPath)
<a name="l00961"></a>00961         _subrowsArrayKeyPath = keyPath;
<a name="l00962"></a>00962 }
<a name="l00963"></a>00963 
<a name="l00971"></a><a class="code" href="interface_c_p_rule_editor.html#a7b2faa7adc58818f421c617f126a6b81">00971</a> - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)criteriaKeyPath
<a name="l00972"></a>00972 {
<a name="l00973"></a>00973     <span class="keywordflow">return</span> _itemsKeyPath;
<a name="l00974"></a>00974 }
<a name="l00975"></a>00975 
<a name="l00981"></a><a class="code" href="interface_c_p_rule_editor.html#afced97317edde73ac7ac6c645f8d560c">00981</a> - (void)setCriteriaKeyPath:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)keyPath
<a name="l00982"></a>00982 {
<a name="l00983"></a>00983     <span class="keywordflow">if</span> (_itemsKeyPath !== keyPath)
<a name="l00984"></a>00984         _itemsKeyPath = keyPath;
<a name="l00985"></a>00985 }
<a name="l00986"></a>00986 
<a name="l00994"></a><a class="code" href="interface_c_p_rule_editor.html#a71427d897024abe12d723df0d5df0476">00994</a> - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)displayValuesKeyPath
<a name="l00995"></a>00995 {
<a name="l00996"></a>00996     <span class="keywordflow">return</span> _valuesKeyPath;
<a name="l00997"></a>00997 }
<a name="l00998"></a>00998 
<a name="l01004"></a><a class="code" href="interface_c_p_rule_editor.html#a858f75ab9952269cb90b751c9342f554">01004</a> - (void)setDisplayValuesKeyPath:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)keyPath
<a name="l01005"></a>01005 {
<a name="l01006"></a>01006     <span class="keywordflow">if</span> (_valuesKeyPath !== keyPath)
<a name="l01007"></a>01007         _valuesKeyPath = keyPath;
<a name="l01008"></a>01008 }
<a name="l01009"></a>01009 
<a name="l01019"></a><a class="code" href="interface_c_p_rule_editor.html#a0956e828dcaaff915b25afa9d930494f">01019</a> - (id)animation
<a name="l01020"></a>01020 {
<a name="l01021"></a>01021     <span class="keywordflow">return</span> _currentAnimation;
<a name="l01022"></a>01022 }
<a name="l01023"></a>01023 
<a name="l01030"></a><a class="code" href="interface_c_p_rule_editor.html#a17beeb329df57596fe313a53b4639eac">01030</a> - (void)setAnimation:(<a class="code" href="interface_c_p_view_animation.html">CPViewAnimation</a>)animation
<a name="l01031"></a>01031 {
<a name="l01032"></a>01032     _currentAnimation = animation;
<a name="l01033"></a>01033     [_currentAnimation setDelegate:self];
<a name="l01034"></a>01034 }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036 <span class="comment">// TODO: delegate methods are implemented by the delegate. How do you document them in doxygen without implementing them here ? @fn not working ?</span>
<a name="l01082"></a>01082 <span class="comment"></span>- (BOOL)acceptsFirstResponder
<a name="l01083"></a>01083 {
<a name="l01084"></a>01084     <span class="keywordflow">return</span> YES;
<a name="l01085"></a>01085 }
<a name="l01086"></a>01086 
<a name="l01087"></a>01087 - (void)keyDown:(<a class="code" href="interface_c_p_event.html">CPEvent</a>)event
<a name="l01088"></a>01088 {
<a name="l01089"></a>01089     <span class="keywordflow">if</span> (!_suppressKeyDownHandling &amp;&amp; [<span class="keyword">self</span> _applicableNestingMode] == <a class="code" href="_c_p_rule_editor_8j.html#a2a2a2daaeed7ae8098015683fbe9a8cd">CPRuleEditorNestingModeCompound</a> &amp;&amp; !_isKeyDown &amp;&amp; ([event modifierFlags] &amp; <a class="code" href="_c_p_event_8j.html#abb24a409c7daa575dd1fa20b7fcf8d51">CPAlternateKeyMask</a>))
<a name="l01090"></a>01090     {
<a name="l01091"></a>01091         [_slices makeObjectsPerformSelector:@selector(_configurePlusButtonByRowType:) withObject:CPRuleEditorRowTypeCompound];
<a name="l01092"></a>01092     }
<a name="l01093"></a>01093 
<a name="l01094"></a>01094     _isKeyDown = YES;
<a name="l01095"></a>01095 }
<a name="l01096"></a>01096 
<a name="l01097"></a>01097 - (void)keyUp:(<a class="code" href="interface_c_p_event.html">CPEvent</a>)event
<a name="l01098"></a>01098 {
<a name="l01099"></a>01099     <span class="keywordflow">if</span> (!_suppressKeyDownHandling)
<a name="l01100"></a>01100     {
<a name="l01101"></a>01101         [_slices makeObjectsPerformSelector:@selector(_configurePlusButtonByRowType:) withObject:CPRuleEditorRowTypeSimple];
<a name="l01102"></a>01102     }
<a name="l01103"></a>01103 
<a name="l01104"></a>01104     _isKeyDown = NO;
<a name="l01105"></a>01105 }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107 - (_CPRuleEditorViewSliceDropSeparator)_createSliceDropSeparator
<a name="l01108"></a>01108 {
<a name="l01109"></a>01109     var view = [[_CPRuleEditorViewSliceDropSeparator alloc] initWithFrame:CGRectMake(0,-10, [<span class="keyword">self</span> frame].size.width, 2)];
<a name="l01110"></a>01110     [view setAutoresizingMask:CPViewWidthSizable];
<a name="l01111"></a>01111 <span class="preprocessor">#if PLATFORM(DOM)</span>
<a name="l01112"></a>01112 <span class="preprocessor"></span>    view._DOMElement.style.webkitTransition = <span class="stringliteral">&quot;opacity 300ms ease-in&quot;</span>;
<a name="l01113"></a>01113 <span class="preprocessor">#endif</span>
<a name="l01114"></a>01114 <span class="preprocessor"></span>    <span class="keywordflow">return</span> view;
<a name="l01115"></a>01115 }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117 - (BOOL)_suppressKeyDownHandling
<a name="l01118"></a>01118 {
<a name="l01119"></a>01119     <span class="keywordflow">return</span> _suppressKeyDownHandling;
<a name="l01120"></a>01120 }
<a name="l01121"></a>01121 
<a name="l01122"></a>01122 - (BOOL)_wantsRowAnimations
<a name="l01123"></a>01123 {
<a name="l01124"></a>01124     <span class="keywordflow">return</span> (_currentAnimation != nil);
<a name="l01125"></a>01125 }
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 - (void)_updateButtonVisibilities
<a name="l01128"></a>01128 {
<a name="l01129"></a>01129     [_slices makeObjectsPerformSelector:@selector(_updateButtonVisibilities)];
<a name="l01130"></a>01130 }
<a name="l01131"></a>01131 
<a name="l01132"></a>01132 - (float)_alignmentGridWidth
<a name="l01133"></a>01133 {
<a name="l01134"></a>01134     <span class="keywordflow">return</span>  _alignmentGridWidth;
<a name="l01135"></a>01135 }
<a name="l01136"></a>01136 
<a name="l01137"></a>01137 - (float)_minimumFrameHeight
<a name="l01138"></a>01138 {
<a name="l01139"></a>01139     <span class="keywordflow">return</span> 26.;
<a name="l01140"></a>01140 }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 - (CPRuleEditorNestingMode)_applicableNestingMode
<a name="l01143"></a>01143 {
<a name="l01144"></a>01144     <span class="keywordflow">if</span> (!_nestingModeDidChange)
<a name="l01145"></a>01145         <span class="keywordflow">return</span> _nestingMode;
<a name="l01146"></a>01146 
<a name="l01147"></a>01147     var a = (_nestingMode == <a class="code" href="_c_p_rule_editor_8j.html#a2a2a2daaeed7ae8098015683fbe9a8cd">CPRuleEditorNestingModeCompound</a> || _nestingMode == <a class="code" href="_c_p_rule_editor_8j.html#a6e943a157b214510f90ee395c7c5f246">CPRuleEditorNestingModeSimple</a>);
<a name="l01148"></a>01148     var b = ([<span class="keyword">self</span> rowTypeForRow:0] == <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a>);
<a name="l01149"></a>01149 
<a name="l01150"></a>01150     <span class="keywordflow">if</span> (a == b)
<a name="l01151"></a>01151         <span class="keywordflow">return</span> _nestingMode;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153     <span class="keywordflow">return</span> a ? <a class="code" href="_c_p_rule_editor_8j.html#abc68a04af6ac9e1280f2087c8e9d3e2f">CPRuleEditorNestingModeList</a> : <a class="code" href="_c_p_rule_editor_8j.html#a6e943a157b214510f90ee395c7c5f246">CPRuleEditorNestingModeSimple</a>;
<a name="l01154"></a>01154 }
<a name="l01155"></a>01155 
<a name="l01156"></a>01156 - (BOOL)_shouldHideAddButtonForSlice:(<span class="keywordtype">id</span>)slice
<a name="l01157"></a>01157 {
<a name="l01158"></a>01158     <span class="keywordflow">return</span> (!_editable || [<span class="keyword">self</span> _applicableNestingMode] == <a class="code" href="_c_p_rule_editor_8j.html#ae08c736e778a1a4411ebcef390bfb791">CPRuleEditorNestingModeSingle</a>);
<a name="l01159"></a>01159 }
<a name="l01160"></a>01160 
<a name="l01161"></a>01161 - (BOOL)_shouldHideSubtractButtonForSlice:(<span class="keywordtype">id</span>)slice
<a name="l01162"></a>01162 {
<a name="l01163"></a>01163     <span class="keywordflow">if</span> (!_editable)
<a name="l01164"></a>01164         <span class="keywordflow">return</span> YES;
<a name="l01165"></a>01165 
<a name="l01166"></a>01166     <span class="keywordflow">if</span> (!_disallowEmpty)
<a name="l01167"></a>01167         <span class="keywordflow">return</span> NO;
<a name="l01168"></a>01168 
<a name="l01169"></a>01169     var shouldHide,
<a name="l01170"></a>01170         rowIndex = [slice rowIndex],
<a name="l01171"></a>01171         parentIndex = [<span class="keyword">self</span> parentRowForRow:rowIndex],
<a name="l01172"></a>01172         subrowsIndexes = [<span class="keyword">self</span> subrowIndexesForRow:parentIndex],
<a name="l01173"></a>01173         nestingMode = [<span class="keyword">self</span> _applicableNestingMode];
<a name="l01174"></a>01174 
<a name="l01175"></a>01175     <span class="keywordflow">switch</span> (nestingMode)
<a name="l01176"></a>01176     {
<a name="l01177"></a>01177         <span class="keywordflow">case</span> <a class="code" href="_c_p_rule_editor_8j.html#a2a2a2daaeed7ae8098015683fbe9a8cd">CPRuleEditorNestingModeCompound</a>:
<a name="l01178"></a>01178         <span class="keywordflow">case</span> <a class="code" href="_c_p_rule_editor_8j.html#a6e943a157b214510f90ee395c7c5f246">CPRuleEditorNestingModeSimple</a>: shouldHide = ([subrowsIndexes count] == 1 &amp;&amp; !_allowsEmptyCompoundRows) || parentIndex == -1;
<a name="l01179"></a>01179                 <span class="keywordflow">break</span>;
<a name="l01180"></a>01180         <span class="keywordflow">case</span> <a class="code" href="_c_p_rule_editor_8j.html#abc68a04af6ac9e1280f2087c8e9d3e2f">CPRuleEditorNestingModeList</a>: shouldHide = ([<span class="keyword">self</span> numberOfRows] == 1);
<a name="l01181"></a>01181                 <span class="keywordflow">break</span>;
<a name="l01182"></a>01182         <span class="keywordflow">case</span> <a class="code" href="_c_p_rule_editor_8j.html#ae08c736e778a1a4411ebcef390bfb791">CPRuleEditorNestingModeSingle</a>: shouldHide = YES;
<a name="l01183"></a>01183                 <span class="keywordflow">break</span>;
<a name="l01184"></a>01184         <span class="keywordflow">default</span>: shouldHide = NO;
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187     <span class="keywordflow">return</span> shouldHide;
<a name="l01188"></a>01188 }
<a name="l01189"></a>01189 
<a name="l01190"></a>01190 <span class="preprocessor">#pragma mark Rows management</span>
<a name="l01191"></a>01191 <span class="preprocessor"></span>
<a name="l01192"></a>01192 - (id)_rowCacheForIndex:(<span class="keywordtype">int</span>)index
<a name="l01193"></a>01193 {
<a name="l01194"></a>01194     <span class="keywordflow">return</span> [_rowCache objectAtIndex:index];
<a name="l01195"></a>01195 }
<a name="l01196"></a>01196 
<a name="l01197"></a>01197 - (id)_searchCacheForRowObject:(<span class="keywordtype">id</span>)rowObject
<a name="l01198"></a>01198 {
<a name="l01199"></a>01199     var count = [_rowCache count],
<a name="l01200"></a>01200         i;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202     <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l01203"></a>01203     {
<a name="l01204"></a>01204          var cache = _rowCache[i];
<a name="l01205"></a>01205          <span class="keywordflow">if</span> ([cache rowObject] === rowObject)
<a name="l01206"></a>01206               <span class="keywordflow">return</span> cache;
<a name="l01207"></a>01207     }
<a name="l01208"></a>01208 
<a name="l01209"></a>01209     <span class="keywordflow">return</span> nil;
<a name="l01210"></a>01210 }
<a name="l01211"></a>01211 
<a name="l01212"></a>01212 - (int)_rowIndexForRowObject:(<span class="keywordtype">id</span>)rowobject
<a name="l01213"></a>01213 {
<a name="l01214"></a>01214     <span class="keywordflow">if</span> (rowobject == _boundArrayOwner)
<a name="l01215"></a>01215         <span class="keywordflow">return</span> -1;
<a name="l01216"></a>01216 
<a name="l01217"></a>01217     <span class="keywordflow">return</span> [[<span class="keyword">self</span> _searchCacheForRowObject:rowobject] rowIndex]; <span class="comment">// Pas bon car le rowIndex du row cache n&#39;est pas synchro avec la position dans _rowCache.</span>
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220 - (<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a>)_subrowObjectsOfObject:(<span class="keywordtype">id</span>)object
<a name="l01221"></a>01221 {
<a name="l01222"></a>01222     <span class="keywordflow">if</span> (<span class="keywordtype">object</span> === _boundArrayOwner)
<a name="l01223"></a>01223         <span class="keywordflow">return</span> [<span class="keyword">self</span> _rootRowsArray];
<a name="l01224"></a>01224 
<a name="l01225"></a>01225     <span class="keywordflow">return</span> [object mutableArrayValueForKey:_subrowsArrayKeyPath];
<a name="l01226"></a>01226 }
<a name="l01227"></a>01227 
<a name="l01228"></a>01228 - (<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)_childlessParentsIfSlicesWereDeletedAtIndexes:(<span class="keywordtype">id</span>)indexes
<a name="l01229"></a>01229 {
<a name="l01230"></a>01230     var childlessParents = [<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> <a class="code" href="class_c_p_index_set.html#a339845eb2d96fae878209105dde5e140">indexSet</a>],
<a name="l01231"></a>01231         current_index = [indexes firstIndex];
<a name="l01232"></a>01232 
<a name="l01233"></a>01233     <span class="keywordflow">while</span> (current_index != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l01234"></a>01234     {
<a name="l01235"></a>01235         var parentIndex = [<span class="keyword">self</span> parentRowForRow:current_index];
<a name="l01236"></a>01236 
<a name="l01237"></a>01237         var subrowsIndexes = [<span class="keyword">self</span> subrowIndexesForRow:parentIndex];
<a name="l01238"></a>01238         <span class="keywordflow">if</span> ([subrowsIndexes count]==1)
<a name="l01239"></a>01239         {
<a name="l01240"></a>01240             <span class="keywordflow">if</span> (parentIndex != -1)
<a name="l01241"></a>01241                 <span class="keywordflow">return</span> [<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> <a class="code" href="class_c_p_index_set.html#a4aa683fde78ba593d0e70040125ed306">indexSetWithIndex</a>:0];
<a name="l01242"></a>01242 
<a name="l01243"></a>01243             var childlessGranPa = [<span class="keyword">self</span> _childlessParentsIfSlicesWereDeletedAtIndexes:[<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> <a class="code" href="class_c_p_index_set.html#a4aa683fde78ba593d0e70040125ed306">indexSetWithIndex</a>:parentIndex]];
<a name="l01244"></a>01244             [childlessParents addIndexes:childlessGranPa];
<a name="l01245"></a>01245         }
<a name="l01246"></a>01246 
<a name="l01247"></a>01247         current_index = [indexes indexGreaterThanIndex:current_index];
<a name="l01248"></a>01248     }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250     <span class="keywordflow">return</span> childlessParents;
<a name="l01251"></a>01251     <span class="comment">// (id)-[RuleEditor _includeSubslicesForSlicesAtIndexes:]</span>
<a name="l01252"></a>01252 }
<a name="l01253"></a>01253 
<a name="l01254"></a>01254 - (<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)_includeSubslicesForSlicesAtIndexes:(<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)indexes
<a name="l01255"></a>01255 {
<a name="l01256"></a>01256     var subindexes = [indexes <a class="code" href="class_c_p_index_set.html#a3012b890a21584080a2a52e399b39f58">copy</a>],
<a name="l01257"></a>01257         current_index = [indexes <a class="code" href="class_c_p_index_set.html#abc895f4b5df7bdaf090161db6b234b73">firstIndex</a>];
<a name="l01258"></a>01258 
<a name="l01259"></a>01259     <span class="keywordflow">while</span> (current_index != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l01260"></a>01260     {
<a name="l01261"></a>01261         var sub = [<span class="keyword">self</span> subrowIndexesForRow:current_index];
<a name="l01262"></a>01262         [subindexes addIndexes:[<span class="keyword">self</span> _includeSubslicesForSlicesAtIndexes:sub]];
<a name="l01263"></a>01263         current_index = [indexes <a class="code" href="class_c_p_index_set.html#a3f66583eea02c42c2b14e53daf697559">indexGreaterThanIndex</a>:current_index];
<a name="l01264"></a>01264     }
<a name="l01265"></a>01265 
<a name="l01266"></a>01266     <span class="keywordflow">return</span> subindexes;
<a name="l01267"></a>01267 }
<a name="l01268"></a>01268 
<a name="l01269"></a>01269 - (void)_deleteSlice:(<span class="keywordtype">id</span>)slice
<a name="l01270"></a>01270 {
<a name="l01271"></a>01271     var rowindexes = [<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> <a class="code" href="class_c_p_index_set.html#a4aa683fde78ba593d0e70040125ed306">indexSetWithIndex</a>:[slice rowIndex]];
<a name="l01272"></a>01272 
<a name="l01273"></a>01273     <span class="keywordflow">if</span> (!_allowsEmptyCompoundRows)
<a name="l01274"></a>01274     {
<a name="l01275"></a>01275         var childlessIndexes = [<span class="keyword">self</span> _childlessParentsIfSlicesWereDeletedAtIndexes:rowindexes];
<a name="l01276"></a>01276         <span class="keywordflow">if</span> ([childlessIndexes count] &gt; 0)
<a name="l01277"></a>01277             rowindexes = childlessIndexes;
<a name="l01278"></a>01278     }
<a name="l01279"></a>01279 
<a name="l01280"></a>01280     [<span class="keyword">self</span> removeRowsAtIndexes:rowindexes includeSubrows:YES];
<a name="l01281"></a>01281     [<span class="keyword">self</span> _postRowCountChangedNotificationOfType:CPRuleEditorRowsDidChangeNotification indexes:rowindexes]; <span class="comment">// indexes should include childs</span>
<a name="l01282"></a>01282 }
<a name="l01283"></a>01283 
<a name="l01284"></a>01284 - (<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)_rootRowsArray
<a name="l01285"></a>01285 {
<a name="l01286"></a>01286     <span class="keywordflow">return</span> [_boundArrayOwner mutableArrayValueForKey:_boundArrayKeyPath];
<a name="l01287"></a>01287 }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289 - (BOOL)_nextUnusedItems:({<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>})items andValues:({<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>})values forRow:(<span class="keywordtype">int</span>)rowIndex forRowType:(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)type
<a name="l01290"></a>01290 {
<a name="l01291"></a>01291     var parentItem = [items <a class="code" href="interface_c_p_array.html#a8ad5370c1285197114b7b2b50928710c">lastObject</a>], <span class="comment">// if empty items array, this is NULL aka the root item;</span>
<a name="l01292"></a>01292         childrenCount = [<span class="keyword">self</span> _queryNumberOfChildrenOfItem:parentItem withRowType:type],
<a name="l01293"></a>01293         foundIndex = <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>;
<a name="l01294"></a>01294 
<a name="l01295"></a>01295     <span class="keywordflow">if</span> (childrenCount == 0)
<a name="l01296"></a>01296         <span class="keywordflow">return</span> NO;
<a name="l01297"></a>01297 
<a name="l01298"></a>01298     var current_criterions = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l01299"></a>01299         count = [<span class="keyword">self</span> numberOfRows],
<a name="l01300"></a>01300         row;
<a name="l01301"></a>01301 
<a name="l01302"></a>01302     <span class="keywordflow">for</span> (row = 0; row &lt; count; row++) <span class="comment">// num of rows should be num of siblings of parentItem</span>
<a name="l01303"></a>01303     {
<a name="l01304"></a>01304         var aCriteria = [<span class="keyword">self</span> criteriaForRow:row],
<a name="l01305"></a>01305             itemIndex = [items <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>];
<a name="l01306"></a>01306 
<a name="l01307"></a>01307         <span class="keywordflow">if</span> ([<span class="keyword">self</span> rowTypeForRow:row] == type &amp;&amp; itemIndex &lt; [aCriteria count])
<a name="l01308"></a>01308         {
<a name="l01309"></a>01309             var crit = [aCriteria objectAtIndex:itemIndex];
<a name="l01310"></a>01310             [current_criterions addObject:crit];
<a name="l01311"></a>01311         }
<a name="l01312"></a>01312     }
<a name="l01313"></a>01313 
<a name="l01314"></a>01314     <span class="keywordflow">while</span> (foundIndex == <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l01315"></a>01315     {
<a name="l01316"></a>01316         var buffer = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#a4811e54ee87ec16819a86d24523308db">arrayWithArray</a>:current_criterions],
<a name="l01317"></a>01317             i;
<a name="l01318"></a>01318         <span class="keywordflow">for</span> (i = 0; i &lt; childrenCount; i++)
<a name="l01319"></a>01319         {
<a name="l01320"></a>01320             var child =  [<span class="keyword">self</span> _queryChild:i ofItem:parentItem withRowType:type];
<a name="l01321"></a>01321             <span class="keywordflow">if</span> ([current_criterions indexOfObject:child] == <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l01322"></a>01322             {
<a name="l01323"></a>01323                 foundIndex = i;
<a name="l01324"></a>01324                 <span class="keywordflow">break</span>;
<a name="l01325"></a>01325             }
<a name="l01326"></a>01326         }
<a name="l01327"></a>01327 
<a name="l01328"></a>01328         <span class="keywordflow">if</span> (foundIndex == <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l01329"></a>01329         {
<a name="l01330"></a>01330             <span class="keywordflow">for</span> (var k = 0; k &lt; childrenCount; k++)
<a name="l01331"></a>01331             {
<a name="l01332"></a>01332                 var anobject = [<span class="keyword">self</span> _queryChild:k ofItem:parentItem withRowType:type],
<a name="l01333"></a>01333                     index = [buffer indexOfObject:anobject];
<a name="l01334"></a>01334                 <span class="keywordflow">if</span> (index != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l01335"></a>01335                     [buffer removeObjectAtIndex:index];
<a name="l01336"></a>01336             }
<a name="l01337"></a>01337 
<a name="l01338"></a>01338             current_criterions = buffer;
<a name="l01339"></a>01339         }
<a name="l01340"></a>01340     }
<a name="l01341"></a>01341 
<a name="l01342"></a>01342     var foundItem = [<span class="keyword">self</span> _queryChild:foundIndex ofItem:parentItem withRowType:type],
<a name="l01343"></a>01343         foundValue = [<span class="keyword">self</span> _queryValueForItem:foundItem inRow:rowIndex];
<a name="l01344"></a>01344 
<a name="l01345"></a>01345     [items addObject:foundItem];
<a name="l01346"></a>01346     [values addObject:foundValue];
<a name="l01347"></a>01347 
<a name="l01348"></a>01348     <span class="keywordflow">return</span> YES;
<a name="l01349"></a>01349 }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351 - (<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a>)_getItemsAndValuesToAddForRow:(<span class="keywordtype">int</span>)rowIndex ofType:(CPRuleEditorRowType)type
<a name="l01352"></a>01352 {
<a name="l01353"></a>01353     <span class="comment">//var cachedItemsAndValues = _itemsAndValuesToAddForRowType[type];</span>
<a name="l01354"></a>01354     <span class="comment">//if (cachedItemsAndValues)</span>
<a name="l01355"></a>01355     <span class="comment">//    return cachedItemsAndValues;</span>
<a name="l01356"></a>01356 
<a name="l01357"></a>01357     var itemsAndValues = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l01358"></a>01358         items = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l01359"></a>01359         values = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l01360"></a>01360         unusedItems = YES;
<a name="l01361"></a>01361 
<a name="l01362"></a>01362     <span class="keywordflow">while</span> (unusedItems)
<a name="l01363"></a>01363         unusedItems = [<span class="keyword">self</span> _nextUnusedItems:items andValues:values forRow:rowIndex forRowType:type];
<a name="l01364"></a>01364 
<a name="l01365"></a>01365     var count = [items <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>];
<a name="l01366"></a>01366 
<a name="l01367"></a>01367     <span class="keywordflow">for</span> (var i = 0; i &lt; count; i++)
<a name="l01368"></a>01368     {
<a name="l01369"></a>01369         var item = [items <a class="code" href="interface_c_p_array.html#a5f4c80df5e0ce9c9c7c64c7c24d917eb">objectAtIndex</a>:i],
<a name="l01370"></a>01370             value = [values <a class="code" href="interface_c_p_array.html#a5f4c80df5e0ce9c9c7c64c7c24d917eb">objectAtIndex</a>:i],
<a name="l01371"></a>01371             itemAndValue = [<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a> <a class="code" href="interface_c_p_dictionary.html#ac4d7617692c892eaed4d00de281c4c83">dictionaryWithObjects</a>:[item,value] <a class="code" href="interface_c_p_dictionary.html#ac4d7617692c892eaed4d00de281c4c83">forKeys</a>:[&quot;item&quot;,&quot;value&quot;]];
<a name="l01372"></a>01372 
<a name="l01373"></a>01373         [itemsAndValues addObject:itemAndValue];
<a name="l01374"></a>01374     }
<a name="l01375"></a>01375 
<a name="l01376"></a>01376     <span class="keywordflow">return</span> itemsAndValues;
<a name="l01377"></a>01377 }
<a name="l01378"></a>01378 
<a name="l01379"></a>01379 - (void)_addOptionFromSlice:(<span class="keywordtype">id</span>)slice ofRowType:(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)type
<a name="l01380"></a>01380 {
<a name="l01381"></a>01381     <span class="comment">// for CPRuleEditorNestingModeSimple only</span>
<a name="l01382"></a>01382 
<a name="l01383"></a>01383     var rowIndexEvent = [slice rowIndex],
<a name="l01384"></a>01384         rowTypeEvent = [<span class="keyword">self</span> rowTypeForRow:rowIndexEvent];
<a name="l01385"></a>01385 
<a name="l01386"></a>01386     var parentRowIndex = (rowTypeEvent == <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a>) ? rowIndexEvent:[<span class="keyword">self</span> parentRowForRow:rowIndexEvent];
<a name="l01387"></a>01387 
<a name="l01388"></a>01388     [<span class="keyword">self</span> insertRowAtIndex:rowIndexEvent + 1 withType:type asSubrowOfRow:parentRowIndex animate:YES];
<a name="l01389"></a>01389 
<a name="l01390"></a>01390     <span class="comment">// [self _reconfigureSubviewsAnimate:YES];</span>
<a name="l01391"></a>01391     <span class="comment">// [self _updatePredicate];</span>
<a name="l01392"></a>01392 }
<a name="l01393"></a>01393 
<a name="l01394"></a>01394 - (id)_insertNewRowAtIndex:(<span class="keywordtype">int</span>)insertIndex ofType:(CPRuleEditorRowType)rowtype withParentRow:(<span class="keywordtype">int</span>)parentRowIndex
<a name="l01395"></a>01395 {
<a name="l01396"></a>01396     var row = [[[<span class="keyword">self</span> rowClass] alloc] init];
<a name="l01397"></a>01397 
<a name="l01398"></a>01398     var itemsandvalues = [<span class="keyword">self</span> _getItemsAndValuesToAddForRow:insertIndex ofType:rowtype],
<a name="l01399"></a>01399         newitems = [itemsandvalues valueForKey:@&quot;item&quot;],
<a name="l01400"></a>01400         newvalues = [itemsandvalues valueForKey:@&quot;value&quot;];
<a name="l01401"></a>01401 
<a name="l01402"></a>01402     [row setValue:newitems forKey:_itemsKeyPath];
<a name="l01403"></a>01403     [row setValue:newvalues forKey:_valuesKeyPath];
<a name="l01404"></a>01404     [row setValue:rowtype forKey:_typeKeyPath];
<a name="l01405"></a>01405     [row setValue:[<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>] forKey:_subrowsArrayKeyPath];
<a name="l01406"></a>01406 
<a name="l01407"></a>01407     var subrowsObjects;
<a name="l01408"></a>01408     <span class="keywordflow">if</span> (parentRowIndex == -1 || [<span class="keyword">self</span> _applicableNestingMode] == <a class="code" href="_c_p_rule_editor_8j.html#abc68a04af6ac9e1280f2087c8e9d3e2f">CPRuleEditorNestingModeList</a>)
<a name="l01409"></a>01409         subrowsObjects = [<span class="keyword">self</span> _rootRowsArray];
<a name="l01410"></a>01410     <span class="keywordflow">else</span>
<a name="l01411"></a>01411     {
<a name="l01412"></a>01412         var parentRowObject = [[<span class="keyword">self</span> _rowCacheForIndex:parentRowIndex] rowObject];
<a name="l01413"></a>01413         subrowsObjects = [<span class="keyword">self</span> _subrowObjectsOfObject:parentRowObject];
<a name="l01414"></a>01414     }
<a name="l01415"></a>01415 
<a name="l01416"></a>01416     var relInsertIndex = insertIndex - parentRowIndex - 1;
<a name="l01417"></a>01417     [subrowsObjects insertObject:row atIndex:relInsertIndex];
<a name="l01418"></a>01418 
<a name="l01419"></a>01419     <span class="keywordflow">return</span> row;
<a name="l01420"></a>01420 }
<a name="l01421"></a>01421 
<a name="l01422"></a>01422 <span class="preprocessor">#pragma mark Key value observing</span>
<a name="l01423"></a>01423 <span class="preprocessor"></span>
<a name="l01424"></a>01424 - (void)_startObservingRowObjectsRecursively:(<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)rowObjects
<a name="l01425"></a>01425 {
<a name="l01426"></a>01426     [_boundArrayOwner addObserver:self forKeyPath:_boundArrayKeyPath options:CPKeyValueObservingOptionOld|CPKeyValueObservingOptionNew context:boundArrayContext];
<a name="l01427"></a>01427 
<a name="l01428"></a>01428     var count = [rowObjects <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>];
<a name="l01429"></a>01429 
<a name="l01430"></a>01430     <span class="keywordflow">for</span> (var i = 0; i &lt; count; i++)
<a name="l01431"></a>01431     {
<a name="l01432"></a>01432         var rowObject = [rowObjects <a class="code" href="interface_c_p_array.html#a5f4c80df5e0ce9c9c7c64c7c24d917eb">objectAtIndex</a>:i];
<a name="l01433"></a>01433 
<a name="l01434"></a>01434         [rowObject addObserver:self forKeyPath:_itemsKeyPath options:CPKeyValueObservingOptionOld|CPKeyValueObservingOptionNew context:itemsContext];
<a name="l01435"></a>01435         [rowObject addObserver:self forKeyPath:_valuesKeyPath options:CPKeyValueObservingOptionOld|CPKeyValueObservingOptionNew context:valuesContext];
<a name="l01436"></a>01436         [rowObject addObserver:self forKeyPath:_subrowsArrayKeyPath options:CPKeyValueObservingOptionOld|CPKeyValueObservingOptionNew context:subrowsContext];
<a name="l01437"></a>01437 
<a name="l01438"></a>01438         var subrows = [<span class="keyword">self</span> _subrowObjectsOfObject:rowObject];
<a name="l01439"></a>01439         <span class="keywordflow">if</span> ([subrows count] &gt; 0)
<a name="l01440"></a>01440             [<span class="keyword">self</span> _startObservingRowObjectsRecursively:subrows];
<a name="l01441"></a>01441     }
<a name="l01442"></a>01442     <span class="comment">// ORIG IMPL : calls +keyPathsForValuesAffectingValueForKey: for all keys</span>
<a name="l01443"></a>01443 }
<a name="l01444"></a>01444 
<a name="l01445"></a>01445 - (void)_stopObservingRowObjectsRecursively:(<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)rowObjects
<a name="l01446"></a>01446 {
<a name="l01447"></a>01447     [_boundArrayOwner removeObserver:self forKeyPath:_boundArrayKeyPath];
<a name="l01448"></a>01448 
<a name="l01449"></a>01449     var count = [rowObjects <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>];
<a name="l01450"></a>01450 
<a name="l01451"></a>01451     <span class="keywordflow">for</span> (var i = 0; i &lt; count; i++)
<a name="l01452"></a>01452     {
<a name="l01453"></a>01453         var rowObject = [rowObjects <a class="code" href="interface_c_p_array.html#a5f4c80df5e0ce9c9c7c64c7c24d917eb">objectAtIndex</a>:i];
<a name="l01454"></a>01454         [rowObject removeObserver:self forKeyPath:_itemsKeyPath];
<a name="l01455"></a>01455         [rowObject removeObserver:self forKeyPath:_valuesKeyPath];
<a name="l01456"></a>01456         [rowObject removeObserver:self forKeyPath:_subrowsArrayKeyPath];
<a name="l01457"></a>01457 
<a name="l01458"></a>01458         var subrows = [rowObject valueForKey:_subrowsArrayKeyPath];
<a name="l01459"></a>01459         <span class="keywordflow">if</span> ([subrows count] &gt; 0)
<a name="l01460"></a>01460             [<span class="keyword">self</span> _stopObservingRowObjectsRecursively:subrows];
<a name="l01461"></a>01461     }
<a name="l01462"></a>01462 }
<a name="l01463"></a>01463 
<a name="l01464"></a>01464 - (void)observeValueForKeyPath:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)keypath ofObject:(<span class="keywordtype">id</span>)object change:(<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a>)change context:(<span class="keywordtype">void</span>)context
<a name="l01465"></a>01465 {
<a name="l01466"></a>01466     var changeKind = [change <a class="code" href="interface_c_p_dictionary.html#a3c517acf439ab37a112456000fea7a9b">objectForKey</a>:CPKeyValueChangeKindKey],
<a name="l01467"></a>01467         changeNewValue = [change <a class="code" href="interface_c_p_dictionary.html#a3c517acf439ab37a112456000fea7a9b">objectForKey</a>:CPKeyValueChangeNewKey],
<a name="l01468"></a>01468         changeOldValue = [change <a class="code" href="interface_c_p_dictionary.html#a3c517acf439ab37a112456000fea7a9b">objectForKey</a>:CPKeyValueChangeOldKey],
<a name="l01469"></a>01469         newRows,
<a name="l01470"></a>01470         oldRows;
<a name="l01471"></a>01471 
<a name="l01472"></a>01472     <span class="keywordflow">if</span> (context == <a class="code" href="_c_p_rule_editor_8j.html#a8bff62fe6dcb4cc807b1a93164e5c46e">boundArrayContext</a> || context == <a class="code" href="_c_p_rule_editor_8j.html#a79dc5a73dd1ef67aa8ee8c953188cfee">subrowsContext</a>)
<a name="l01473"></a>01473     {
<a name="l01474"></a>01474         <span class="keywordflow">if</span> (changeKind == <a class="code" href="_c_p_key_value_observing_8j.html#ab38f2aa9a0051d00c8f26a6e0242de3c">CPKeyValueChangeSetting</a>)
<a name="l01475"></a>01475         {
<a name="l01476"></a>01476             newRows = changeNewValue;
<a name="l01477"></a>01477             oldRows = changeOldValue;
<a name="l01478"></a>01478 
<a name="l01479"></a>01479         }
<a name="l01480"></a>01480         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (changeKind == <a class="code" href="_c_p_key_value_observing_8j.html#a0ec9dcd852629ef5bb58f3f3ef252b9f">CPKeyValueChangeInsertion</a>)
<a name="l01481"></a>01481         {
<a name="l01482"></a>01482             newRows = [<span class="keyword">self</span> _subrowObjectsOfObject:object];
<a name="l01483"></a>01483             oldRows = [<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#a4811e54ee87ec16819a86d24523308db">arrayWithArray</a>:newRows];
<a name="l01484"></a>01484             [oldRows removeObjectsInArray:changeNewValue];
<a name="l01485"></a>01485         }
<a name="l01486"></a>01486         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (changeKind == <a class="code" href="_c_p_key_value_observing_8j.html#a8808275b0d3f2ba94f7fe97e50180b5e">CPKeyValueChangeRemoval</a>)
<a name="l01487"></a>01487         {
<a name="l01488"></a>01488             newRows = [<span class="keyword">self</span> _subrowObjectsOfObject:object];
<a name="l01489"></a>01489             oldRows = [<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#a4811e54ee87ec16819a86d24523308db">arrayWithArray</a>:newRows];
<a name="l01490"></a>01490             var delIndexes = [change <a class="code" href="interface_c_p_dictionary.html#a3c517acf439ab37a112456000fea7a9b">objectForKey</a>:CPKeyValueChangeIndexesKey];
<a name="l01491"></a>01491             [oldRows insertObjects:delObjects atIndexes:changeOldValue];    <span class="comment">// Pas sur que ce soit bon</span>
<a name="l01492"></a>01492         }
<a name="l01493"></a>01493 
<a name="l01494"></a>01494         [<span class="keyword">self</span> _changedRowArray:newRows withOldRowArray:oldRows forParent:object];
<a name="l01495"></a>01495 
<a name="l01496"></a>01496         [<span class="keyword">self</span> _reconfigureSubviewsAnimate:[<span class="keyword">self</span> _wantsRowAnimations]];
<a name="l01497"></a>01497         [<span class="keyword">self</span> _postRowCountChangedNotificationOfType:CPRuleEditorRowsDidChangeNotification indexes:[change <a class="code" href="interface_c_p_dictionary.html#a3c517acf439ab37a112456000fea7a9b">objectForKey</a>:CPKeyValueChangeIndexesKey]];
<a name="l01498"></a>01498 
<a name="l01499"></a>01499     }
<a name="l01500"></a>01500     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (context == <a class="code" href="_c_p_rule_editor_8j.html#a4f75c1ae12709156e424b601ca806c6e">itemsContext</a>)
<a name="l01501"></a>01501     {
<a name="l01502"></a>01502     }
<a name="l01503"></a>01503     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (context == <a class="code" href="_c_p_rule_editor_8j.html#a42fa15f29b9eab57eb3778f4ab02dfc2">valuesContext</a>)
<a name="l01504"></a>01504     {
<a name="l01505"></a>01505     }
<a name="l01506"></a>01506 }
<a name="l01507"></a>01507 
<a name="l01508"></a>01508 - (void)_changedItem:(<span class="keywordtype">id</span>)fromItem toItem:(<span class="keywordtype">id</span>)toItem inRow:(<span class="keywordtype">int</span>)aRow atCriteriaIndex:(<span class="keywordtype">int</span>)fromItemIndex
<a name="l01509"></a>01509 {
<a name="l01510"></a>01510     var criteria = [<span class="keyword">self</span> criteriaForRow:aRow],
<a name="l01511"></a>01511         displayValues = [<span class="keyword">self</span> displayValuesForRow:aRow],
<a name="l01512"></a>01512         rowType = [<span class="keyword">self</span> rowTypeForRow:aRow],
<a name="l01513"></a>01513         anItem = toItem;
<a name="l01514"></a>01514         <span class="comment">//fromItemIndex = [criteria indexOfObjectIdenticalTo:fromItem];</span>
<a name="l01515"></a>01515 
<a name="l01516"></a>01516     var items = [criteria subarrayWithRange:CPMakeRange(0, fromItemIndex)],
<a name="l01517"></a>01517         values = [displayValues subarrayWithRange:CPMakeRange(0, fromItemIndex)];
<a name="l01518"></a>01518 
<a name="l01519"></a>01519     _lastRow = aRow;
<a name="l01520"></a>01520 
<a name="l01521"></a>01521     <span class="keywordflow">while</span> (YES)
<a name="l01522"></a>01522     {
<a name="l01523"></a>01523         [items addObject:anItem];
<a name="l01524"></a>01524         var value = [<span class="keyword">self</span> _queryValueForItem:anItem inRow:aRow];
<a name="l01525"></a>01525         [values addObject:value];
<a name="l01526"></a>01526 
<a name="l01527"></a>01527         <span class="keywordflow">if</span> (![<span class="keyword">self</span> _queryNumberOfChildrenOfItem:anItem withRowType:rowType])
<a name="l01528"></a>01528             <span class="keywordflow">break</span>;
<a name="l01529"></a>01529 
<a name="l01530"></a>01530         anItem = [<span class="keyword">self</span> _queryChild:0 ofItem:anItem withRowType:rowType];
<a name="l01531"></a>01531     }
<a name="l01532"></a>01532 
<a name="l01533"></a>01533     var <span class="keywordtype">object</span> = [[<span class="keyword">self</span> _rowCacheForIndex:aRow] rowObject];
<a name="l01534"></a>01534     [object setValue:items forKey:_itemsKeyPath];
<a name="l01535"></a>01535     [object setValue:values forKey:_valuesKeyPath];
<a name="l01536"></a>01536 
<a name="l01537"></a>01537     var slice = [_slices objectAtIndex:aRow];
<a name="l01538"></a>01538     [slice _reconfigureSubviews];
<a name="l01539"></a>01539     [<span class="keyword">self</span>  _sendRuleAction];
<a name="l01540"></a>01540     [<span class="keyword">self</span> _postRuleOptionChangedNotification];
<a name="l01541"></a>01541 }
<a name="l01542"></a>01542 
<a name="l01543"></a>01543 - (void)_changedRowArray:(<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)newRows withOldRowArray:(<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)oldRows forParent:(<span class="keywordtype">id</span>)parentRowObject
<a name="l01544"></a>01544 {
<a name="l01545"></a>01545     var newRowCount = [newRows <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>],
<a name="l01546"></a>01546         oldRowCount = [oldRows <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>],
<a name="l01547"></a>01547         deltaCount = newRowCount - oldRowCount,
<a name="l01548"></a>01548         minusCount = MIN(newRowCount, oldRowCount),
<a name="l01549"></a>01549         maxCount = MAX(newRowCount, oldRowCount),
<a name="l01550"></a>01550 
<a name="l01551"></a>01551         insertCacheIndexes = [<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> indexSet],
<a name="l01552"></a>01552         newCaches = [<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> array],
<a name="l01553"></a>01553 
<a name="l01554"></a>01554         parentCacheIndentation,
<a name="l01555"></a>01555         parentCacheIndex = [self _rowIndexForRowObject:parentRowObject],
<a name="l01556"></a>01556 
<a name="l01557"></a>01557         newRowCacheIndex = 0,
<a name="l01558"></a>01558         changeStartIndex = 0;
<a name="l01559"></a>01559 
<a name="l01560"></a>01560     [<span class="keyword">self</span> _stopObservingRowObjectsRecursively:oldRows];
<a name="l01561"></a>01561     [<span class="keyword">self</span> _startObservingRowObjectsRecursively:newRows];
<a name="l01562"></a>01562 
<a name="l01563"></a>01563     <span class="comment">//var gindexes = [self _globalIndexesForSubrowIndexes:[CPIndexSet indexSetWithIndexesInRange:CPMakeRange(0,oldRowCount)] ofParentObject:parentRowObject];</span>
<a name="l01564"></a>01564 
<a name="l01565"></a>01565     <span class="keywordflow">if</span> (parentCacheIndex == -1)
<a name="l01566"></a>01566         parentCacheIndentation = -1;
<a name="l01567"></a>01567     <span class="keywordflow">else</span>
<a name="l01568"></a>01568         parentCacheIndentation = [[<span class="keyword">self</span> _rowCacheForIndex:parentCacheIndex] indentation];
<a name="l01569"></a>01569 
<a name="l01570"></a>01570     <span class="keywordflow">for</span> (; newRowCacheIndex &lt; newRowCount; newRowCacheIndex++)
<a name="l01571"></a>01571     {
<a name="l01572"></a>01572         var newCacheGlobalIndex = (parentCacheIndex + 1) + newRowCacheIndex,
<a name="l01573"></a>01573             obj = [newRows objectAtIndex:newRowCacheIndex],
<a name="l01574"></a>01574             newRowType = [obj valueForKey:_typeKeyPath];
<a name="l01575"></a>01575 
<a name="l01576"></a>01576         var cache = [[_CPRuleEditorCache alloc] init];
<a name="l01577"></a>01577         [cache setRowObject:obj];
<a name="l01578"></a>01578         [cache setRowIndex:newCacheGlobalIndex];
<a name="l01579"></a>01579         [cache setIndentation:parentCacheIndentation + 1];
<a name="l01580"></a>01580 
<a name="l01581"></a>01581         [insertCacheIndexes addIndex:newCacheGlobalIndex];
<a name="l01582"></a>01582         [newCaches addObject:cache];
<a name="l01583"></a>01583     }
<a name="l01584"></a>01584 
<a name="l01585"></a>01585     <span class="comment">//var lastCacheIndex = [self _rowIndexForRowObject:[oldRows lastObject]];</span>
<a name="l01586"></a>01586     [_rowCache removeObjectsInRange:CPMakeRange(parentCacheIndex + 1, [oldRows <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>])];
<a name="l01587"></a>01587     [_rowCache insertObjects:newCaches atIndexes:insertCacheIndexes];
<a name="l01588"></a>01588 
<a name="l01589"></a>01589     <span class="keywordflow">for</span> (; changeStartIndex &lt; minusCount; changeStartIndex++)
<a name="l01590"></a>01590     {
<a name="l01591"></a>01591         var oldrow = [oldRows <a class="code" href="interface_c_p_array.html#a5f4c80df5e0ce9c9c7c64c7c24d917eb">objectAtIndex</a>:changeStartIndex],
<a name="l01592"></a>01592             newrow = [newRows <a class="code" href="interface_c_p_array.html#a5f4c80df5e0ce9c9c7c64c7c24d917eb">objectAtIndex</a>:changeStartIndex];
<a name="l01593"></a>01593 
<a name="l01594"></a>01594         <span class="keywordflow">if</span> (newrow != oldrow)
<a name="l01595"></a>01595             <span class="keywordflow">break</span>;
<a name="l01596"></a>01596     }
<a name="l01597"></a>01597 
<a name="l01598"></a>01598     var replaceCount = (deltaCount == 0) ? maxCount : maxCount - minusCount;
<a name="l01599"></a>01599     var startIndex = parentCacheIndex + changeStartIndex + 1;
<a name="l01600"></a>01600 
<a name="l01601"></a>01601     <span class="keywordflow">if</span> (deltaCount &lt;= 0)
<a name="l01602"></a>01602     {
<a name="l01603"></a>01603         var removeIndexes = [<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> <a class="code" href="class_c_p_index_set.html#a4c32a454bd5323253b9e8c4f81712ea5">indexSetWithIndexesInRange</a>:CPMakeRange(startIndex, replaceCount)];
<a name="l01604"></a>01604         var removeSlices = [_slices objectsAtIndexes:removeIndexes];
<a name="l01605"></a>01605         [removeSlices makeObjectsPerformSelector:@selector(removeFromSuperview)];
<a name="l01606"></a>01606         [_slices removeObjectsAtIndexes:removeIndexes];
<a name="l01607"></a>01607     }
<a name="l01608"></a>01608 
<a name="l01609"></a>01609     <span class="keywordflow">if</span> (deltaCount &gt;= 0)
<a name="l01610"></a>01610     {
<a name="l01611"></a>01611         var newIndentation = parentCacheIndentation + 1,
<a name="l01612"></a>01612             newIndex = startIndex;
<a name="l01613"></a>01613 
<a name="l01614"></a>01614         <span class="keywordflow">for</span> (; newIndex &lt; startIndex + replaceCount; newIndex++)
<a name="l01615"></a>01615         {
<a name="l01616"></a>01616             var newslice = [<span class="keyword">self</span> _newSlice],
<a name="l01617"></a>01617                 rowType = [<span class="keyword">self</span> rowTypeForRow:newIndex];
<a name="l01618"></a>01618 
<a name="l01619"></a>01619             [newslice setRowIndex:newIndex];
<a name="l01620"></a>01620             [newslice setIndentation:newIndentation];
<a name="l01621"></a>01621             [newslice _setRowType:rowType];
<a name="l01622"></a>01622             [newslice _configurePlusButtonByRowType:CPRuleEditorRowTypeSimple];
<a name="l01623"></a>01623 
<a name="l01624"></a>01624             [_slices insertObject:newslice atIndex:newIndex];
<a name="l01625"></a>01625         }
<a name="l01626"></a>01626     }
<a name="l01627"></a>01627 
<a name="l01628"></a>01628     var emptyArray = [<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l01629"></a>01629         count = [oldRows <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>],
<a name="l01630"></a>01630         n;
<a name="l01631"></a>01631     <span class="keywordflow">for</span> (n = 0; n &lt; count; n++)
<a name="l01632"></a>01632     {
<a name="l01633"></a>01633         var oldRow = [oldRows <a class="code" href="interface_c_p_array.html#a5f4c80df5e0ce9c9c7c64c7c24d917eb">objectAtIndex</a>:n],
<a name="l01634"></a>01634             subOldRows = [<span class="keyword">self</span> _subrowObjectsOfObject:oldRow];
<a name="l01635"></a>01635 
<a name="l01636"></a>01636         <span class="keywordflow">if</span> ([subOldRows count] &gt; 0)
<a name="l01637"></a>01637             [<span class="keyword">self</span> _changedRowArray:emptyArray withOldRowArray:subOldRows forParent:oldRow];
<a name="l01638"></a>01638     }
<a name="l01639"></a>01639 
<a name="l01640"></a>01640     count = [newRows <a class="code" href="interface_c_p_array.html#ae8abed7c67002d9a883005aa40e4fb55">count</a>];
<a name="l01641"></a>01641     <span class="keywordflow">for</span> (n = 0; n &lt; count; n++)
<a name="l01642"></a>01642     {
<a name="l01643"></a>01643         var newRow = [newRows <a class="code" href="interface_c_p_array.html#a5f4c80df5e0ce9c9c7c64c7c24d917eb">objectAtIndex</a>:n],
<a name="l01644"></a>01644             subnewRows = [<span class="keyword">self</span> _subrowObjectsOfObject:newRow];
<a name="l01645"></a>01645 
<a name="l01646"></a>01646         <span class="keywordflow">if</span> ([subnewRows count] &gt; 0)
<a name="l01647"></a>01647             [<span class="keyword">self</span> _changedRowArray:subnewRows withOldRowArray:emptyArray forParent:newRow];
<a name="l01648"></a>01648     }
<a name="l01649"></a>01649 }
<a name="l01650"></a>01650 
<a name="l01651"></a>01651 - (void)bind:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)binding toObject:(<span class="keywordtype">id</span>)observableController withKeyPath:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)keyPath options:(<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a>)options
<a name="l01652"></a>01652 {
<a name="l01653"></a>01653     <span class="keywordflow">if</span> (keyPath == nil || [observableController valueForKey:keyPath] == nil)
<a name="l01654"></a>01654     {
<a name="l01655"></a>01655         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPInvalidArgumentException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:&quot;Keypath or bound object cannot be nil&quot;];
<a name="l01656"></a>01656         <span class="keywordflow">return</span>;
<a name="l01657"></a>01657     }
<a name="l01658"></a>01658 
<a name="l01659"></a>01659     <span class="keywordflow">if</span> ([binding isEqualToString:<span class="stringliteral">@&quot;rows&quot;</span>])
<a name="l01660"></a>01660     {
<a name="l01661"></a>01661         <span class="keywordflow">if</span> ([observableController respondsToSelector:<span class="keyword">@selector</span>(objectClass)])
<a name="l01662"></a>01662             _rowClass = [observableController objectClass];
<a name="l01663"></a>01663 
<a name="l01664"></a>01664          [<span class="keyword">self</span> _setBoundDataSource:observableController withKeyPath:keyPath options:options];
<a name="l01665"></a>01665     }
<a name="l01666"></a>01666     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([binding isEqualToString:<a class="code" href="_c_p_key_value_binding_8j.html#ac3494380a577f831b2a9eb39c4fb49c1">CPValueBinding</a>])
<a name="l01667"></a>01667         [super bind:binding toObject:observableController withKeyPath:keyPath options:options];
<a name="l01668"></a>01668     <span class="keywordflow">else</span>
<a name="l01669"></a>01669         [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPInvalidArgumentException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:&quot;Keypath or bound object cannot be nil&quot;];
<a name="l01670"></a>01670 }
<a name="l01671"></a>01671 
<a name="l01672"></a>01672 - (void)unbind:(<span class="keywordtype">id</span>)object
<a name="l01673"></a>01673 {
<a name="l01674"></a>01674     _rowClass = [<a class="code" href="class_row_object.html">RowObject</a> class];
<a name="l01675"></a>01675     [<span class="keyword">super</span> unbind:object];
<a name="l01676"></a>01676 }
<a name="l01677"></a>01677 
<a name="l01678"></a>01678 - (void)_setBoundDataSource:(<span class="keywordtype">id</span>)datasource withKeyPath:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)keyPath options:(<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a>)options
<a name="l01679"></a>01679 {
<a name="l01680"></a>01680     <span class="keywordflow">if</span> (_boundArrayOwner != nil)
<a name="l01681"></a>01681         [_boundArrayOwner removeObserver:<span class="keyword">self</span> forKeyPath:_boundArrayKeyPath];
<a name="l01682"></a>01682 
<a name="l01683"></a>01683     _boundArrayKeyPath = keyPath;
<a name="l01684"></a>01684     _boundArrayOwner = datasource;
<a name="l01685"></a>01685 
<a name="l01686"></a>01686     var boundRows = [_boundArrayOwner valueForKey:_boundArrayKeyPath];
<a name="l01687"></a>01687 
<a name="l01688"></a>01688     [_boundArrayOwner addObserver:self forKeyPath:_boundArrayKeyPath options:CPKeyValueObservingOptionOld|CPKeyValueObservingOptionNew context:boundArrayContext];
<a name="l01689"></a>01689 
<a name="l01690"></a>01690     <span class="keywordflow">if</span> ([boundRows isKindOfClass:[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <span class="keyword">class</span>]] &amp;&amp; [boundRows count] &gt; 0)
<a name="l01691"></a>01691         [_boundArrayOwner setValue:boundRows forKey:_boundArrayKeyPath];
<a name="l01692"></a>01692 }
<a name="l01693"></a>01693 
<a name="l01694"></a>01694 - (void)_setPredicate:(<a class="code" href="interface_c_p_predicate.html" title="The CPPredicate class is used to define logical conditions used to constrain a search either for a fe...">CPPredicate</a>)predicate
<a name="l01695"></a>01695 {
<a name="l01696"></a>01696     <span class="keywordflow">if</span> (_predicate !== predicate)
<a name="l01697"></a>01697         _predicate = predicate;
<a name="l01698"></a>01698 }
<a name="l01699"></a>01699 
<a name="l01700"></a>01700 - (void)_updatePredicate
<a name="l01701"></a>01701 {
<a name="l01702"></a>01702     <span class="keywordflow">if</span> (_delegateWantsValidation)
<a name="l01703"></a>01703     {
<a name="l01704"></a>01704         var selector = <span class="keyword">@selector</span>(ruleEditor:predicatePartsForCriterion:withDisplayValue:inRow:);
<a name="l01705"></a>01705         <span class="keywordflow">if</span> (![_ruleDelegate respondsToSelector:selector])
<a name="l01706"></a>01706             <span class="keywordflow">return</span>;
<a name="l01707"></a>01707 
<a name="l01708"></a>01708         _delegateWantsValidation = NO;
<a name="l01709"></a>01709     }
<a name="l01710"></a>01710 
<a name="l01711"></a>01711     var subpredicates = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l01712"></a>01712         subindexes = [<span class="keyword">self</span> subrowIndexesForRow:-1],
<a name="l01713"></a>01713         current_index = [subindexes firstIndex];
<a name="l01714"></a>01714 
<a name="l01715"></a>01715     <span class="keywordflow">while</span> (current_index != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l01716"></a>01716     {
<a name="l01717"></a>01717         var subpredicate = [<span class="keyword">self</span> predicateForRow:current_index];
<a name="l01718"></a>01718 
<a name="l01719"></a>01719         <span class="keywordflow">if</span> (subpredicate != nil)
<a name="l01720"></a>01720             [subpredicates addObject:subpredicate];
<a name="l01721"></a>01721 
<a name="l01722"></a>01722         current_index = [subindexes indexGreaterThanIndex:current_index];
<a name="l01723"></a>01723     }
<a name="l01724"></a>01724 
<a name="l01725"></a>01725     var new_predicate = [[<a class="code" href="interface_c_p_compound_predicate.html" title="CPCompoundPredicate is a subclass of CPPredicate used to represent logical “gate” operations (AND/OR/...">CPCompoundPredicate</a> alloc] initWithType:CPOrPredicateType subpredicates:subpredicates];
<a name="l01726"></a>01726 
<a name="l01727"></a>01727     [<span class="keyword">self</span> _setPredicate:new_predicate];
<a name="l01728"></a>01728 }
<a name="l01729"></a>01729 
<a name="l01730"></a>01730 - (_CPRuleEditorViewSliceRow)_newSlice
<a name="l01731"></a>01731 {
<a name="l01732"></a>01732     var sliceRect = CGRectMake(0, 0, CGRectGetWidth([<span class="keyword">self</span> <a class="code" href="_c_p_segmented_control_8j.html#a63fcc9e0dd97e8502cce685e88234e16">frame</a>]), 0),
<a name="l01733"></a>01733         slice = [<span class="keyword">self</span> _createNewSliceWithFrame:sliceRect ruleEditorView:self];
<a name="l01734"></a>01734 
<a name="l01735"></a>01735     <span class="keywordflow">return</span> slice;
<a name="l01736"></a>01736 }
<a name="l01737"></a>01737 
<a name="l01738"></a>01738 - (_CPRuleEditorViewSliceRow)_createNewSliceWithFrame:(CGRect)frame ruleEditorView:(<a class="code" href="interface_c_p_rule_editor.html" title="A view for creating and configuring criteria.">CPRuleEditor</a>)editor
<a name="l01739"></a>01739 {
<a name="l01740"></a>01740     <span class="keywordflow">return</span> [[_CPRuleEditorViewSliceRow alloc] initWithFrame:frame ruleEditorView:editor];
<a name="l01741"></a>01741 }
<a name="l01742"></a>01742 
<a name="l01743"></a>01743 - (void)_reconfigureSubviewsAnimate:(BOOL)animate
<a name="l01744"></a>01744 {
<a name="l01745"></a>01745     [<span class="keyword">self</span> _updateSliceRows];
<a name="l01746"></a>01746 
<a name="l01747"></a>01747     var viewAnimations = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l01748"></a>01748         added_slices = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l01749"></a>01749         count = [_slices count];
<a name="l01750"></a>01750 
<a name="l01751"></a>01751     <span class="keywordflow">for</span> (var i = 0; i &lt; count; i++)
<a name="l01752"></a>01752     {
<a name="l01753"></a>01753         var aslice = [_slices objectAtIndex:i],
<a name="l01754"></a>01754             targetRect = [aslice _animationTargetRect],
<a name="l01755"></a>01755             startRect = [aslice frame],
<a name="l01756"></a>01756             startIndex = [aslice rowIndex] - 1;
<a name="l01757"></a>01757 
<a name="l01758"></a>01758         <span class="keywordflow">if</span> ([aslice superview] == nil)
<a name="l01759"></a>01759         {
<a name="l01760"></a>01760             startRect = CGRectMake(0, startIndex * _sliceHeight, CGRectGetWidth(startRect), _sliceHeight);
<a name="l01761"></a>01761             [aslice _reconfigureSubviews];
<a name="l01762"></a>01762             [added_slices addObject:aslice];
<a name="l01763"></a>01763         }
<a name="l01764"></a>01764 
<a name="l01765"></a>01765         <span class="keywordflow">if</span> (animate)
<a name="l01766"></a>01766         {
<a name="l01767"></a>01767             var animation = [<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a> <a class="code" href="interface_c_p_dictionary.html#af9820df885270d5200f27f9a539aca28">dictionary</a>];
<a name="l01768"></a>01768             [animation setObject:aslice forKey:CPViewAnimationTargetKey];
<a name="l01769"></a>01769             [animation setObject:startRect forKey:CPViewAnimationStartFrameKey];
<a name="l01770"></a>01770             [animation setObject:targetRect forKey:CPViewAnimationEndFrameKey];
<a name="l01771"></a>01771 
<a name="l01772"></a>01772             [viewAnimations insertObject:animation atIndex:0];
<a name="l01773"></a>01773         }
<a name="l01774"></a>01774         <span class="keywordflow">else</span>
<a name="l01775"></a>01775             [aslice setFrame:targetRect];
<a name="l01776"></a>01776     }
<a name="l01777"></a>01777 
<a name="l01778"></a>01778     var addcount = [added_slices count];
<a name="l01779"></a>01779     <span class="keywordflow">for</span> (var i = 0; i &lt; addcount; i++)
<a name="l01780"></a>01780         [_slicesHolder addSubview:added_slices[i] positioned:CPWindowBelow relativeTo:nil];
<a name="l01781"></a>01781 
<a name="l01782"></a>01782     <span class="keywordflow">if</span> (animate)
<a name="l01783"></a>01783     {
<a name="l01784"></a>01784         [_currentAnimation setViewAnimations:viewAnimations];
<a name="l01785"></a>01785         [_currentAnimation startAnimation];
<a name="l01786"></a>01786     }
<a name="l01787"></a>01787 
<a name="l01788"></a>01788     _lastRow = [<span class="keyword">self</span> numberOfRows] - 1;
<a name="l01789"></a>01789 
<a name="l01790"></a>01790     <span class="keywordflow">if</span> (_lastRow == -1)
<a name="l01791"></a>01791         _nestingModeDidChange = NO;
<a name="l01792"></a>01792 
<a name="l01793"></a>01793     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l01794"></a>01794     [_slices makeObjectsPerformSelector:@selector(_updateButtonVisibilities)];
<a name="l01795"></a>01795 }
<a name="l01796"></a>01796 
<a name="l01797"></a>01797 - (void)animationDidEnd:(<a class="code" href="interface_c_p_view_animation.html">CPViewAnimation</a>)animation
<a name="l01798"></a>01798 {
<a name="l01799"></a>01799 <span class="comment">//  var nextSimple = [self _getItemsAndValuesToAddForRow:0 ofType:CPRuleEditorRowTypeSimple],</span>
<a name="l01800"></a>01800 <span class="comment">//      nextCompound = [self _getItemsAndValuesToAddForRow:0 ofType:CPRuleEditorRowTypeCompound];</span>
<a name="l01801"></a>01801 
<a name="l01802"></a>01802 <span class="comment">//  _itemsAndValuesToAddForRowType = {CPRuleEditorRowTypeSimple:nextSimple, CPRuleEditorRowTypeCompound:nextCompound};</span>
<a name="l01803"></a>01803 }
<a name="l01804"></a>01804 
<a name="l01805"></a>01805 - (void)_updateSliceRows
<a name="l01806"></a>01806 {
<a name="l01807"></a>01807     var <a class="code" href="_c_g_geometry_8j.html#a52b64513cb182b63f0e848f53bddad9b">width</a> =  [<span class="keyword">self</span> frame].size.width,
<a name="l01808"></a>01808         count = [_slices count];
<a name="l01809"></a>01809 
<a name="l01810"></a>01810     <span class="keywordflow">for</span> (var i = 0; i &lt; count; i++)
<a name="l01811"></a>01811     {
<a name="l01812"></a>01812         var slice = [_slices objectAtIndex:i],
<a name="l01813"></a>01813             targetRect = CGRectMake(0, i * _sliceHeight, width, _sliceHeight);
<a name="l01814"></a>01814 
<a name="l01815"></a>01815         [slice setRowIndex:i];
<a name="l01816"></a>01816         [slice _setAnimationTargetRect:targetRect];
<a name="l01817"></a>01817     }
<a name="l01818"></a>01818 }
<a name="l01819"></a>01819 
<a name="l01820"></a>01820 - (<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)_backgroundColors
<a name="l01821"></a>01821 {
<a name="l01822"></a>01822     <span class="keywordflow">return</span> [<span class="keyword">self</span> valueForThemeAttribute:@&quot;alternating-row-colors&quot;];
<a name="l01823"></a>01823 }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825 - (<a class="code" href="interface_c_p_color.html">CPColor</a>)_selectedRowColor
<a name="l01826"></a>01826 {
<a name="l01827"></a>01827     <span class="keywordflow">return</span> [<span class="keyword">self</span> valueForThemeAttribute:@&quot;selected-color&quot;];
<a name="l01828"></a>01828 }
<a name="l01829"></a>01829 
<a name="l01830"></a>01830 - (<a class="code" href="interface_c_p_color.html">CPColor</a>)_sliceTopBorderColor
<a name="l01831"></a>01831 {
<a name="l01832"></a>01832     <span class="keywordflow">return</span> [<span class="keyword">self</span> valueForThemeAttribute:@&quot;slice-top-border-color&quot;];
<a name="l01833"></a>01833 }
<a name="l01834"></a>01834 
<a name="l01835"></a>01835 - (<a class="code" href="interface_c_p_color.html">CPColor</a>)_sliceBottomBorderColor
<a name="l01836"></a>01836 {
<a name="l01837"></a>01837     <span class="keywordflow">return</span> [<span class="keyword">self</span> valueForThemeAttribute:@&quot;slice-bottom-border-color&quot;];
<a name="l01838"></a>01838 }
<a name="l01839"></a>01839 
<a name="l01840"></a>01840 - (<a class="code" href="interface_c_p_color.html">CPColor</a>)_sliceLastBottomBorderColor
<a name="l01841"></a>01841 {
<a name="l01842"></a>01842     <span class="keywordflow">return</span> [<span class="keyword">self</span> valueForThemeAttribute:@&quot;slice-last-bottom-border-color&quot;];
<a name="l01843"></a>01843 }
<a name="l01844"></a>01844 
<a name="l01845"></a>01845 - (<a class="code" href="interface_c_p_font.html">CPFont</a>)font
<a name="l01846"></a>01846 {
<a name="l01847"></a>01847     <span class="keywordflow">return</span> [<span class="keyword">self</span> valueForThemeAttribute:@&quot;font&quot;];
<a name="l01848"></a>01848 }
<a name="l01849"></a>01849 
<a name="l01850"></a>01850 - (<a class="code" href="interface_c_p_image.html">CPImage</a>)_addImage
<a name="l01851"></a>01851 {
<a name="l01852"></a>01852     <span class="keywordflow">return</span> [<span class="keyword">self</span> valueForThemeAttribute:@&quot;add-image&quot;];
<a name="l01853"></a>01853 }
<a name="l01854"></a>01854 
<a name="l01855"></a>01855 - (<a class="code" href="interface_c_p_image.html">CPImage</a>)_removeImage
<a name="l01856"></a>01856 {
<a name="l01857"></a>01857     <span class="keywordflow">return</span> [<span class="keyword">self</span> valueForThemeAttribute:@&quot;remove-image&quot;];
<a name="l01858"></a>01858 }
<a name="l01859"></a>01859 
<a name="l01860"></a>01860 - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)_toolTipForAddCompoundRowButton
<a name="l01861"></a>01861 {
<a name="l01862"></a>01862     <span class="keywordflow">return</span> <span class="stringliteral">@&quot;Add Compound row&quot;</span>;
<a name="l01863"></a>01863 }
<a name="l01864"></a>01864 
<a name="l01865"></a>01865 - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)_toolTipForAddSimpleRowButton
<a name="l01866"></a>01866 {
<a name="l01867"></a>01867     <span class="keywordflow">return</span> <span class="stringliteral">@&quot;Add row&quot;</span>;
<a name="l01868"></a>01868 }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870 - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)_toolTipForDeleteRowButton
<a name="l01871"></a>01871 {
<a name="l01872"></a>01872     <span class="keywordflow">return</span> <span class="stringliteral">@&quot;Delete row&quot;</span>;
<a name="l01873"></a>01873 }
<a name="l01874"></a>01874 
<a name="l01875"></a>01875 - (void)_updateSliceIndentations
<a name="l01876"></a>01876 {
<a name="l01877"></a>01877     [<span class="keyword">self</span> _updateSliceIndentationAtIndex:0 toIndentation:0 withIndexSet:[<span class="keyword">self</span> subrowIndexesForRow:0]];
<a name="l01878"></a>01878 }
<a name="l01879"></a>01879 
<a name="l01880"></a>01880 - (void)_updateSliceIndentationAtIndex:(<span class="keywordtype">int</span>)index toIndentation:(<span class="keywordtype">int</span>)indentation withIndexSet:(<span class="keywordtype">id</span>)indexes
<a name="l01881"></a>01881 {
<a name="l01882"></a>01882     var current_index = [indexes firstIndex];
<a name="l01883"></a>01883 
<a name="l01884"></a>01884     <span class="keywordflow">while</span> (current_index !=<a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l01885"></a>01885     {
<a name="l01886"></a>01886         var subindexes = [<span class="keyword">self</span> subrowIndexesForRow:index];
<a name="l01887"></a>01887         [<span class="keyword">self</span> _updateSliceIndentationAtIndex:current_index toIndentation:indentation + 1 withIndexSet:subindexes];
<a name="l01888"></a>01888         current_index = [indexes indexGreaterThanIndex:current_index];
<a name="l01889"></a>01889     }
<a name="l01890"></a>01890 
<a name="l01891"></a>01891     [[_slices objectAtIndex:index] setIndentation:indentation];
<a name="l01892"></a>01892 }
<a name="l01893"></a>01893 
<a name="l01894"></a>01894 - (<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>)_selectedSlices
<a name="l01895"></a>01895 {
<a name="l01896"></a>01896     var _selectedSlices = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l01897"></a>01897         count = [_slices count],
<a name="l01898"></a>01898         i;
<a name="l01899"></a>01899 
<a name="l01900"></a>01900     <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l01901"></a>01901     {
<a name="l01902"></a>01902         var slice = _slices[i];
<a name="l01903"></a>01903         <span class="keywordflow">if</span> ([slice _isSelected])
<a name="l01904"></a>01904             [_selectedSlices addObject:slice];
<a name="l01905"></a>01905     }
<a name="l01906"></a>01906 
<a name="l01907"></a>01907     <span class="keywordflow">return</span> _selectedSlices;
<a name="l01908"></a>01908 }
<a name="l01909"></a>01909 
<a name="l01910"></a>01910 - (int)_lastSelectedSliceIndex
<a name="l01911"></a>01911 {
<a name="l01912"></a>01912     var lastIndex = -1,
<a name="l01913"></a>01913         count = [_slices count],
<a name="l01914"></a>01914         i;
<a name="l01915"></a>01915 
<a name="l01916"></a>01916     <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l01917"></a>01917     {
<a name="l01918"></a>01918          var slice = _slices[i];
<a name="l01919"></a>01919          <span class="keywordflow">if</span> ([slice _isLastSelected])
<a name="l01920"></a>01920             <span class="keywordflow">return</span> [slice rowIndex];
<a name="l01921"></a>01921     }
<a name="l01922"></a>01922 
<a name="l01923"></a>01923     <span class="keywordflow">return</span> <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>;
<a name="l01924"></a>01924 }
<a name="l01925"></a>01925 
<a name="l01926"></a>01926 - (void)_mouseUpOnSlice:(<span class="keywordtype">id</span>)slice withEvent:(<a class="code" href="interface_c_p_event.html">CPEvent</a>)event
<a name="l01927"></a>01927 {
<a name="l01928"></a>01928     <span class="keywordflow">if</span> ([slice _rowType] != <a class="code" href="_c_p_rule_editor_8j.html#a597f976009fd1e7d8af2a9e90901fb14">CPRuleEditorRowTypeSimple</a>)
<a name="l01929"></a>01929         <span class="keywordflow">return</span>;
<a name="l01930"></a>01930 
<a name="l01931"></a>01931     var modifierFlags = [event <a class="code" href="interface_c_p_event.html#ae1990580a2f73b19009f30f27ff1e396">modifierFlags</a>],
<a name="l01932"></a>01932         extend = (modifierFlags &amp; <a class="code" href="_c_p_event_8j.html#a675a3ab6cfc14dd4ad6702d7c682c7fe">CPCommandKeyMask</a>) || (modifierFlags &amp; <a class="code" href="_c_p_event_8j.html#a2343191b34b38dc1952bb44d83fa30d6">CPShiftKeyMask</a>),
<a name="l01933"></a>01933         rowIndexes = [<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> indexSetWithIndex:[slice rowIndex]];
<a name="l01934"></a>01934 
<a name="l01935"></a>01935     [<span class="keyword">self</span> selectRowIndexes:rowIndexes byExtendingSelection:extend];
<a name="l01936"></a>01936 }
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 - (void)_mouseDownOnSlice:(<span class="keywordtype">id</span>)slice withEvent:(<a class="code" href="interface_c_p_event.html">CPEvent</a>)event
<a name="l01939"></a>01939 {
<a name="l01940"></a>01940 }
<a name="l01941"></a>01941 
<a name="l01942"></a>01942 - (void)_rightMouseDownOnSlice:(_CPRuleEditorViewSlice)slice withEvent:(<a class="code" href="interface_c_p_event.html">CPEvent</a>)event
<a name="l01943"></a>01943 {
<a name="l01944"></a>01944 }
<a name="l01945"></a>01945 
<a name="l01946"></a>01946 - (void)_performClickOnSlice:(<span class="keywordtype">id</span>)slice withEvent:(<a class="code" href="interface_c_p_event.html">CPEvent</a>)event
<a name="l01947"></a>01947 {
<a name="l01948"></a>01948 }
<a name="l01949"></a>01949 
<a name="l01950"></a>01950 - (void)_setSuppressKeyDownHandling:(BOOL)flag
<a name="l01951"></a>01951 {
<a name="l01952"></a>01952     _suppressKeyDownHandling = flag;
<a name="l01953"></a>01953 }
<a name="l01954"></a>01954 
<a name="l01955"></a>01955 - (void)selectAll:(<span class="keywordtype">id</span>)sender
<a name="l01956"></a>01956 {
<a name="l01957"></a>01957     var count = [_slices count];
<a name="l01958"></a>01958 
<a name="l01959"></a>01959     <span class="keywordflow">while</span> (count--)
<a name="l01960"></a>01960     {
<a name="l01961"></a>01961         var slice = _slices[count];
<a name="l01962"></a>01962         [slice _setSelected:YES];
<a name="l01963"></a>01963         [slice setNeedsDisplay:YES];
<a name="l01964"></a>01964     }
<a name="l01965"></a>01965 }
<a name="l01966"></a>01966 
<a name="l01967"></a>01967 - (void)_deselectAll
<a name="l01968"></a>01968 {
<a name="l01969"></a>01969     var count = [_slices count];
<a name="l01970"></a>01970 
<a name="l01971"></a>01971     <span class="keywordflow">while</span> (count--)
<a name="l01972"></a>01972     {
<a name="l01973"></a>01973         var slice = _slices[count];
<a name="l01974"></a>01974         [slice _setSelected:NO];
<a name="l01975"></a>01975         [slice _setLastSelected:NO];
<a name="l01976"></a>01976         [slice setNeedsDisplay:YES];
<a name="l01977"></a>01977     }
<a name="l01978"></a>01978 }
<a name="l01979"></a>01979 
<a name="l01980"></a>01980 - (int)_queryNumberOfChildrenOfItem:(<span class="keywordtype">id</span>)item withRowType:(CPRuleEditorRowType)type
<a name="l01981"></a>01981 {
<a name="l01982"></a>01982     <span class="keywordflow">return</span> [_ruleDelegate ruleEditor:self numberOfChildrenForCriterion:item withRowType:type];
<a name="l01983"></a>01983 }
<a name="l01984"></a>01984 
<a name="l01985"></a>01985 - (id)_queryChild:(<span class="keywordtype">int</span>)childIndex ofItem:(<span class="keywordtype">id</span>)item withRowType:(CPRuleEditorRowType)type
<a name="l01986"></a>01986 {
<a name="l01987"></a>01987     <span class="keywordflow">return</span> [_ruleDelegate ruleEditor:self child:childIndex forCriterion:item withRowType:type];
<a name="l01988"></a>01988 }
<a name="l01989"></a>01989 
<a name="l01990"></a>01990 - (id)_queryValueForItem:(<span class="keywordtype">id</span>)item inRow:(<span class="keywordtype">int</span>)row
<a name="l01991"></a>01991 {
<a name="l01992"></a>01992     <span class="keywordflow">return</span> [_ruleDelegate ruleEditor:self displayValueForCriterion:item inRow:row];
<a name="l01993"></a>01993 }
<a name="l01994"></a>01994 
<a name="l01995"></a>01995 - (int)_lastRow
<a name="l01996"></a>01996 {
<a name="l01997"></a>01997     <span class="keywordflow">return</span> _lastRow;
<a name="l01998"></a>01998 }
<a name="l01999"></a>01999 
<a name="l02000"></a>02000 - (int)_countOfRowsStartingAtObject:(<span class="keywordtype">id</span>)object
<a name="l02001"></a>02001 {
<a name="l02002"></a>02002     var index = [<span class="keyword">self</span> _rowIndexForRowObject:object];
<a name="l02003"></a>02003     <span class="keywordflow">return</span> ([<span class="keyword">self</span> numberOfRows] - index);
<a name="l02004"></a>02004 }
<a name="l02005"></a>02005 
<a name="l02006"></a>02006 - (void)_setAlignmentGridWidth:(<span class="keywordtype">float</span>)width
<a name="l02007"></a>02007 {
<a name="l02008"></a>02008     _alignmentGridWidth = <a class="code" href="_c_g_geometry_8j.html#a52b64513cb182b63f0e848f53bddad9b">width</a>;
<a name="l02009"></a>02009 }
<a name="l02010"></a>02010 
<a name="l02011"></a>02011 - (BOOL)_validateItem:(<span class="keywordtype">id</span>)item value:(<span class="keywordtype">id</span>)value inRow:(<span class="keywordtype">int</span>)row
<a name="l02012"></a>02012 {
<a name="l02013"></a>02013     <span class="keywordflow">return</span> [<span class="keyword">self</span> _queryCanSelectItem:item displayValue:value inRow:row];
<a name="l02014"></a>02014 }
<a name="l02015"></a>02015 
<a name="l02016"></a>02016 - (BOOL)_queryCanSelectItem:(<span class="keywordtype">id</span>)item displayValue:(<span class="keywordtype">id</span>)value inRow:(<span class="keywordtype">int</span>)row
<a name="l02017"></a>02017 {
<a name="l02018"></a>02018     <span class="keywordflow">return</span> YES;
<a name="l02019"></a>02019 }
<a name="l02020"></a>02020 
<a name="l02021"></a>02021 - (void)_windowChangedKeyState
<a name="l02022"></a>02022 {
<a name="l02023"></a>02023     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l02024"></a>02024 }
<a name="l02025"></a>02025 
<a name="l02026"></a>02026 - (void)setNeedsDisplay:(BOOL)flag
<a name="l02027"></a>02027 {
<a name="l02028"></a>02028     [_slices makeObjectsPerformSelector:@selector(setNeedsDisplay:) withObject:flag];
<a name="l02029"></a>02029     [<span class="keyword">super</span> setNeedsDisplay:flag];
<a name="l02030"></a>02030 }
<a name="l02031"></a>02031 
<a name="l02032"></a>02032 - (void)setFrameSize:(CPSize)size
<a name="l02033"></a>02033 {
<a name="l02034"></a>02034     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l02035"></a>02035 
<a name="l02036"></a>02036     <span class="keywordflow">if</span> (CGRectGetWidth([<span class="keyword">self</span> <a class="code" href="_c_p_segmented_control_8j.html#a63fcc9e0dd97e8502cce685e88234e16">frame</a>]) != size.width)
<a name="l02037"></a>02037         [_slices makeObjectsPerformSelector:<span class="keyword">@selector</span>(setNeedsLayout)];
<a name="l02038"></a>02038 
<a name="l02039"></a>02039     [super setFrameSize:size];
<a name="l02040"></a>02040 }
<a name="l02041"></a>02041 
<a name="l02042"></a>02042 - (<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)_selectedSliceIndices
<a name="l02043"></a>02043 {
<a name="l02044"></a>02044     var selectedIndices = [<a class="code" href="class_c_p_mutable_index_set.html">CPMutableIndexSet</a> <a class="code" href="class_c_p_index_set.html#a339845eb2d96fae878209105dde5e140">indexSet</a>],
<a name="l02045"></a>02045         count = [_slices count],
<a name="l02046"></a>02046         i;
<a name="l02047"></a>02047 
<a name="l02048"></a>02048     <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l02049"></a>02049     {
<a name="l02050"></a>02050         var slice = _slices[i];
<a name="l02051"></a>02051         <span class="keywordflow">if</span> ([slice _isSelected])
<a name="l02052"></a>02052             [selectedIndices addIndex:[slice rowIndex]];
<a name="l02053"></a>02053     }
<a name="l02054"></a>02054 
<a name="l02055"></a>02055     <span class="keywordflow">return</span> selectedIndices;
<a name="l02056"></a>02056 }
<a name="l02057"></a>02057 
<a name="l02058"></a>02058 - (void)mouseDragged:(<a class="code" href="interface_c_p_event.html">CPEvent</a>)event
<a name="l02059"></a>02059 {
<a name="l02060"></a>02060     <span class="keywordflow">if</span> (!_editable)
<a name="l02061"></a>02061         <span class="keywordflow">return</span>;
<a name="l02062"></a>02062 
<a name="l02063"></a>02063     var point = [<span class="keyword">self</span> convertPoint:[event <a class="code" href="interface_c_p_event.html#a5a57f4fa909de5d83e5402a8d8af4b94">locationInWindow</a>] fromView:nil],
<a name="l02064"></a>02064         view = [_slices objectAtIndex:FLOOR(point.y / _sliceHeight)];
<a name="l02065"></a>02065 
<a name="l02066"></a>02066     <span class="keywordflow">if</span> ([<span class="keyword">self</span> _dragShouldBeginFromMouseDown:view])
<a name="l02067"></a>02067         [<span class="keyword">self</span> _performDragForSlice:view withEvent:event];
<a name="l02068"></a>02068 }
<a name="l02069"></a>02069 
<a name="l02070"></a>02070 - (BOOL)_dragShouldBeginFromMouseDown:(<a class="code" href="interface_c_p_view.html">CPView</a>)view
<a name="l02071"></a>02071 {
<a name="l02072"></a>02072     <span class="keywordflow">return</span> (([<span class="keyword">self</span> nestingMode] == <a class="code" href="_c_p_rule_editor_8j.html#abc68a04af6ac9e1280f2087c8e9d3e2f">CPRuleEditorNestingModeList</a> ||  [view rowIndex] != 0) &amp;&amp; _editable &amp;&amp; [view isKindOfClass:[_CPRuleEditorViewSliceRow <span class="keyword">class</span>]] &amp;&amp; _draggingRows == nil);
<a name="l02073"></a>02073 }
<a name="l02074"></a>02074 
<a name="l02075"></a>02075 - (BOOL)_performDragForSlice:(<span class="keywordtype">id</span>)slice withEvent:(<a class="code" href="interface_c_p_event.html">CPEvent</a>)event
<a name="l02076"></a>02076 {
<a name="l02077"></a>02077     var dragPoint,
<a name="l02078"></a>02078         mainRowIndex = [slice rowIndex],
<a name="l02079"></a>02079         draggingRows = [<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> <a class="code" href="class_c_p_index_set.html#a4aa683fde78ba593d0e70040125ed306">indexSetWithIndex</a>:mainRowIndex],
<a name="l02080"></a>02080         selected_indices = [<span class="keyword">self</span> _selectedSliceIndices],
<a name="l02081"></a>02081         pasteboard = [<a class="code" href="interface_c_p_pasteboard.html">CPPasteboard</a> <a class="code" href="interface_c_p_pasteboard.html#adc671279bc4d0608ebe421e4657ecd07">pasteboardWithName</a>: CPDragPboard];
<a name="l02082"></a>02082 
<a name="l02083"></a>02083     [pasteboard declareTypes:[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#ad27bec32a9288edb5e9c6e83d2e5e8ad">arrayWithObjects</a>: CPRuleEditorItemPBoardType, nil] <a class="code" href="interface_c_p_pasteboard.html#a64b3f3c2088412a6577c1905bb758f8e">owner</a>: self];
<a name="l02084"></a>02084 
<a name="l02085"></a>02085     <span class="keywordflow">if</span> ([selected_indices containsIndex:mainRowIndex])
<a name="l02086"></a>02086         [draggingRows addIndexes:selected_indices];
<a name="l02087"></a>02087     _draggingRows = [<span class="keyword">self</span> _includeSubslicesForSlicesAtIndexes:draggingRows];
<a name="l02088"></a>02088 
<a name="l02089"></a>02089     var firstIndex = [_draggingRows firstIndex],
<a name="l02090"></a>02090         firstSlice = [_slices objectAtIndex:firstIndex],
<a name="l02091"></a>02091         dragview = [[<a class="code" href="interface_c_p_view.html">CPView</a> alloc] initWithFrame:[firstSlice frame]];
<a name="l02092"></a>02092 
<a name="l02093"></a>02093 <span class="preprocessor">#if PLATFORM(DOM)</span>
<a name="l02094"></a>02094 <span class="preprocessor"></span>    var html = firstSlice._DOMElement.innerHTML;
<a name="l02095"></a>02095     dragview._DOMElement.innerHTML = [html copy];
<a name="l02096"></a>02096 <span class="preprocessor">#endif</span>
<a name="l02097"></a>02097 <span class="preprocessor"></span>    [dragview setBackgroundColor:[firstSlice backgroundColor]];
<a name="l02098"></a>02098     [dragview setAlphaValue:0.7];
<a name="l02099"></a>02099 
<a name="l02100"></a>02100     dragPoint = <a class="code" href="_c_p_geometry_8j.html#a82fe35f82ea8fd730539351fba488d21">CPMakePoint</a>(0, firstIndex * _sliceHeight);
<a name="l02101"></a>02101 
<a name="l02102"></a>02102     [<span class="keyword">self</span> dragView:dragview
<a name="l02103"></a>02103                 at:dragPoint
<a name="l02104"></a>02104             offset:CGSizeMake(0, _sliceHeight)
<a name="l02105"></a>02105              event:event
<a name="l02106"></a>02106         pasteboard:pasteboard
<a name="l02107"></a>02107             source:self
<a name="l02108"></a>02108          slideBack:YES];
<a name="l02109"></a>02109 
<a name="l02110"></a>02110     <span class="keywordflow">return</span> YES;
<a name="l02111"></a>02111 }
<a name="l02112"></a>02112 
<a name="l02113"></a>02113 - (CPDragOperation)draggingEntered:(<span class="keywordtype">id</span> &lt; <a class="code" href="interface_c_p_dragging_info.html">CPDraggingInfo</a> &gt;)sender
<a name="l02114"></a>02114 {
<a name="l02115"></a>02115     <span class="keywordflow">if</span> ([sender draggingSource] == <span class="keyword">self</span>)
<a name="l02116"></a>02116     {
<a name="l02117"></a>02117         [<span class="keyword">self</span> _clearDropLine];
<a name="l02118"></a>02118         <span class="keywordflow">return</span> <a class="code" href="_c_p_drag_server_8j.html#aea93033cd818a14176498cf7923ba8e5">CPDragOperationMove</a>;
<a name="l02119"></a>02119     }
<a name="l02120"></a>02120 
<a name="l02121"></a>02121     <span class="keywordflow">return</span> <a class="code" href="_c_p_drag_server_8j.html#a10ed549b8e0424ca530089a1cf12bbd3">CPDragOperationNone</a>;
<a name="l02122"></a>02122 }
<a name="l02123"></a>02123 
<a name="l02124"></a>02124 - (void)draggingExited:(<span class="keywordtype">id</span>)sender
<a name="l02125"></a>02125 {
<a name="l02126"></a>02126     [<span class="keyword">self</span> _clearDropLine];
<a name="l02127"></a>02127     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l02128"></a>02128 }
<a name="l02129"></a>02129 
<a name="l02130"></a>02130 - (void)_clearDropLine
<a name="l02131"></a>02131 {
<a name="l02132"></a>02132     [_dropLineView setAlphaValue:0];
<a name="l02133"></a>02133 
<a name="l02134"></a>02134     <span class="keywordflow">if</span> (_subviewIndexOfDropLine != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a> &amp;&amp; _subviewIndexOfDropLine &lt; _lastRow)
<a name="l02135"></a>02135     {
<a name="l02136"></a>02136         var previousBelowSlice = [_slices objectAtIndex:_subviewIndexOfDropLine];
<a name="l02137"></a>02137         [previousBelowSlice setFrameOrigin:CGPointMake(0, [previousBelowSlice rowIndex] * _sliceHeight)];
<a name="l02138"></a>02138     }
<a name="l02139"></a>02139 
<a name="l02140"></a>02140     _subviewIndexOfDropLine = <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>;
<a name="l02141"></a>02141 }
<a name="l02142"></a>02142 
<a name="l02143"></a>02143 - (CPDragOperation)draggingUpdated:(<span class="keywordtype">id</span> &lt;<a class="code" href="interface_c_p_dragging_info.html">CPDraggingInfo</a>&gt;)sender
<a name="l02144"></a>02144 {
<a name="l02145"></a>02145     var point = [<span class="keyword">self</span> convertPoint:[sender <a class="code" href="interface_c_p_dragging_info.html#a5da0cd1a14e14d4c349fd93e90d8a8d6">draggingLocation</a>] fromView:nil],
<a name="l02146"></a>02146         <a class="code" href="_c_g_geometry_8j.html#afd280cbcc7083735f3a54b092e8cacd8">y</a> = point.y + _sliceHeight /2,
<a name="l02147"></a>02147         indexOfDropLine =  FLOOR(<a class="code" href="_c_g_geometry_8j.html#afd280cbcc7083735f3a54b092e8cacd8">y</a> / _sliceHeight),
<a name="l02148"></a>02148         numberOfRows = [self numberOfRows];
<a name="l02149"></a>02149 
<a name="l02150"></a>02150     <span class="keywordflow">if</span> (indexOfDropLine &lt; 0 || indexOfDropLine &gt; numberOfRows || (indexOfDropLine &gt;= [_draggingRows firstIndex] &amp;&amp; indexOfDropLine &lt;= [_draggingRows lastIndex] + 1))
<a name="l02151"></a>02151     {
<a name="l02152"></a>02152         <span class="keywordflow">if</span> (_subviewIndexOfDropLine != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a> &amp;&amp; indexOfDropLine != _subviewIndexOfDropLine)
<a name="l02153"></a>02153             [<span class="keyword">self</span> _clearDropLine];
<a name="l02154"></a>02154         <span class="keywordflow">return</span> <a class="code" href="_c_p_drag_server_8j.html#a10ed549b8e0424ca530089a1cf12bbd3">CPDragOperationNone</a>;
<a name="l02155"></a>02155     }
<a name="l02156"></a>02156 
<a name="l02157"></a>02157     <span class="keywordflow">if</span> (_subviewIndexOfDropLine != indexOfDropLine)
<a name="l02158"></a>02158     {
<a name="l02159"></a>02159         <span class="keywordflow">if</span> (_subviewIndexOfDropLine != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a> &amp;&amp; _subviewIndexOfDropLine &lt; numberOfRows)
<a name="l02160"></a>02160         {
<a name="l02161"></a>02161             var previousBelowSlice = [_slices objectAtIndex:_subviewIndexOfDropLine];
<a name="l02162"></a>02162             [previousBelowSlice setFrameOrigin:CPMakePoint(0, [previousBelowSlice rowIndex] * _sliceHeight)];
<a name="l02163"></a>02163         }
<a name="l02164"></a>02164 
<a name="l02165"></a>02165         <span class="keywordflow">if</span> (indexOfDropLine &lt;= _lastRow &amp;&amp; indexOfDropLine &lt; numberOfRows)
<a name="l02166"></a>02166         {
<a name="l02167"></a>02167             var belowSlice = [_slices objectAtIndex:indexOfDropLine];
<a name="l02168"></a>02168             [belowSlice setFrameOrigin:CGPointMake(0, [belowSlice rowIndex] * _sliceHeight + 2)];
<a name="l02169"></a>02169         }
<a name="l02170"></a>02170 
<a name="l02171"></a>02171         [_dropLineView setAlphaValue:1];
<a name="l02172"></a>02172         [_dropLineView setFrameOrigin:CGPointMake(CGRectGetMinX([_dropLineView frame]), indexOfDropLine * _sliceHeight)];
<a name="l02173"></a>02173 
<a name="l02174"></a>02174         _subviewIndexOfDropLine = indexOfDropLine;
<a name="l02175"></a>02175     }
<a name="l02176"></a>02176 
<a name="l02177"></a>02177     <span class="keywordflow">return</span> <a class="code" href="_c_p_drag_server_8j.html#aea93033cd818a14176498cf7923ba8e5">CPDragOperationMove</a>;
<a name="l02178"></a>02178 }
<a name="l02179"></a>02179 
<a name="l02180"></a>02180 - (BOOL)prepareForDragOperation:(<span class="keywordtype">id</span> &lt; <a class="code" href="interface_c_p_dragging_info.html">CPDraggingInfo</a> &gt;)sender
<a name="l02181"></a>02181 {
<a name="l02182"></a>02182     <span class="keywordflow">return</span> (_subviewIndexOfDropLine != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>);
<a name="l02183"></a>02183 }
<a name="l02184"></a>02184 
<a name="l02185"></a>02185 - (BOOL)performDragOperation:(<span class="keywordtype">id</span> &lt; <a class="code" href="interface_c_p_dragging_info.html">CPDraggingInfo</a> &gt;)info
<a name="l02186"></a>02186 {
<a name="l02187"></a>02187     var aboveInsertIndexCount = 0,
<a name="l02188"></a>02188         object,
<a name="l02189"></a>02189         removeIndex;
<a name="l02190"></a>02190 
<a name="l02191"></a>02191     var rowObjects = [_rowCache valueForKey:@&quot;rowObject&quot;],
<a name="l02192"></a>02192         index = [_draggingRows lastIndex];
<a name="l02193"></a>02193 
<a name="l02194"></a>02194     var parentRowIndex = [<span class="keyword">self</span> parentRowForRow:index]; <span class="comment">// first index of draggingrows</span>
<a name="l02195"></a>02195     var parentRowObject = (parentRowIndex == -1) ? _boundArrayOwner : [[self _rowCacheForIndex:parentRowIndex] rowObject];
<a name="l02196"></a>02196     var insertIndex = _subviewIndexOfDropLine;
<a name="l02197"></a>02197 
<a name="l02198"></a>02198     <span class="keywordflow">while</span> (index != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l02199"></a>02199     {
<a name="l02200"></a>02200         <span class="keywordflow">if</span> (index &gt;= insertIndex)
<a name="l02201"></a>02201         {
<a name="l02202"></a>02202             removeIndex = index + aboveInsertIndexCount;
<a name="l02203"></a>02203             aboveInsertIndexCount += 1;
<a name="l02204"></a>02204         }
<a name="l02205"></a>02205         <span class="keywordflow">else</span>
<a name="l02206"></a>02206         {
<a name="l02207"></a>02207             removeIndex = index;
<a name="l02208"></a>02208             insertIndex -= 1;
<a name="l02209"></a>02209         }
<a name="l02210"></a>02210 
<a name="l02211"></a>02211         <span class="keywordtype">object</span> = [rowObjects objectAtIndex:removeIndex];
<a name="l02212"></a>02212         [<span class="keyword">self</span> removeRowAtIndex:removeIndex];
<a name="l02213"></a>02213         [[<span class="keyword">self</span> _subrowObjectsOfObject:parentRowObject] insertObject:object atIndex:insertIndex - parentRowIndex - 1];
<a name="l02214"></a>02214 
<a name="l02215"></a>02215         index = [_draggingRows indexLessThanIndex:index];
<a name="l02216"></a>02216     }
<a name="l02217"></a>02217 
<a name="l02218"></a>02218     [<span class="keyword">self</span> _clearDropLine];
<a name="l02219"></a>02219     _draggingRows = nil;
<a name="l02220"></a>02220     <span class="keywordflow">return</span> YES;
<a name="l02221"></a>02221 }
<a name="l02222"></a>02222 
<a name="l02223"></a>02223 - (<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)_draggingTypes
<a name="l02224"></a>02224 {
<a name="l02225"></a>02225     <span class="keywordflow">return</span> [<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> <a class="code" href="class_c_p_index_set.html#a4aa683fde78ba593d0e70040125ed306">indexSetWithIndex</a>:CPDragOperationMove];
<a name="l02226"></a>02226 }
<a name="l02227"></a>02227 
<a name="l02228"></a>02228 - (void)draggedView:(<a class="code" href="interface_c_p_view.html">CPView</a>)dragView endedAt:(CPPoint)aPoint operation:(CPDragOperation)operation
<a name="l02229"></a>02229 {
<a name="l02230"></a>02230     _draggingRows = nil;
<a name="l02231"></a>02231 }
<a name="l02232"></a>02232 
<a name="l02233"></a>02233 - (BOOL)wantsPeriodicDraggingUpdates
<a name="l02234"></a>02234 {
<a name="l02235"></a>02235     <span class="keywordflow">return</span> NO;
<a name="l02236"></a>02236 }
<a name="l02237"></a>02237 
<a name="l02238"></a>02238 - (void)pasteboard:(<a class="code" href="interface_c_p_pasteboard.html">CPPasteboard</a>)pasteboard provideDataForType:(<span class="keywordtype">int</span>)type
<a name="l02239"></a>02239 {
<a name="l02240"></a>02240 }
<a name="l02241"></a>02241 
<a name="l02242"></a>02242 - (void)_setWindow:(<span class="keywordtype">id</span>)window
<a name="l02243"></a>02243 {
<a name="l02244"></a>02244     [<span class="keyword">super</span> _setWindow:window];
<a name="l02245"></a>02245 }
<a name="l02246"></a>02246 
<a name="l02247"></a>02247 - (void)_windowUpdate:(<span class="keywordtype">id</span>)sender
<a name="l02248"></a>02248 {
<a name="l02249"></a>02249     [<span class="keyword">super</span> _windowUpdate:sender];
<a name="l02250"></a>02250 }
<a name="l02251"></a>02251 
<a name="l02252"></a>02252 - (void)_postRuleOptionChangedNotification
<a name="l02253"></a>02253 {
<a name="l02254"></a>02254     [<span class="keyword">self</span> reloadPredicate];
<a name="l02255"></a>02255     [<span class="keyword">self</span> _sendRuleAction];
<a name="l02256"></a>02256     [[<a class="code" href="interface_c_p_notification_center.html" title="Sends messages (CPNotification) between objects.">CPNotificationCenter</a> <a class="code" href="interface_c_p_notification_center.html#a5abe725f1a1a48ac4cb1e45b6d9d50a8">defaultCenter</a>] <a class="code" href="interface_c_p_notification_center.html#ac9402b295db607cbd92ae56bce50b37f">postNotificationName</a>:CPRuleEditorRulesDidChangeNotification <a class="code" href="interface_c_p_notification_center.html#ac9402b295db607cbd92ae56bce50b37f">object</a>:self];
<a name="l02257"></a>02257 }
<a name="l02258"></a>02258 
<a name="l02259"></a>02259 - (void)_postRowCountChangedNotificationOfType:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)notificationName indexes:indexes
<a name="l02260"></a>02260 {
<a name="l02261"></a>02261     [<span class="keyword">self</span> reloadPredicate];
<a name="l02262"></a>02262     [<span class="keyword">self</span> _sendRuleAction];
<a name="l02263"></a>02263     [[<a class="code" href="interface_c_p_notification_center.html" title="Sends messages (CPNotification) between objects.">CPNotificationCenter</a> <a class="code" href="interface_c_p_notification_center.html#a5abe725f1a1a48ac4cb1e45b6d9d50a8">defaultCenter</a>] <a class="code" href="interface_c_p_notification_center.html#ac5e7dc8d0972292f52736f6f662bb25a">postNotificationName</a>:notificationName <a class="code" href="interface_c_p_notification_center.html#ac5e7dc8d0972292f52736f6f662bb25a">object</a>:self <a class="code" href="interface_c_p_notification_center.html#ac5e7dc8d0972292f52736f6f662bb25a">userInfo</a>:[<a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a> <a class="code" href="interface_c_p_dictionary.html#ae3b91d744723e22ea217f968380c3173">dictionaryWithObject</a>:indexes <a class="code" href="interface_c_p_dictionary.html#ae3b91d744723e22ea217f968380c3173">forKey</a>:&quot;indexes&quot;]];
<a name="l02264"></a>02264 }
<a name="l02265"></a>02265 
<a name="l02266"></a>02266 - (<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)_globalIndexesForSubrowIndexes:(<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a>)indexes ofParentObject:(<span class="keywordtype">id</span>)parentRowObject
<a name="l02267"></a>02267 {
<a name="l02268"></a>02268     var _subrows = [<span class="keyword">self</span> _subrowObjectsOfObject:parentRowObject],
<a name="l02269"></a>02269         parentRowIndex = [<span class="keyword">self</span> _rowIndexForRowObject:parentRowObject],
<a name="l02270"></a>02270 
<a name="l02271"></a>02271         globalIndexes = [<a class="code" href="class_c_p_mutable_index_set.html">CPMutableIndexSet</a> <a class="code" href="class_c_p_index_set.html#a339845eb2d96fae878209105dde5e140">indexSet</a>],
<a name="l02272"></a>02272         current_index = [indexes <a class="code" href="class_c_p_index_set.html#abc895f4b5df7bdaf090161db6b234b73">firstIndex</a>],
<a name="l02273"></a>02273         numberOfChildrenOfPreviousBrother = 0;
<a name="l02274"></a>02274 
<a name="l02275"></a>02275     <span class="keywordflow">while</span> (current_index != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>)
<a name="l02276"></a>02276     {
<a name="l02277"></a>02277         var globalChildIndex = current_index + parentRowIndex + 1 + numberOfChildrenOfPreviousBrother;
<a name="l02278"></a>02278         [globalIndexes addIndex:globalChildIndex];
<a name="l02279"></a>02279 
<a name="l02280"></a>02280         <span class="keywordflow">if</span> ([<span class="keyword">self</span> rowTypeForRow:globalChildIndex] == <a class="code" href="_c_p_rule_editor_8j.html#afd1c6ac76a4b959512fab136eab67b7e">CPRuleEditorRowTypeCompound</a>)
<a name="l02281"></a>02281         {
<a name="l02282"></a>02282             var rowObject = [[<span class="keyword">self</span> _rowCacheForIndex:current_index] rowObject],
<a name="l02283"></a>02283                 subrows = [<span class="keyword">self</span> _subrowObjectsOfObject:rowObject];
<a name="l02284"></a>02284 
<a name="l02285"></a>02285             var subIndexes = [<span class="keyword">self</span> _globalIndexesForSubrowIndexes:[<a class="code" href="class_c_p_index_set.html" title="A collection of unique integers.">CPIndexSet</a> <a class="code" href="class_c_p_index_set.html#a4c32a454bd5323253b9e8c4f81712ea5">indexSetWithIndexesInRange</a>:CPMakeRange(0,[subrows count])] ofParentObject:rowObject];
<a name="l02286"></a>02286             numberOfChildrenOfPreviousBrother = [subIndexes count];
<a name="l02287"></a>02287         }
<a name="l02288"></a>02288 
<a name="l02289"></a>02289         current_index = [indexes <a class="code" href="class_c_p_index_set.html#a3f66583eea02c42c2b14e53daf697559">indexGreaterThanIndex</a>:current_index];
<a name="l02290"></a>02290     }
<a name="l02291"></a>02291 
<a name="l02292"></a>02292     <span class="keywordflow">return</span> globalIndexes;
<a name="l02293"></a>02293 }
<a name="l02294"></a>02294 
<a name="l02295"></a>02295 - (void)_sendRuleAction
<a name="l02296"></a>02296 {
<a name="l02297"></a>02297     var action = [<span class="keyword">self</span> action],
<a name="l02298"></a>02298         target = [<span class="keyword">self</span> target];
<a name="l02299"></a>02299 
<a name="l02300"></a>02300     <span class="keywordflow">if</span> (action &amp;&amp; target)
<a name="l02301"></a>02301         [<span class="keyword">self</span> sendAction:[<span class="keyword">self</span> action] to:[<span class="keyword">self</span> target]];
<a name="l02302"></a>02302 }
<a name="l02303"></a>02303 
<a name="l02304"></a>02304 - (BOOL)_sendsActionOnIncompleteTextChange
<a name="l02305"></a>02305 {
<a name="l02306"></a>02306     <span class="keywordflow">return</span> YES;
<a name="l02307"></a>02307 }
<a name="l02308"></a>02308 
<a name="l02309"></a>02309 - (void)_getAllAvailableItems:(<span class="keywordtype">id</span>)items values:(<span class="keywordtype">id</span>)values asChildrenOfItem:(<span class="keywordtype">id</span>)parentItem inRow:(<span class="keywordtype">int</span>)aRow
<a name="l02310"></a>02310 {
<a name="l02311"></a>02311     var type,
<a name="l02312"></a>02312         indexofCriterion,
<a name="l02313"></a>02313         numOfChildren;
<a name="l02314"></a>02314 
<a name="l02315"></a>02315     var availItems = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>],
<a name="l02316"></a>02316         availValues = [<a class="code" href="interface_c_p_mutable_array.html">CPMutableArray</a> <a class="code" href="interface_c_p_array.html#aafeaf98dd280821940da2ec8be05b776">array</a>];
<a name="l02317"></a>02317 
<a name="l02318"></a>02318     var criterion = nil,
<a name="l02319"></a>02319         value = nil;
<a name="l02320"></a>02320 
<a name="l02321"></a>02321     _lastRow = aRow;
<a name="l02322"></a>02322     type = [<span class="keyword">self</span> rowTypeForRow:aRow];
<a name="l02323"></a>02323     numOfChildren = [<span class="keyword">self</span> _queryNumberOfChildrenOfItem:parentItem withRowType:type];
<a name="l02324"></a>02324 
<a name="l02325"></a>02325     var criteria = [<span class="keyword">self</span> criteriaForRow:aRow];
<a name="l02326"></a>02326     indexofCriterion = [criteria indexOfObject:criterion];
<a name="l02327"></a>02327 
<a name="l02328"></a>02328     <span class="keywordflow">if</span> (parentItem != nil
<a name="l02329"></a>02329         &amp;&amp; indexofCriterion != <a class="code" href="_c_p_obj_j_runtime_8j.html#a84e3be579b365cc2c1559e1a1f469238">CPNotFound</a>
<a name="l02330"></a>02330         &amp;&amp; indexofCriterion &lt; [criteria count] - 1)
<a name="l02331"></a>02331     {
<a name="l02332"></a>02332         var next = indexofCriterion + 1;
<a name="l02333"></a>02333 
<a name="l02334"></a>02334         criterion = [criteria objectAtIndex:next];
<a name="l02335"></a>02335         var values = [<span class="keyword">self</span> displayValuesForRow:aRow];
<a name="l02336"></a>02336         value = [values objectAtIndex:next];
<a name="l02337"></a>02337     }
<a name="l02338"></a>02338 
<a name="l02339"></a>02339     <span class="keywordflow">for</span> (var i = 0; i &lt; numOfChildren; ++i)
<a name="l02340"></a>02340     {
<a name="l02341"></a>02341         var aChild = [<span class="keyword">self</span> _queryChild:i ofItem:parentItem withRowType:type];
<a name="l02342"></a>02342         var availChild = aChild,
<a name="l02343"></a>02343             availValue = value;
<a name="l02344"></a>02344 
<a name="l02345"></a>02345         <span class="keywordflow">if</span> ( criterion != aChild )
<a name="l02346"></a>02346             availValue = [<span class="keyword">self</span> _queryValueForItem:aChild inRow:aRow];
<a name="l02347"></a>02347 
<a name="l02348"></a>02348         <span class="keywordflow">if</span> ( !availValue )
<a name="l02349"></a>02349             availValue = [<span class="keyword">self</span> _queryValueForItem:availChild inRow:aRow];
<a name="l02350"></a>02350 
<a name="l02351"></a>02351         [availItems addObject:availChild];
<a name="l02352"></a>02352         [availValues addObject:availValue];
<a name="l02353"></a>02353     }
<a name="l02354"></a>02354 
<a name="l02355"></a>02355     [items addObjectsFromArray:availItems];
<a name="l02356"></a>02356     [values addObjectsFromArray:availValues];
<a name="l02357"></a>02357 }
<a name="l02358"></a>02358 
<a name="l02359"></a>02359 <span class="keyword">@end</span>
<a name="l02360"></a>02360 
<a name="l02361"></a>02361 var CPRuleEditorAlignmentGridWidthKey       = <span class="stringliteral">@&quot;CPRuleEditorAlignmentGridWidth&quot;</span>,
<a name="l02362"></a>02362     CPRuleEditorSliceHeightKey              = <span class="stringliteral">@&quot;CPRuleEditorSliceHeight&quot;</span>,
<a name="l02363"></a>02363     CPRuleEditorStringsFilenameKey          = <span class="stringliteral">@&quot;CPRuleEditorStringsFilename&quot;</span>,
<a name="l02364"></a>02364     CPRuleEditorEditableKey                 = <span class="stringliteral">@&quot;CPRuleEditorEditable&quot;</span>,
<a name="l02365"></a>02365     CPRuleEditorAllowsEmptyCompoundRowsKey  = <span class="stringliteral">@&quot;CPRuleEditorAllowsEmptyCompoundRows&quot;</span>,
<a name="l02366"></a>02366     CPRuleEditorDisallowEmptyKey            = <span class="stringliteral">@&quot;CPRuleEditorDisallowEmpty&quot;</span>,
<a name="l02367"></a>02367     CPRuleEditorNestingModeKey              = <span class="stringliteral">@&quot;CPRuleEditorNestingMode&quot;</span>,
<a name="l02368"></a>02368     CPRuleEditorRowTypeKeyPathKey           = <span class="stringliteral">@&quot;CPRuleEditorRowTypeKeyPath&quot;</span>,
<a name="l02369"></a>02369     CPRuleEditorItemsKeyPathKey             = <span class="stringliteral">@&quot;CPRuleEditorItemsKeyPath&quot;</span>,
<a name="l02370"></a>02370     CPRuleEditorValuesKeyPathKey            = <span class="stringliteral">@&quot;CPRuleEditorValuesKeyPath&quot;</span>,
<a name="l02371"></a>02371     CPRuleEditorSubrowsArrayKeyPathKey      = <span class="stringliteral">@&quot;CPRuleEditorSubrowsArrayKeyPath&quot;</span>,
<a name="l02372"></a>02372     CPRuleEditorBoundArrayKeyPathKey        = <span class="stringliteral">@&quot;CPRuleEditorBoundArrayKeyPath&quot;</span>,
<a name="l02373"></a>02373     CPRuleEditorRowClassKey                 = <span class="stringliteral">@&quot;CPRuleEditorRowClass&quot;</span>,
<a name="l02374"></a>02374     CPRuleEditorSlicesHolderKey             = <span class="stringliteral">@&quot;CPRuleEditorSlicesHolder&quot;</span>,
<a name="l02375"></a>02375     CPRuleEditorSlicesKey                   = <span class="stringliteral">@&quot;CPRuleEditorSlices&quot;</span>,
<a name="l02376"></a>02376     CPRuleEditorDelegateKey                 = <span class="stringliteral">@&quot;CPRuleEditorDelegate&quot;</span>,
<a name="l02377"></a>02377     CPRuleEditorBoundArrayOwnerKey          = <span class="stringliteral">@&quot;CPRuleEditorBoundArrayOwner&quot;</span>;
<a name="l02378"></a>02378 
<a name="l02379"></a>02379 <span class="keyword">@implementation </span><a class="code" href="interface_c_p_rule_editor.html" title="A view for creating and configuring criteria.">CPRuleEditor</a> (CPCoding)
<a name="l02380"></a>02380 
<a name="l02381"></a>02381 - (id)initWithCoder:(<a class="code" href="interface_c_p_coder.html" title="Defines methods for use when archiving &amp; restoring (enc/decoding).">CPCoder</a>)coder
<a name="l02382"></a>02382 {
<a name="l02383"></a>02383     <span class="keyword">self</span> = [<span class="keyword">super</span> initWithCoder:coder];
<a name="l02384"></a>02384     <span class="keywordflow">if</span> (<span class="keyword">self</span> != nil)
<a name="l02385"></a>02385     {
<a name="l02386"></a>02386         [<span class="keyword">self</span> setFormattingStringsFilename:[coder decodeObjectForKey:CPRuleEditorStringsFilenameKey]];
<a name="l02387"></a>02387         _alignmentGridWidth     = [coder decodeFloatForKey:CPRuleEditorAlignmentGridWidthKey];
<a name="l02388"></a>02388         _sliceHeight            = [coder decodeDoubleForKey:CPRuleEditorSliceHeightKey];
<a name="l02389"></a>02389         _editable                = [coder decodeBoolForKey:CPRuleEditorEditableKey];
<a name="l02390"></a>02390         _allowsEmptyCompoundRows = [coder decodeBoolForKey:CPRuleEditorAllowsEmptyCompoundRowsKey];
<a name="l02391"></a>02391         _disallowEmpty           = [coder decodeBoolForKey:CPRuleEditorDisallowEmptyKey];
<a name="l02392"></a>02392         _nestingMode            = [coder decodeIntForKey:CPRuleEditorNestingModeKey];
<a name="l02393"></a>02393         _typeKeyPath            = [coder decodeObjectForKey:CPRuleEditorRowTypeKeyPathKey];
<a name="l02394"></a>02394         _itemsKeyPath           = [coder decodeObjectForKey:CPRuleEditorItemsKeyPathKey];
<a name="l02395"></a>02395         _valuesKeyPath          = [coder decodeObjectForKey:CPRuleEditorValuesKeyPathKey];
<a name="l02396"></a>02396         _subrowsArrayKeyPath    = [coder decodeObjectForKey:CPRuleEditorSubrowsArrayKeyPathKey];
<a name="l02397"></a>02397         _boundArrayKeyPath      = [coder decodeObjectForKey:CPRuleEditorBoundArrayKeyPathKey];
<a name="l02398"></a>02398 
<a name="l02399"></a>02399         _slicesHolder = [[<span class="keyword">self</span> subviews] objectAtIndex:0];
<a name="l02400"></a>02400         _boundArrayOwner = [coder decodeObjectForKey:CPRuleEditorBoundArrayOwnerKey];
<a name="l02401"></a>02401         _slices = [coder decodeObjectForKey:CPRuleEditorSlicesKey];
<a name="l02402"></a>02402         _ruleDelegate = [coder decodeObjectForKey:CPRuleEditorDelegateKey];
<a name="l02403"></a>02403 
<a name="l02404"></a>02404         [<span class="keyword">self</span> _initRuleEditorShared];
<a name="l02405"></a>02405     }
<a name="l02406"></a>02406 
<a name="l02407"></a>02407     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l02408"></a>02408 }
<a name="l02409"></a>02409 
<a name="l02410"></a>02410 - (void)encodeWithCoder:(<span class="keywordtype">id</span>)coder
<a name="l02411"></a>02411 {
<a name="l02412"></a>02412     [<span class="keyword">super</span> encodeWithCoder:coder];
<a name="l02413"></a>02413 
<a name="l02414"></a>02414     [coder encodeBool:_editable forKey:CPRuleEditorEditableKey];
<a name="l02415"></a>02415     [coder encodeBool:_allowsEmptyCompoundRows forKey:CPRuleEditorAllowsEmptyCompoundRowsKey];
<a name="l02416"></a>02416     [coder encodeBool:_disallowEmpty forKey:CPRuleEditorDisallowEmptyKey];
<a name="l02417"></a>02417 
<a name="l02418"></a>02418     [coder encodeFloat:_alignmentGridWidth forKey:CPRuleEditorAlignmentGridWidthKey];
<a name="l02419"></a>02419     [coder encodeDouble:_sliceHeight forKey:CPRuleEditorSliceHeightKey];
<a name="l02420"></a>02420     [coder encodeInt:_nestingMode forKey:CPRuleEditorNestingModeKey];
<a name="l02421"></a>02421 
<a name="l02422"></a>02422     [coder encodeObject:_stringsFilename forKey:CPRuleEditorStringsFilenameKey];
<a name="l02423"></a>02423     [coder encodeObject:_typeKeyPath forKey:CPRuleEditorRowTypeKeyPathKey];
<a name="l02424"></a>02424     [coder encodeObject:_itemsKeyPath forKey:CPRuleEditorItemsKeyPathKey];
<a name="l02425"></a>02425     [coder encodeObject:_valuesKeyPath forKey:CPRuleEditorValuesKeyPathKey];
<a name="l02426"></a>02426     [coder encodeObject:_boundArrayKeyPath forKey:CPRuleEditorBoundArrayKeyPathKey];
<a name="l02427"></a>02427     [coder encodeObject:_subrowsArrayKeyPath forKey:CPRuleEditorSubrowsArrayKeyPathKey];
<a name="l02428"></a>02428 
<a name="l02429"></a>02429     [coder encodeConditionalObject:_slicesHolder forKey:CPRuleEditorSlicesHolderKey];
<a name="l02430"></a>02430     [coder encodeObject:_slices forKey:CPRuleEditorSlicesKey];
<a name="l02431"></a>02431     [coder encodeObject:_boundArrayOwner forKey:CPRuleEditorBoundArrayOwnerKey];
<a name="l02432"></a>02432 }
<a name="l02433"></a>02433 
<a name="l02434"></a>02434 <span class="keyword">@end</span>
<a name="l02435"></a>02435 
<a name="l02436"></a>02436 var CriteriaKey         = <span class="stringliteral">@&quot;criteria&quot;</span>,
<a name="l02437"></a>02437     SubrowsKey          = <span class="stringliteral">@&quot;subrows&quot;</span>,
<a name="l02438"></a>02438     DisplayValuesKey    = <span class="stringliteral">@&quot;displayValues&quot;</span>,
<a name="l02439"></a>02439     RowTypeKey          = <span class="stringliteral">@&quot;rowType&quot;</span>;
<a name="l02440"></a>02440 
<a name="l02441"></a>02441 <span class="keyword">@implementation </span><a class="code" href="class_row_object.html">RowObject</a> : <a class="code" href="class_c_p_object.html" title="The root class from which most classes are subclassed.">CPObject</a>
<a name="l02442"></a>02442 {
<a name="l02443"></a>02443     <a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>     subrows;
<a name="l02444"></a>02444     <a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>     criteria;
<a name="l02445"></a>02445     <a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a>     displayValues;
<a name="l02446"></a>02446     CPInteger   rowType;
<a name="l02447"></a>02447 }
<a name="l02448"></a>02448 
<a name="l02449"></a>02449 - (id)copy
<a name="l02450"></a>02450 {
<a name="l02451"></a>02451     var copy = [[<a class="code" href="class_row_object.html">RowObject</a> alloc] init];
<a name="l02452"></a>02452     [copy setSubrows:[[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#ab166355c18097850b848916cb4dd4b8b">alloc</a>] <a class="code" href="interface_c_p_array.html#a075841583dd5c88e602cb24abb1d68a7">initWithArray</a>:subrows <a class="code" href="interface_c_p_array.html#a075841583dd5c88e602cb24abb1d68a7">copyItems</a>:YES]];
<a name="l02453"></a>02453     [copy setCriteria:[[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#ab166355c18097850b848916cb4dd4b8b">alloc</a>] <a class="code" href="interface_c_p_array.html#a075841583dd5c88e602cb24abb1d68a7">initWithArray</a>:criteria <a class="code" href="interface_c_p_array.html#a075841583dd5c88e602cb24abb1d68a7">copyItems</a>:YES]];
<a name="l02454"></a>02454     [copy setDisplayValues:[[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> <a class="code" href="interface_c_p_array.html#ab166355c18097850b848916cb4dd4b8b">alloc</a>] <a class="code" href="interface_c_p_array.html#a075841583dd5c88e602cb24abb1d68a7">initWithArray</a>:displayValues <a class="code" href="interface_c_p_array.html#a075841583dd5c88e602cb24abb1d68a7">copyItems</a>:YES]];
<a name="l02455"></a>02455     [copy setRowType:rowType];
<a name="l02456"></a>02456 
<a name="l02457"></a>02457     <span class="keywordflow">return</span> copy;
<a name="l02458"></a>02458 }
<a name="l02459"></a>02459 
<a name="l02460"></a>02460 - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)description
<a name="l02461"></a>02461 {
<a name="l02462"></a>02462     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;RowObject&gt;\nsubrows = &quot;</span> + [subrows description] + &quot;\ncriteria = &quot; + [criteria description] + &quot;\ndisplayValues = &quot; + [displayValues description];
<a name="l02463"></a>02463 }
<a name="l02464"></a>02464 
<a name="l02465"></a>02465 - (id)initWithCoder:(<span class="keywordtype">id</span>)coder
<a name="l02466"></a>02466 {
<a name="l02467"></a>02467     <span class="keyword">self</span> = [<span class="keyword">super</span> init];
<a name="l02468"></a>02468     <span class="keywordflow">if</span> (<span class="keyword">self</span> != nil)
<a name="l02469"></a>02469     {
<a name="l02470"></a>02470         subrows = [coder decodeObjectForKey:SubrowsKey];
<a name="l02471"></a>02471         criteria = [coder decodeObjectForKey:CriteriaKey];
<a name="l02472"></a>02472         displayValues = [coder decodeObjectForKey:DisplayValuesKey];
<a name="l02473"></a>02473         rowType = [coder decodeIntForKey:RowTypeKey];
<a name="l02474"></a>02474     }
<a name="l02475"></a>02475 
<a name="l02476"></a>02476     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l02477"></a>02477 }
<a name="l02478"></a>02478 
<a name="l02479"></a>02479 - (void)encodeWithCoder:(<span class="keywordtype">id</span>)coder
<a name="l02480"></a>02480 {
<a name="l02481"></a>02481     [coder encodeObject:subrows forKey:SubrowsKey];
<a name="l02482"></a>02482     [coder encodeObject:criteria forKey:CriteriaKey];
<a name="l02483"></a>02483     [coder encodeObject:displayValues forKey:DisplayValuesKey];
<a name="l02484"></a>02484     [coder encodeInt:rowType forKey:RowTypeKey];
<a name="l02485"></a>02485 }
<a name="l02486"></a>02486 
<a name="l02487"></a>02487 <span class="keyword">@end</span>
<a name="l02488"></a>02488 
<a name="l02489"></a>02489 <span class="keyword">@implementation </span>_CPRuleEditorCache : <a class="code" href="class_c_p_object.html" title="The root class from which most classes are subclassed.">CPObject</a>
<a name="l02490"></a>02490 {
<a name="l02491"></a>02491     <a class="code" href="interface_c_p_dictionary.html" title="A mutable key-value pair collection.">CPDictionary</a>    rowObject;
<a name="l02492"></a>02492     CPInteger       rowIndex;
<a name="l02493"></a>02493     CPInteger       indentation;
<a name="l02494"></a>02494 }
<a name="l02495"></a>02495 
<a name="l02496"></a>02496 - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)description
<a name="l02497"></a>02497 {
<a name="l02498"></a>02498     <span class="keywordflow">return</span> [<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a> <a class="code" href="class_c_p_string.html#a7d9e7b4329b51daf0c3b43d6183d4eec">stringWithFormat</a>:@&quot;&lt;%d object:%d rowIndex:%d indentation:%d&gt;&quot;,[<span class="keyword">self</span> hash], [rowObject hash], rowIndex, indentation];
<a name="l02499"></a>02499 }
<a name="l02500"></a>02500 
<a name="l02501"></a>02501 <span class="keyword">@end</span>
<a name="l02502"></a>02502 
<a name="l02503"></a>02503 var CPBoundArrayKey = <span class="stringliteral">@&quot;CPBoundArray&quot;</span>;
<a name="l02504"></a>02504 
<a name="l02505"></a>02505 <span class="keyword">@implementation </span>_CPRuleEditorViewUnboundRowHolder : <a class="code" href="class_c_p_object.html" title="The root class from which most classes are subclassed.">CPObject</a>
<a name="l02506"></a>02506 {
<a name="l02507"></a>02507     <a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> boundArray;
<a name="l02508"></a>02508 }
<a name="l02509"></a>02509 
<a name="l02510"></a>02510 - (id)init
<a name="l02511"></a>02511 {
<a name="l02512"></a>02512     <span class="keywordflow">if</span> (<span class="keyword">self</span> = [super init])
<a name="l02513"></a>02513         boundArray = [[<a class="code" href="interface_c_p_array.html" title="A mutable array backed by a JavaScript Array.A mutable array class backed by a JavaScript Array...">CPArray</a> alloc] init];
<a name="l02514"></a>02514 
<a name="l02515"></a>02515     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l02516"></a>02516 }
<a name="l02517"></a>02517 
<a name="l02518"></a>02518 - (id)initWithCoder:(<span class="keywordtype">id</span>)coder
<a name="l02519"></a>02519 {
<a name="l02520"></a>02520     <span class="keywordflow">if</span> (<span class="keyword">self</span> = [super init])
<a name="l02521"></a>02521         boundArray = [coder decodeObjectForKey:CPBoundArrayKey];
<a name="l02522"></a>02522 
<a name="l02523"></a>02523     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l02524"></a>02524 }
<a name="l02525"></a>02525 
<a name="l02526"></a>02526 - (void)encodeWithCoder:(<span class="keywordtype">id</span>)coder
<a name="l02527"></a>02527 {
<a name="l02528"></a>02528     [coder encodeObject:boundArray forKey:CPBoundArrayKey];
<a name="l02529"></a>02529 }
<a name="l02530"></a>02530 
<a name="l02531"></a>02531 <span class="keyword">@end</span>
<a name="l02532"></a>02532 <span class="keyword">@implementation </span>_CPRuleEditorViewSliceHolder : <a class="code" href="interface_c_p_view.html">CPView</a>
<a name="l02533"></a>02533 {
<a name="l02534"></a>02534     <span class="keywordtype">id</span> __doxygen__;
<a name="l02535"></a>02535 }
<a name="l02536"></a>02536 
<a name="l02537"></a>02537 - (void)addSubview:(<a class="code" href="interface_c_p_view.html">CPView</a>)subview
<a name="l02538"></a>02538 {
<a name="l02539"></a>02539     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l02540"></a>02540     [<span class="keyword">super</span> addSubview:subview];
<a name="l02541"></a>02541 }
<a name="l02542"></a>02542 
<a name="l02543"></a>02543 <span class="keyword">@end</span>
<a name="l02544"></a>02544 
<a name="l02545"></a>02545 var dropSeparatorColor = [<a class="code" href="interface_c_p_color.html">CPColor</a> <a class="code" href="interface_c_p_color.html#a80c4273ef2d3bb9cc836946de79c8a1e">colorWithHexString</a>:@&quot;4886ca&quot;];
<a name="l02546"></a>02546 <span class="keyword">@implementation </span>_CPRuleEditorViewSliceDropSeparator : <a class="code" href="interface_c_p_view.html">CPView</a>
<a name="l02547"></a>02547 {
<a name="l02548"></a>02548     <span class="keywordtype">id</span> __doxygen__;
<a name="l02549"></a>02549 }
<a name="l02550"></a>02550 
<a name="l02551"></a>02551 - (void)drawRect:(CPRect)rect
<a name="l02552"></a>02552 {
<a name="l02553"></a>02553     var context = [[<a class="code" href="interface_c_p_graphics_context.html">CPGraphicsContext</a> <a class="code" href="interface_c_p_graphics_context.html#a378dafc8fb951053dd6877fb45e87f61">currentContext</a>] <a class="code" href="interface_c_p_graphics_context.html#a92895bd939c04da463d02425bec83f0b">graphicsPort</a>];
<a name="l02554"></a>02554     <a class="code" href="group__coregraphics.html#ga800a3e5b0c46359d28b091376630bb0e">CGContextSetFillColor</a>(context, dropSeparatorColor);
<a name="l02555"></a>02555     <a class="code" href="group__coregraphics.html#ga74c13e165c00cc434a54bb8c2148e1ba">CGContextFillRect</a>(context, [<span class="keyword">self</span> bounds]);
<a name="l02556"></a>02556 }
<a name="l02557"></a>02557 
<a name="l02558"></a>02558 <span class="keyword">@end</span>
<a name="l02559"></a>02559 
<a name="l02560"></a>02560 <span class="keyword">@implementation </span><a class="code" href="class_c_p_object.html" title="The root class from which most classes are subclassed.">CPObject</a> (CPRuleEditorSliceRow)
<a name="l02561"></a>02561 
<a name="l02562"></a>02562 - (int)valueType
<a name="l02563"></a>02563 {
<a name="l02564"></a>02564     var result = 0;
<a name="l02565"></a>02565 
<a name="l02566"></a>02566     var isString = [<span class="keyword">self</span> isKindOfClass:[<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a> class]];
<a name="l02567"></a>02567     <span class="keywordflow">if</span> ( !isString )
<a name="l02568"></a>02568     {
<a name="l02569"></a>02569         var isView = [<span class="keyword">self</span> isKindOfClass:[<a class="code" href="interface_c_p_view.html">CPView</a> class]];
<a name="l02570"></a>02570         result = 1;
<a name="l02571"></a>02571         <span class="keywordflow">if</span> ( !isView )
<a name="l02572"></a>02572         {
<a name="l02573"></a>02573             var ismenuItem = [<span class="keyword">self</span> isKindOfClass:[<a class="code" href="interface_c_p_menu_item.html">CPMenuItem</a> class]];
<a name="l02574"></a>02574             result = 2;
<a name="l02575"></a>02575             <span class="keywordflow">if</span> ( !ismenuItem )
<a name="l02576"></a>02576             {
<a name="l02577"></a>02577                 [<a class="code" href="interface_c_p_exception.html" title="Used to implement exception handling (creating &amp; raising).">CPException</a> <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">raise</a>:CPGenericException <a class="code" href="interface_c_p_exception.html#ac8f34bd11868822e26a7b952810128b8">reason</a>:@&quot;Unknown Type For &quot; + self];
<a name="l02578"></a>02578                  result = -1;
<a name="l02579"></a>02579             }
<a name="l02580"></a>02580         }
<a name="l02581"></a>02581     }
<a name="l02582"></a>02582 
<a name="l02583"></a>02583     <span class="keywordflow">return</span> result;
<a name="l02584"></a>02584 }
<a name="l02585"></a>02585 
<a name="l02586"></a>02586 <span class="keyword">@end</span>
<a name="l02589"></a>02589 <span class="keyword">@implementation </span><a class="code" href="interface_c_p_rule_editor.html" title="A view for creating and configuring criteria.">CPRuleEditor</a> (CPSynthesizedAccessors)
<a name="l02590"></a>02590 
<a name="l02594"></a>02594 - (<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)boundArrayKeyPath
<a name="l02595"></a>02595 {
<a name="l02596"></a>02596     <span class="keywordflow">return</span> _boundArrayKeyPath;
<a name="l02597"></a>02597 }
<a name="l02598"></a>02598 
<a name="l02602"></a>02602 - (void)setBoundArrayKeyPath:(<a class="code" href="class_c_p_string.html" title="An immutable string (collection of characters).">CPString</a>)aValue
<a name="l02603"></a>02603 {
<a name="l02604"></a>02604     _boundArrayKeyPath = aValue;
<a name="l02605"></a>02605 }
<a name="l02606"></a>02606 
<a name="l02610"></a>02610 - (id)standardLocalizer
<a name="l02611"></a>02611 {
<a name="l02612"></a>02612     <span class="keywordflow">return</span> _standardLocalizer;
<a name="l02613"></a>02613 }
<a name="l02614"></a>02614 
<a name="l02618"></a>02618 - (void)setStandardLocalizer:(<span class="keywordtype">id</span>)aValue
<a name="l02619"></a>02619 {
<a name="l02620"></a>02620     _standardLocalizer = aValue;
<a name="l02621"></a>02621 }
<a name="l02622"></a>02622 
<a name="l02623"></a>02623 <span class="keyword">@end</span>
<a name="l02624"></a>02624 
<a name="l02625"></a><a class="code" href="class_row_object.html">02625</a> <span class="keyword">@implementation </span><a class="code" href="class_row_object.html">RowObject</a> (CPSynthesizedAccessors)
<a name="l02626"></a>02626 
<a name="l02627"></a>02627 <span class="keyword">@end</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_c_p_rule_editor_8j.html">CPRuleEditor.j</a>      </li>
      <li class="footer">Generated on Wed Nov 16 2011 17:34:42 for API by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
